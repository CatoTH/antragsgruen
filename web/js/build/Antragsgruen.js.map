{"version":3,"sources":["Antragsgruen.ts"],"names":["$","$myScriptTag","reqOne","requirejs","config","baseUrl","data","each","loadModule","this","$element","imports","className","split","length","$hint","attr","appendTo","parent","remove","bootbox","setLocale","document","on","ev","$el","currentTarget","classes","placement","popover","html","trigger","container","template","content","id","Date","getTime","url","get","ret","not","parents","$target","target","hasClass","recalcAgendaNode","$ol","currNumber","find","$li","code","currStr","$subitems","parts","match","String","fromCharCode","charCodeAt","matches","nonNumeric","numeric","parseInt","join","text","window","category","str","ANTRAGSGRUEN_STRINGS","jQuery"],"mappings":"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","file":"Antragsgruen.js","sourcesContent":["declare let requirejs: any;\ndeclare let ANTRAGSGRUEN_STRINGS: string[][];\n\n(function ($: JQueryStatic) {\n    const $myScriptTag = $(\"#antragsgruenScript\");\n    let reqOne = requirejs.config({\n        baseUrl: $myScriptTag.data(\"resource-base\") + \"js/build/\"\n    });\n\n    $(\"[data-antragsgruen-load-class]\").each(function () {\n        let loadModule = $(this).data(\"antragsgruen-load-class\");\n        reqOne([loadModule]);\n    });\n\n    $(\"[data-antragsgruen-widget]\").each(function () {\n        let $element = $(this),\n            loadModule = $element.data(\"antragsgruen-widget\");\n        reqOne([loadModule], function (imports) {\n            let className = loadModule.split('/');\n            new imports[className[className.length - 1]]($element);\n        });\n    });\n\n    $(\".jsProtectionHint\").each(function () {\n        let $hint = $(this);\n        $('<input type=\"hidden\" name=\"jsprotection\">').attr(\"value\", $hint.data(\"value\")).appendTo($hint.parent());\n        $hint.remove();\n    });\n\n    bootbox.setLocale($(\"html\").attr(\"lang\").split(\"_\")[0]);\n\n    $(document).on('click', '.amendmentAjaxTooltip', function (ev) {\n        let $el = $(ev.currentTarget);\n        if ($el.data('initialized') == '0') {\n            $el.data('initialized', '1');\n            let classes = \"popover popover-amendment-ajax \" + $el.data('tooltip-extra-class');\n            let placement = 'right';\n            if ($el.data('placement')) {\n                placement = $el.data('placement');\n            }\n            $el.popover({\n                html: true,\n                trigger: 'manual',\n                container: 'body',\n                template: '<div class=\"' + classes + '\" role=\"tooltip\"><div class=\"arrow\"></div><h3 class=\"popover-title\"></h3><div class=\"popover-content\"></div></div>',\n                placement: placement,\n                content: function () {\n                    let id = 'pop_' + (new Date()).getTime(),\n                        content = '<div id=\"' + id + '\">Loading...</div>',\n                        url = $el.data('url');\n                    $.get(url, function (ret) {\n                        $('#' + id).html(ret);\n                    });\n                    return content;\n                }\n            });\n        }\n        $('.amendmentAjaxTooltip').not($el).popover('hide');\n        $('.ajaxAmendment').parents('.popover').remove(); // Workardound for cases where the holder element vanishes while the popover is opened\n        $el.popover('toggle');\n    });\n    $(document).on('click', function (ev) {\n        let $target = $(ev.target);\n        if (\n            !$target.hasClass('amendmentAjaxTooltip') && !$target.hasClass('popover') &&\n            $target.parents('.amendmentAjaxTooltip').length == 0 && $target.parents('.popover').length == 0\n        ) {\n            $('.amendmentAjaxTooltip').popover('hide');\n            $('.ajaxAmendment').parents('.popover').remove(); // Workardound for cases where the holder element vanishes while the popover is opened\n        }\n    });\n\n    // Needs to be synchronized with ConsultationAgendaItem:getSortedFromConsultation\n    let recalcAgendaNode = function ($ol) {\n        let currNumber = '0.',\n            $lis = $ol.find('> li.agendaItem');\n        $lis.each(function () {\n            let $li = $(this),\n                code = $li.data('code'),\n                currStr = '',\n                $subitems = $li.find('> ol');\n            if (code == '#') {\n                let parts = currNumber.split('.');\n                if (parts[0].match(/^[a-y]$/i)) { // Single alphabetical characters\n                    parts[0] = String.fromCharCode(parts[0].charCodeAt(0) + 1);\n                } else { // Numbers or mixtures of alphabetical characters and numbers\n                    let matches = parts[0].match(/^(.*[^0-9])?([0-9]*)$/),\n                        nonNumeric = (typeof(matches[1]) == 'undefined' ? '' : matches[1]),\n                        numeric = parseInt(matches[2] == '' ? '1' : matches[2]);\n                    parts[0] = nonNumeric + ++numeric;\n                }\n                currNumber = currStr = parts.join('.');\n            } else {\n                currStr = currNumber = code + ''; // currNumber needs to be a string, always.\n            }\n\n            $li.find('> div > h3 .code').text(currStr);\n            if ($subitems.length > 0) {\n                recalcAgendaNode($subitems);\n            }\n        });\n    };\n    $('ol.motionListWithinAgenda').on(\"antragsgruen:agenda-change\", function () {\n        recalcAgendaNode($(this));\n    }).trigger(\"antragsgruen:agenda-change\");\n\n    window['__t'] = function (category, str) {\n        if (typeof(ANTRAGSGRUEN_STRINGS) == \"undefined\") {\n            return '@TRANSLATION STRINGS NOT LOADED';\n        }\n        if (typeof(ANTRAGSGRUEN_STRINGS[category]) == \"undefined\") {\n            return \"@UNKNOWN CATEGORY: \" + category\n        }\n        if (typeof(ANTRAGSGRUEN_STRINGS[category][str]) == \"undefined\") {\n            return \"@UNKNOWN STRING: \" + category + \" / \" + str;\n        }\n        return ANTRAGSGRUEN_STRINGS[category][str];\n    };\n}(jQuery));\n"]}