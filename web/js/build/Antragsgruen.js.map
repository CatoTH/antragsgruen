{"version":3,"sources":["Antragsgruen.ts"],"names":["$","$myScriptTag","reqOne","requirejs","config","baseUrl","data","each","loadModule","this","$element","element","imports","className","split","length","$hint","attr","appendTo","parent","remove","bootbox","setLocale","document","on","ev","$el","currentTarget","classes","placement","popover","html","trigger","container","template","content","id","Date","getTime","url","get","ret","not","parents","$target","target","hasClass","window","location","href","body","addEventListener","classList","add","recalcAgendaNode","$ol","prefix","separator","prevCode","currNumber","find","currStr","$li","$subitems","code","parts","match","String","fromCharCode","charCodeAt","matches","nonNumeric","numeric","parseInt","join","trim","text","i","el","toggleClass","next","todoLoader","querySelector","fetch","getAttribute","then","response","json","todoEl","label","innerHTML","replace","setAttribute","category","str","ANTRAGSGRUEN_STRINGS","jQuery","VUE_TO_REGISTER_COMPONENTS","fullscreen","merging","speech","users","voting","appId","componentType","componentName","componentData","push","vueApp","forEach","component","directive","console","warn"],"mappings":"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","file":"Antragsgruen.js","sourcesContent":["declare let requirejs: any;\ndeclare let ANTRAGSGRUEN_STRINGS: string[][];\n\n(function ($: JQueryStatic) {\n    const $myScriptTag = $(\"#antragsgruenScript\");\n    const reqOne = requirejs.config({\n        baseUrl: $myScriptTag.data(\"resource-base\") + \"js/build/\"\n    });\n\n    $(\"[data-antragsgruen-load-class]\").each(function () {\n        const loadModule = $(this).data(\"antragsgruen-load-class\");\n        reqOne([loadModule]);\n    });\n\n    $(\"[data-antragsgruen-widget]\").each(function () {\n        const $element = $(this),\n            element = this,\n            loadModule = $element.data(\"antragsgruen-widget\");\n        reqOne([loadModule], function (imports) {\n            const className = loadModule.split('/');\n            new imports[className[className.length - 1]]($element, element);\n        });\n    });\n\n    $(\".jsProtectionHint\").each(function () {\n        let $hint = $(this);\n        $('<input type=\"hidden\" name=\"jsprotection\">').attr(\"value\", $hint.data(\"value\")).appendTo($hint.parent());\n        $hint.remove();\n    });\n\n    bootbox.setLocale($(\"html\").attr(\"lang\").split(\"_\")[0]);\n\n    $(document).on('click', '.amendmentAjaxTooltip', function (ev) {\n        let $el = $(ev.currentTarget);\n        if ($el.data('initialized') == '0') {\n            $el.data('initialized', '1');\n            let classes = \"popover popover-amendment-ajax \" + $el.data('tooltip-extra-class');\n            let placement: \"auto\" | \"left\" | \"right\" | \"top\" | \"bottom\" = 'right';\n            if ($el.data('placement')) {\n                placement = $el.data('placement');\n            }\n            $el.popover({\n                html: true,\n                trigger: 'manual',\n                container: 'body',\n                template: '<div class=\"' + classes + '\" role=\"tooltip\"><div class=\"arrow\"></div><h3 class=\"popover-title\"></h3><div class=\"popover-content\"></div></div>',\n                placement: placement,\n                content: function () {\n                    let id = 'pop_' + (new Date()).getTime(),\n                        content = '<div id=\"' + id + '\">Loading...</div>',\n                        url = $el.data('url');\n                    $.get(url, function (ret) {\n                        $('#' + id).html(ret);\n                    });\n                    return content;\n                }\n            });\n        }\n        $('.amendmentAjaxTooltip').not($el).popover('hide');\n        $('.ajaxAmendment').parents('.popover').remove(); // Workardound for cases where the holder element vanishes while the popover is opened\n        $el.popover('toggle');\n    });\n    $(document).on('click', function (ev) {\n        let $target = $(ev.target);\n        if (\n            !$target.hasClass('amendmentAjaxTooltip') && !$target.hasClass('popover') &&\n            $target.parents('.amendmentAjaxTooltip').length == 0 && $target.parents('.popover').length == 0\n        ) {\n            $('.amendmentAjaxTooltip').popover('hide');\n            $('.ajaxAmendment').parents('.popover').remove(); // Workardound for cases where the holder element vanishes while the popover is opened\n        }\n    });\n\n    $(document).on('click', '.pseudoLink', ev => {\n        window.location.href = $(ev.currentTarget).data(\"href\");\n    });\n\n    // Used to only show outlines on links when keyboard is used\n    document.body.addEventListener('mousedown', () => {\n        document.body.classList.add('usingMouse');\n    });\n    document.body.addEventListener('keydown', () => {\n        document.body.classList.remove('usingMouse');\n    });\n\n\n    // Needs to be synchronized with ConsultationAgendaItem:getSortedFromConsultation\n    const recalcAgendaNode = ($ol: JQuery, prefix: string) => {\n        const separator = '.';\n        const prevCode = (prefix === '' || prefix[prefix.length - 1] === separator ? prefix : prefix + separator);\n        let currNumber = '0' + separator,\n            $lis = $ol.find('> li.agendaItem');\n        $lis.each(function () {\n            let $li = $(this),\n                currStr,\n                $subitems = $li.find('> ol');\n            if ($li.hasClass('agendaItemDate')) {\n                currStr = prefix;\n            } else {\n                const code = $li.data('code');\n                if (code == '#') {\n                    let parts = currNumber.split(separator);\n                    if (parts[0].match(/^[a-y]$/i)) { // Single alphabetical characters\n                        parts[0] = String.fromCharCode(parts[0].charCodeAt(0) + 1);\n                    } else { // Numbers or mixtures of alphabetical characters and numbers\n                        let matches = parts[0].match(/^(.*[^0-9])?([0-9]*)$/),\n                            nonNumeric = (typeof (matches[1]) == 'undefined' ? '' : matches[1]),\n                            numeric = parseInt(matches[2] == '' ? '1' : matches[2]);\n                        parts[0] = nonNumeric + ++numeric;\n                    }\n                    currNumber = currStr = parts.join(separator);\n                } else {\n                    currStr = currNumber = (code + '').trim(); // currNumber needs to be a string, always.\n                }\n                if (currStr !== '') {\n                    currStr = prevCode + currStr;\n                }\n\n                $li.find('> div > h3 .code').text(currStr);\n            }\n            if ($subitems.length > 0) {\n                recalcAgendaNode($subitems, currStr);\n            }\n        });\n    };\n    $('ol.motionListWithinAgenda').on(\"antragsgruen:agenda-change\", function () {\n        recalcAgendaNode($(this), '');\n    }).trigger(\"antragsgruen:agenda-change\");\n\n    $('.motionList .amendmentsToggler').each((i, el) => {\n        const $el = $(el);\n        $el.find(\"button\").on(\"click\", () => {\n            $el.toggleClass(\"closed\");\n            $el.toggleClass(\"opened\");\n            $el.next(\"ul.amendments\").toggleClass(\"closed\");\n        });\n    });\n\n    // Hint: this is only executed for high-load consultations (with enabled viewCacheFilePath)\n    const todoLoader = document.querySelector(\"#adminTodoLoader\");\n    if (todoLoader) {\n        return fetch(todoLoader.getAttribute(\"data-url\"))\n            .then(response => response.json())\n            .then(json => {\n                const todoEl = document.querySelector(\"#adminTodo\");\n                const label = todoEl.innerHTML.replace(/###COUNT###/, json['count']);\n                todoEl.innerHTML = label;\n                todoEl.setAttribute(\"aria-label\", label);\n                if (json['count'] > 0) {\n                    todoLoader.classList.remove(\"hidden\");\n                }\n            });\n    }\n\n    window['__t'] = function (category, str) {\n        if (typeof(ANTRAGSGRUEN_STRINGS) == \"undefined\") {\n            return '@TRANSLATION STRINGS NOT LOADED';\n        }\n        if (typeof(ANTRAGSGRUEN_STRINGS[category]) == \"undefined\") {\n            return \"@UNKNOWN CATEGORY: \" + category\n        }\n        if (typeof(ANTRAGSGRUEN_STRINGS[category][str]) == \"undefined\") {\n            return \"@UNKNOWN STRING: \" + category + \" / \" + str;\n        }\n        return ANTRAGSGRUEN_STRINGS[category][str];\n    };\n}(jQuery));\n\n// Components defined in HTML templates should be registered here, so the actual Vue app can initialize it on initialization\nconst VUE_TO_REGISTER_COMPONENTS = {\n    \"fullscreen\": [],\n    \"merging\": [],\n    \"speech\": [],\n    \"users\": [],\n    \"voting\": [],\n};\n\nwindow['__setVueComponent'] = function(appId, componentType, componentName, componentData) {\n    VUE_TO_REGISTER_COMPONENTS[appId].push({componentType, componentName, componentData});\n}\n\nwindow['__initVueComponents'] = function(vueApp: any, appId: string) {\n    VUE_TO_REGISTER_COMPONENTS[appId].forEach(component => {\n        if (component.componentType === 'component') {\n            vueApp.component(component.componentName, component.componentData);\n        } else if (component.componentType === 'directive') {\n            vueApp.directive(component.componentName, component.componentData)\n        } else {\n            console.warn('Unknown component Type: ' + component.componentType);\n        }\n    })\n}\n"]}