const FUNCTIONALITY_MOTIONS=1,FUNCTIONALITY_MANIFESTO=2,FUNCTIONALITY_APPLICATIONS=3,FUNCTIONALITY_AGENDA=4,FUNCTIONALITY_SPEECH_LISTS=5,FUNCTIONALITY_STATUTE_AMENDMENTS=6;class SiteCreateWizard{constructor(e){this.$root=e,this.panelConditions={panelLanguage:()=>"#panelLanguage"===this.firstPanel,panelFunctionality:()=>!0,panelSingleMotion:e=>this.hasMotionlikeType(e),panelMotionWho:e=>this.hasMotionlikeType(e)&&0===e.singleMotion,panelMotionDeadline:e=>this.hasMotionlikeType(e)&&0===e.singleMotion&&1!==e.motionsInitiatedBy,panelMotionScreening:e=>this.hasMotionlikeType(e)&&0===e.singleMotion&&1!==e.motionsInitiatedBy,panelNeedsSupporters:e=>this.hasMotionlikeType(e)&&0===e.singleMotion&&1!==e.motionsInitiatedBy,panelHasAmendments:e=>this.hasMotionlikeType(e),panelAmendSinglePara:e=>this.hasMotionlikeType(e)&&1===e.hasAmendments,panelAmendWho:e=>this.hasMotionlikeType(e)&&1===e.hasAmendments,panelAmendDeadline:e=>this.hasMotionlikeType(e)&&1===e.hasAmendments&&1!==e.amendmentInitiatedBy,panelAmendScreening:e=>this.hasMotionlikeType(e)&&1===e.hasAmendments&&1!==e.amendmentInitiatedBy,panelComments:e=>this.hasMotionlikeType(e),panelApplicationType:e=>-1!==e.functionality.indexOf(3),panelSpeechLogin:e=>-1!==e.functionality.indexOf(5),panelSpeechQuotas:e=>-1!==e.functionality.indexOf(5),panelOpenNow:()=>!0,panelSiteData:()=>!0},this.firstPanel=$("#SiteCreateWizard").data("init-step"),this.mode=$("#SiteCreateWizard").data("mode"),this.initEvents()}getRadioValue(e,t){let n=this.$root.find("fieldset."+e).find("input:checked");return n.length>0?n.val():t}getCheckboxValues(e,t){let n=this.$root.find("fieldset."+e).find("input:checked").toArray();return n.length>0?n.map((e=>parseInt(e.getAttribute("value"),10))):t}getWizardState(){return{language:this.getRadioValue("language",null),functionality:this.getCheckboxValues("functionality",[]),singleMotion:parseInt(this.getRadioValue("singleMotion",0),10),motionsInitiatedBy:parseInt(this.getRadioValue("motionWho",1),10),motionsDeadlineExists:parseInt(this.getRadioValue("motionDeadline",0),10),motionsDeadline:this.$root.find("fieldset.motionDeadline .date input").val(),motionScreening:parseInt(this.getRadioValue("motionScreening",1),10),needsSupporters:parseInt(this.getRadioValue("needsSupporters",0),10),minSupporters:(e=this.$root.find("input.minSupporters").val(),""===e||null===e?null:parseInt(e,10)),hasAmendments:parseInt(this.getRadioValue("hasAmendments",1),10),amendSinglePara:parseInt(this.getRadioValue("amendSinglePara",0),10),amendmentInitiatedBy:parseInt(this.getRadioValue("amendmentWho",1),10),amendmentDeadlineExists:parseInt(this.getRadioValue("amendmentDeadline",0),10),amendmentDeadline:this.$root.find("fieldset.amendmentDeadline .date input").val(),amendScreening:parseInt(this.getRadioValue("amendScreening",1),10),hasComments:parseInt(this.getRadioValue("hasComments",1),10),applicationType:parseInt(this.getRadioValue("applicationType",1),10),speechQuotas:parseInt(this.getRadioValue("speechQuotas",1),10),speechLogin:parseInt(this.getRadioValue("speechLogin",1),10),openNow:parseInt(this.getRadioValue("openNow",0),10),title:$("#siteTitle").val(),organization:$("#siteOrganization").val(),subdomain:$("#siteSubdomain").val(),contact:$("#siteContact").val()};var e}showPanel(e){this.data=this.getWizardState();let t=e.data("tab");this.$root.find(".wizard .steps li").removeClass("active"),this.$root.find(".wizard .steps ."+t).addClass("active"),this.$activePanel&&this.$activePanel.removeClass("active").addClass("inactive"),e.addClass("active").removeClass("inactive"),this.$activePanel=e,window.setTimeout((()=>{e.find("input:checked").length>0?e.find("input:checked").trigger("focus"):e.find("button[type=submit]").length>0&&e.find("button[type=submit]").trigger("focus")}),100);try{let t=window.location.hash=="#"+e.attr("id");""!=window.location.hash&&"#"!=window.location.hash||"#"+e.attr("id")!=this.firstPanel||(t=!0),t||(window.location.hash="#"+e.attr("id").substring(5))}catch(e){console.log(e)}}hasMotionlikeType(e){return-1!==e.functionality.indexOf(1)||-1!==e.functionality.indexOf(2)||-1!==e.functionality.indexOf(6)}getNextPanel(){this.data=this.getWizardState();const e=this.$activePanel.attr("id"),t=Object.keys(this.panelConditions);let n=!1;for(let i=0;i<t.length;i++)if(t[i]===e)n=!0;else if(n&&this.panelConditions[t[i]](this.data))return"#"+t[i];console.error("Could not find the next panel for "+e+", data: ",this.data)}subdomainChange(e){let t=$(e.currentTarget),n=t.val(),i=t.parents(".subdomainRow").first(),a=t.data("query-url").replace(/SUBDOMAIN/,n),s=i.find(".subdomainError");return""===n?(s.addClass("hidden"),void i.removeClass("has-error").removeClass("has-success")):n.match(/^[A-Z0-9äöü](?:[A-Z0-9äöü_\-]{0,61}[A-Z0-9äöü])?$/i)?void $.get(a,(e=>{e.available?(s.addClass("hidden"),i.removeClass("has-error"),this.$root.find("button[type=submit]").prop("disabled",!1),e.subdomain==t.val()&&i.addClass("has-success")):(s.removeClass("hidden"),s.html(s.data("template").replace(/%SUBDOMAIN%/,e.subdomain)),i.removeClass("has-success"),e.subdomain==t.val()&&(this.$root.find("button[type=submit]").prop("disabled",!0),i.addClass("has-error")))})):(i.removeClass("has-success").addClass("has-error"),void this.$root.find("button[type=submit]").prop("disabled",!0))}initEvents(){let e=this.$root;this.$activePanel=null,this.data=this.getWizardState(),e.find("input").on("change",(()=>{this.data=this.getWizardState()})),e.find(".radio-label input").on("change",(function(){let e=$(this).parents("fieldset").first();e.find(".radio-label").removeClass("active"),e.find(".radio-label input:checked").parents(".radio-label").first().addClass("active")})).trigger("change"),e.find(".checkbox-label input").on("change",(function(){let e=$(this);e.prop("checked")?e.parents(".checkbox-label").first().addClass("active"):e.parents(".checkbox-label").first().removeClass("active")})).trigger("change"),e.find("fieldset.functionality input").on("change",(function(){let t=e.find("fieldset.functionality input:checked").data("wording-name");e.removeClass("wording_motion").removeClass("wording_manifesto").addClass("wording_"+t)})).trigger("change"),e.find(".input-group.date").each((function(){let e=$(this);e.datetimepicker({locale:e.find("input").data("locale")})})),e.find(".date.motionsDeadline").on("dp.change",(function(){$("input.motionsDeadlineExists").prop("checked",!0).trigger("change")})),e.find(".date.amendmentDeadline").on("dp.change",(function(){$("input.amendDeadlineExists").prop("checked",!0).trigger("change")})),e.find("input.minSupporters").on("change",(()=>{$("input.needsSupporters").prop("checked",!0).trigger("change")})),e.find("#siteSubdomain").on("keyup change",this.subdomainChange.bind(this)),e.find("#siteTitle").on("keyup change",(function(){$(this).val().length>=5?$(this).parents(".form-group").first().addClass("has-success"):$(this).parents(".form-group").first().removeClass("has-success")})),e.find("#siteOrganization").on("keyup change",(function(){$(this).val().length>=5?$(this).parents(".form-group").first().addClass("has-success"):$(this).parents(".form-group").first().removeClass("has-success")})),e.find("#panelSiteData input").on("keypress",(function(e){let t=e.originalEvent;13!==t.charCode&&13!==t.keyCode||e.preventDefault()})),e.find("#panelLanguage input").on("change",(function(){const t=e.find("#panelLanguage input:checked").val(),n=e.find("#panelLanguage").data("url").replace(/LNG/,t);window.location.href=n}));let t=this;e.on("keypress",(e=>{"Enter"===e.key&&"submit"!==this.$activePanel.find(".btn-next").attr("type")&&(e.preventDefault(),e.stopPropagation(),this.showPanel($(t.getNextPanel())))})),e.find(".navigation .btn-next").on("click",(e=>{"submit"!==$(e.currentTarget).attr("type")&&(e.preventDefault(),t.showPanel($(t.getNextPanel())))})),e.find(".navigation .btn-prev").on("click",(e=>{e.preventDefault(),""!=window.location.hash&&window.history.back()})),$(window).on("hashchange",(e=>{let t;e.preventDefault(),t=""===window.location.hash||0===parseInt(window.location.hash.substring(1))?this.firstPanel:"#panel"+window.location.hash.substring(1);let n=$(t);n.length>0&&this.showPanel(n)})),e.find(".step-pane").addClass("inactive"),this.showPanel($(this.firstPanel))}}
//# sourceMappingURL=SiteCreateWizard.js.map
