{"version":3,"sources":["shared/AmendmentEditSinglePara.js","shared/AmendmentEditSinglePara.ts"],"names":["define","require","exports","AntragsgruenEditor_1","Object","defineProperty","value","AmendmentEditSinglePara","constructor","this","$paragraphs","$","on","ev","startEditing","delegateTarget","find","preventDefault","stopPropagation","revertChanges","setModifyable","filter","each","i","el","handleRegularTextField","$this","sectionId","data","paraNo","trigger","$el","$textarea","hasClass","editor","AntragsgruenEditor","attr","getEditor","parents","parent","val","getData","plugins","lite","findPlugin","acceptAll","para","$para","id","html","removeClass","addClass","CKEDITOR","instances","aedit","focus","$modified","length"],"mappings":"AAAAA,OAAO,CAAC,UAAW,UAAW,yBAAyB,SAAUC,EAASC,EAASC,GAC/E,aACAC,OAAOC,eAAeH,EAAS,aAAc,CAAEI,OAAO,IACtDJ,EAAQK,6BAA0B,ECDtCL,EAAAK,wBAAA,MAGI,WAAAC,GACIC,KAAKC,YAAcC,EAAE,sCAErBF,KAAKC,YAAYE,GAAG,SAAUC,IAC1BJ,KAAKK,aAAaD,EAAGE,eAAe,IAExCN,KAAKC,YAAYM,KAAK,4BAA4BJ,GAAG,SAAUC,IAC3DA,EAAGI,iBACHJ,EAAGK,kBACHT,KAAKU,cAAcN,EAAGE,eAAe,IAEzCN,KAAKW,gBAGLT,EAAE,qBAAqBU,OAAO,2BAA2BC,MAAK,CAACC,EAAGC,KAC9Df,KAAKgB,uBAAuBD,EAAG,IAGnCb,EAAE,kBAAkBW,MAAK,CAACC,EAAGC,KACzB,IAAIE,EAAQf,EAAEa,GACVG,EAAYD,EAAME,KAAK,cACvBC,EAASH,EAAME,KAAK,mBACpBC,GAAU,GACVlB,EAAE,mBAAqBgB,EAAY,IAAME,GAAQC,QAAQ,QAC7D,GAER,CAEQ,sBAAAL,CAAuBD,GAC3B,IAAIO,EAAMpB,EAAEa,GACRQ,EAAYD,EAAIf,KAAK,eAEzB,GAAIe,EAAIE,SAAS,UACb,OAEJ,IACIC,EADQ,IAAI/B,EAAAgC,mBAAmBH,EAAUI,KAAK,OAC/BC,YACnBL,EAAUM,QAAQ,QAAQ1B,GAAG,UAAU,KACnCoB,EAAUO,SAASvB,KAAK,gBAAgBwB,IAAIN,EAAOO,gBAChB,IAAxBP,EAAOQ,QAAY,OAC1BR,EAAOQ,QAAQC,KAAKC,WAAWV,GAAQW,YACvCb,EAAUO,SAASvB,KAAK,yBAAyBwB,IAAIN,EAAOO,WAChE,GAER,CAEQ,aAAAtB,CAAc2B,GAClB,IACIC,EADMpC,EAAEmC,GACIR,QAAQ,qBACpBN,EAAYe,EAAM/B,KAAK,eACvBgC,EAAKhB,EAAUI,KAAK,MACxBzB,EAAE,IAAMqC,GAAIZ,KAAK,kBAAmB,SACpCJ,EAAUiB,KAAKF,EAAMnB,KAAK,aAC1BmB,EAAMG,YAAY,YAClBzC,KAAKW,eACT,CAEQ,YAAAN,CAAagC,GACjB,IAAIC,EAAQpC,EAAEmC,GACd,IAAKC,EAAMd,SAAS,cAChB,OAGJc,EAAMI,SAAS,YACf1C,KAAKW,gBAEL,IACIc,EADAF,EAAYe,EAAM/B,KAAK,eAE3B,QAAyD,IAA9CoC,SAASC,UAAUrB,EAAUI,KAAK,OACzCF,EAASkB,SAASC,UAAUrB,EAAUI,KAAK,WACxC,CACH,IAAIkB,EAAQ,IAAInD,EAAAgC,mBAAmBH,EAAUI,KAAK,OAClDF,EAASoB,EAAMjB,WACnB,CACAL,EAAUI,KAAK,kBAAmB,QAClCJ,EAAUM,QAAQ,QAAQ1B,GAAG,UAAU,KACnCoB,EAAUO,SAASvB,KAAK,gBAAgBwB,IAAIN,EAAOO,gBAChB,IAAxBP,EAAOQ,QAAY,OAC1BR,EAAOQ,QAAQC,KAAKC,WAAWV,GAAQW,YACvCb,EAAUO,SAASvB,KAAK,yBAAyBwB,IAAIN,EAAOO,WAChE,IAEJT,EAAUuB,OACd,CAEQ,aAAAnC,GACJ,IAAIoC,EAAY/C,KAAKC,YAAYW,OAAO,aAChB,GAApBmC,EAAUC,OACVhD,KAAKC,YAAYyC,SAAS,eAE1B1C,KAAKC,YAAYwC,YAAY,cAC7BvC,EAAE,mCAAmC6B,IAAIgB,EAAU5B,KAAK,iBACxDjB,EAAE,iCAAiC6B,IAAIgB,EAAUlB,QAAQ,kBAAkBV,KAAK,eAExF,EDbJ","file":"AmendmentEditSinglePara.js","sourcesContent":[null,"import {AntragsgruenEditor} from \"./AntragsgruenEditor\";\n\nexport class AmendmentEditSinglePara {\n    private $paragraphs: JQuery;\n\n    constructor() {\n        this.$paragraphs = $(\".wysiwyg-textarea.single-paragraph\");\n\n        this.$paragraphs.on('click', (ev) => {\n            this.startEditing(ev.delegateTarget);\n        });\n        this.$paragraphs.find(\".modifiedActions .revert\").on('click', (ev) => {\n            ev.preventDefault();\n            ev.stopPropagation();\n            this.revertChanges(ev.delegateTarget);\n        });\n        this.setModifyable();\n\n        // Amendment Reason\n        $(\".wysiwyg-textarea\").filter(\":not(.single-paragraph)\").each((i, el) => {\n            this.handleRegularTextField(el);\n        });\n\n        $(\".texteditorBox\").each((i, el) => {\n            let $this = $(el),\n                sectionId = $this.data(\"section-id\"),\n                paraNo = $this.data(\"changed-para-no\");\n            if (paraNo > -1) {\n                $(\"#section_holder_\" + sectionId + \"_\" + paraNo).trigger('click');\n            }\n        });\n    }\n\n    private handleRegularTextField(el: Element) {\n        let $el = $(el),\n            $textarea = $el.find(\".texteditor\");\n\n        if ($el.hasClass(\"hidden\")) {\n            return;\n        }\n        let aedit = new AntragsgruenEditor($textarea.attr(\"id\")),\n            editor = aedit.getEditor();\n        $textarea.parents(\"form\").on('submit', () => {\n            $textarea.parent().find(\"textarea.raw\").val(editor.getData());\n            if (typeof(editor.plugins.lite) != 'undefined') {\n                editor.plugins.lite.findPlugin(editor).acceptAll();\n                $textarea.parent().find(\"textarea.consolidated\").val(editor.getData());\n            }\n        });\n    }\n\n    private revertChanges(para: Element) {\n        let $el = $(para),\n            $para = $el.parents(\".wysiwyg-textarea\"),\n            $textarea = $para.find(\".texteditor\"),\n            id = $textarea.attr(\"id\");\n        $(\"#\" + id).attr(\"contenteditable\", \"false\");\n        $textarea.html($para.data(\"original\"));\n        $para.removeClass(\"modified\");\n        this.setModifyable();\n    }\n\n    private startEditing(para: Element) {\n        let $para = $(para);\n        if (!$para.hasClass('modifyable')) {\n            return;\n        }\n\n        $para.addClass('modified');\n        this.setModifyable();\n\n        let $textarea = $para.find(\".texteditor\"),\n            editor;\n        if (typeof(CKEDITOR.instances[$textarea.attr(\"id\")]) !== \"undefined\") {\n            editor = CKEDITOR.instances[$textarea.attr(\"id\")];\n        } else {\n            let aedit = new AntragsgruenEditor($textarea.attr(\"id\"));\n            editor = aedit.getEditor();\n        }\n        $textarea.attr(\"contenteditable\", \"true\");\n        $textarea.parents(\"form\").on('submit', () => {\n            $textarea.parent().find(\"textarea.raw\").val(editor.getData());\n            if (typeof(editor.plugins.lite) != 'undefined') {\n                editor.plugins.lite.findPlugin(editor).acceptAll();\n                $textarea.parent().find(\"textarea.consolidated\").val(editor.getData());\n            }\n        });\n        $textarea.focus();\n    }\n\n    private setModifyable() {\n        let $modified = this.$paragraphs.filter(\".modified\");\n        if ($modified.length == 0) {\n            this.$paragraphs.addClass('modifyable');\n        } else {\n            this.$paragraphs.removeClass('modifyable');\n            $('input[name=modifiedParagraphNo]').val($modified.data(\"paragraph-no\"));\n            $('input[name=modifiedSectionId]').val($modified.parents(\".texteditorBox\").data(\"section-id\"));\n        }\n    }\n}\n"]}