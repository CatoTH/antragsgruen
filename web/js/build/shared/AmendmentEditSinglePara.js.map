{"version":3,"sources":["shared/AmendmentEditSinglePara.ts"],"names":["AmendmentEditSinglePara","_this","this","$paragraphs","$","click","ev","startEditing","delegateTarget","find","preventDefault","stopPropagation","revertChanges","setModifyable","filter","each","i","el","handleRegularTextField","$this","sectionId","data","paraNo","prototype","$el","$textarea","hasClass","editor","AntragsgruenEditor_1","AntragsgruenEditor","attr","getEditor","parents","submit","parent","val","getData","plugins","lite","findPlugin","acceptAll","para","$para","id","html","removeClass","addClass","CKEDITOR","instances","aedit","focus","$modified","length","exports"],"mappings":"kIAEA,IAAAA,EAAA,WAGI,SAAAA,IAAA,IAAAC,EAAAC,KACIA,KAAKC,YAAcC,EAAE,sCAErBF,KAAKC,YAAYE,MAAM,SAACC,GACpBL,EAAKM,aAAaD,EAAGE,kBAEzBN,KAAKC,YAAYM,KAAK,4BAA4BJ,MAAM,SAACC,GACrDA,EAAGI,iBACHJ,EAAGK,kBACHV,EAAKW,cAAcN,EAAGE,kBAE1BN,KAAKW,gBAGLT,EAAE,qBAAqBU,OAAO,2BAA2BC,KAAK,SAACC,EAAGC,GAC9DhB,EAAKiB,uBAAuBD,KAGhCb,EAAE,kBAAkBW,KAAK,SAACC,EAAGC,GACzB,IAAIE,EAAQf,EAAEa,GACVG,EAAYD,EAAME,KAAK,cACvBC,EAASH,EAAME,KAAK,mBACpBC,GAAU,GACVlB,EAAE,mBAAqBgB,EAAY,IAAME,GAAQjB,UAwEjE,OAnEYL,EAAAuB,UAAAL,uBAAR,SAA+BD,GAC3B,IAAIO,EAAMpB,EAAEa,GACRQ,EAAYD,EAAIf,KAAK,eAEzB,IAAIe,EAAIE,SAAS,UAAjB,CAGA,IACIC,EADQ,IAAIC,EAAAC,mBAAmBJ,EAAUK,KAAK,OAC/BC,YACnBN,EAAUO,QAAQ,QAAQC,OAAO,WAC7BR,EAAUS,SAASzB,KAAK,gBAAgB0B,IAAIR,EAAOS,gBAChB,IAAxBT,EAAOU,QAAY,OAC1BV,EAAOU,QAAQC,KAAKC,WAAWZ,GAAQa,YACvCf,EAAUS,SAASzB,KAAK,yBAAyB0B,IAAIR,EAAOS,gBAKhEpC,EAAAuB,UAAAX,cAAR,SAAsB6B,GAClB,IACIC,EADMtC,EAAEqC,GACIT,QAAQ,qBACpBP,EAAYiB,EAAMjC,KAAK,eACvBkC,EAAKlB,EAAUK,KAAK,MACxB1B,EAAE,IAAMuC,GAAIb,KAAK,kBAAmB,SACpCL,EAAUmB,KAAKF,EAAMrB,KAAK,aAC1BqB,EAAMG,YAAY,YAClB3C,KAAKW,iBAGDb,EAAAuB,UAAAhB,aAAR,SAAqBkC,GACjB,IAAIC,EAAQtC,EAAEqC,GACd,GAAKC,EAAMhB,SAAS,cAApB,CAIAgB,EAAMI,SAAS,YACf5C,KAAKW,gBAEL,IACIc,EADAF,EAAYiB,EAAMjC,KAAK,eAE3B,QAAyD,IAA9CsC,SAASC,UAAUvB,EAAUK,KAAK,OACzCH,EAASoB,SAASC,UAAUvB,EAAUK,KAAK,WACxC,CACH,IAAImB,EAAQ,IAAIrB,EAAAC,mBAAmBJ,EAAUK,KAAK,OAClDH,EAASsB,EAAMlB,YAEnBN,EAAUK,KAAK,kBAAmB,QAClCL,EAAUO,QAAQ,QAAQC,OAAO,WAC7BR,EAAUS,SAASzB,KAAK,gBAAgB0B,IAAIR,EAAOS,gBAChB,IAAxBT,EAAOU,QAAY,OAC1BV,EAAOU,QAAQC,KAAKC,WAAWZ,GAAQa,YACvCf,EAAUS,SAASzB,KAAK,yBAAyB0B,IAAIR,EAAOS,cAGpEX,EAAUyB,UAGNlD,EAAAuB,UAAAV,cAAR,WACI,IAAIsC,EAAYjD,KAAKC,YAAYW,OAAO,aAChB,GAApBqC,EAAUC,OACVlD,KAAKC,YAAY2C,SAAS,eAE1B5C,KAAKC,YAAY0C,YAAY,cAC7BzC,EAAE,mCAAmC+B,IAAIgB,EAAU9B,KAAK,iBACxDjB,EAAE,iCAAiC+B,IAAIgB,EAAUnB,QAAQ,kBAAkBX,KAAK,iBAG5FrB,EAlGA,GAAaqD,EAAArD,wBAAAA","file":"AmendmentEditSinglePara.js","sourcesContent":["import {AntragsgruenEditor} from \"./AntragsgruenEditor\";\n\nexport class AmendmentEditSinglePara {\n    private $paragraphs: JQuery;\n\n    constructor() {\n        this.$paragraphs = $(\".wysiwyg-textarea.single-paragraph\");\n\n        this.$paragraphs.click((ev) => {\n            this.startEditing(ev.delegateTarget);\n        });\n        this.$paragraphs.find(\".modifiedActions .revert\").click((ev) => {\n            ev.preventDefault();\n            ev.stopPropagation();\n            this.revertChanges(ev.delegateTarget);\n        });\n        this.setModifyable();\n\n        // Amendment Reason\n        $(\".wysiwyg-textarea\").filter(\":not(.single-paragraph)\").each((i, el) => {\n            this.handleRegularTextField(el);\n        });\n\n        $(\".texteditorBox\").each((i, el) => {\n            let $this = $(el),\n                sectionId = $this.data(\"section-id\"),\n                paraNo = $this.data(\"changed-para-no\");\n            if (paraNo > -1) {\n                $(\"#section_holder_\" + sectionId + \"_\" + paraNo).click();\n            }\n        });\n    }\n\n    private handleRegularTextField(el: Element) {\n        let $el = $(el),\n            $textarea = $el.find(\".texteditor\");\n\n        if ($el.hasClass(\"hidden\")) {\n            return;\n        }\n        let aedit = new AntragsgruenEditor($textarea.attr(\"id\")),\n            editor = aedit.getEditor();\n        $textarea.parents(\"form\").submit(() => {\n            $textarea.parent().find(\"textarea.raw\").val(editor.getData());\n            if (typeof(editor.plugins.lite) != 'undefined') {\n                editor.plugins.lite.findPlugin(editor).acceptAll();\n                $textarea.parent().find(\"textarea.consolidated\").val(editor.getData());\n            }\n        });\n    }\n\n    private revertChanges(para: Element) {\n        let $el = $(para),\n            $para = $el.parents(\".wysiwyg-textarea\"),\n            $textarea = $para.find(\".texteditor\"),\n            id = $textarea.attr(\"id\");\n        $(\"#\" + id).attr(\"contenteditable\", \"false\");\n        $textarea.html($para.data(\"original\"));\n        $para.removeClass(\"modified\");\n        this.setModifyable();\n    }\n\n    private startEditing(para: Element) {\n        let $para = $(para);\n        if (!$para.hasClass('modifyable')) {\n            return;\n        }\n\n        $para.addClass('modified');\n        this.setModifyable();\n\n        let $textarea = $para.find(\".texteditor\"),\n            editor;\n        if (typeof(CKEDITOR.instances[$textarea.attr(\"id\")]) !== \"undefined\") {\n            editor = CKEDITOR.instances[$textarea.attr(\"id\")];\n        } else {\n            let aedit = new AntragsgruenEditor($textarea.attr(\"id\"));\n            editor = aedit.getEditor();\n        }\n        $textarea.attr(\"contenteditable\", \"true\");\n        $textarea.parents(\"form\").submit(() => {\n            $textarea.parent().find(\"textarea.raw\").val(editor.getData());\n            if (typeof(editor.plugins.lite) != 'undefined') {\n                editor.plugins.lite.findPlugin(editor).acceptAll();\n                $textarea.parent().find(\"textarea.consolidated\").val(editor.getData());\n            }\n        });\n        $textarea.focus();\n    }\n\n    private setModifyable() {\n        let $modified = this.$paragraphs.filter(\".modified\");\n        if ($modified.length == 0) {\n            this.$paragraphs.addClass('modifyable');\n        } else {\n            this.$paragraphs.removeClass('modifyable');\n            $('input[name=modifiedParagraphNo]').val($modified.data(\"paragraph-no\"));\n            $('input[name=modifiedSectionId]').val($modified.parents(\".texteditorBox\").data(\"section-id\"));\n        }\n    }\n}\n"]}