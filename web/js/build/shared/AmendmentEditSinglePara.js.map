{"version":3,"sources":["shared/AmendmentEditSinglePara.ts"],"names":["AntragsgruenEditor","AmendmentEditSinglePara","constructor","this","$paragraphs","$","on","ev","startEditing","delegateTarget","find","preventDefault","stopPropagation","revertChanges","setModifyable","filter","each","i","el","handleRegularTextField","$this","sectionId","data","paraNo","trigger","$el","$textarea","hasClass","editor","attr","getEditor","parents","parent","val","getData","plugins","lite","findPlugin","acceptAll","para","$para","id","html","removeClass","addClass","CKEDITOR","instances","aedit","$modified","length"],"mappings":"OAAQA,uBAAyB,8BAE3B,MAAOC,wBAGT,WAAAC,GACIC,KAAKC,YAAcC,EAAE,sCAErBF,KAAKC,YAAYE,GAAG,QAAUC,IAC1BJ,KAAKK,aAAaD,EAAGE,kBAEzBN,KAAKC,YAAYM,KAAK,4BAA4BJ,GAAG,QAAUC,IAC3DA,EAAGI,iBACHJ,EAAGK,kBACHT,KAAKU,cAAcN,EAAGE,kBAE1BN,KAAKW,gBAGLT,EAAE,qBAAqBU,OAAO,2BAA2BC,KAAK,CAACC,EAAGC,KAC9Df,KAAKgB,uBAAuBD,KAGhCb,EAAE,kBAAkBW,KAAK,CAACC,EAAGC,KACzB,IAAIE,EAAQf,EAAEa,GACVG,EAAYD,EAAME,KAAK,cACvBC,EAASH,EAAME,KAAK,mBACpBC,GAAU,GACVlB,EAAE,mBAAqBgB,EAAY,IAAME,GAAQC,QAAQ,UAGrE,CAEQ,sBAAAL,CAAuBD,GAC3B,IAAIO,EAAMpB,EAAEa,GACRQ,EAAYD,EAAIf,KAAK,eAEzB,GAAIe,EAAIE,SAAS,UACb,OAEJ,IACIC,EADQ,IAAI5B,mBAAmB0B,EAAUG,KAAK,OAC/BC,YACnBJ,EAAUK,QAAQ,QAAQzB,GAAG,SAAU,KACnCoB,EAAUM,SAAStB,KAAK,gBAAgBuB,IAAIL,EAAOM,gBAChB,IAAxBN,EAAOO,QAAY,OAC1BP,EAAOO,QAAQC,KAAKC,WAAWT,GAAQU,YACvCZ,EAAUM,SAAStB,KAAK,yBAAyBuB,IAAIL,EAAOM,aAGxE,CAEQ,aAAArB,CAAc0B,GAClB,IACIC,EADMnC,EAAEkC,GACIR,QAAQ,qBACpBL,EAAYc,EAAM9B,KAAK,eACvB+B,EAAKf,EAAUG,KAAK,MACxBxB,EAAE,IAAMoC,GAAIZ,KAAK,kBAAmB,SACpCH,EAAUgB,KAAKF,EAAMlB,KAAK,aAC1BkB,EAAMG,YAAY,YAClBxC,KAAKW,eACT,CAEQ,YAAAN,CAAa+B,GACjB,IAAIC,EAAQnC,EAAEkC,GACd,IAAKC,EAAMb,SAAS,cAChB,OAGJa,EAAMI,SAAS,YACfzC,KAAKW,gBAEL,IACIc,EADAF,EAAYc,EAAM9B,KAAK,eAE3B,QAAyD,IAA9CmC,SAASC,UAAUpB,EAAUG,KAAK,OACzCD,EAASiB,SAASC,UAAUpB,EAAUG,KAAK,WACxC,CACH,IAAIkB,EAAQ,IAAI/C,mBAAmB0B,EAAUG,KAAK,OAClDD,EAASmB,EAAMjB,WACnB,CACAJ,EAAUG,KAAK,kBAAmB,QAClCH,EAAUK,QAAQ,QAAQzB,GAAG,SAAU,KACnCoB,EAAUM,SAAStB,KAAK,gBAAgBuB,IAAIL,EAAOM,gBAChB,IAAxBN,EAAOO,QAAY,OAC1BP,EAAOO,QAAQC,KAAKC,WAAWT,GAAQU,YACvCZ,EAAUM,SAAStB,KAAK,yBAAyBuB,IAAIL,EAAOM,cAGpER,EAAUF,QAAQ,QACtB,CAEQ,aAAAV,GACJ,IAAIkC,EAAY7C,KAAKC,YAAYW,OAAO,aAChB,GAApBiC,EAAUC,OACV9C,KAAKC,YAAYwC,SAAS,eAE1BzC,KAAKC,YAAYuC,YAAY,cAC7BtC,EAAE,mCAAmC4B,IAAIe,EAAU1B,KAAK,iBACxDjB,EAAE,iCAAiC4B,IAAIe,EAAUjB,QAAQ,kBAAkBT,KAAK,eAExF","file":"AmendmentEditSinglePara.js","sourcesContent":["import {AntragsgruenEditor} from \"./AntragsgruenEditor\";\n\nexport class AmendmentEditSinglePara {\n    private $paragraphs: JQuery;\n\n    constructor() {\n        this.$paragraphs = $(\".wysiwyg-textarea.single-paragraph\");\n\n        this.$paragraphs.on('click', (ev) => {\n            this.startEditing(ev.delegateTarget);\n        });\n        this.$paragraphs.find(\".modifiedActions .revert\").on('click', (ev) => {\n            ev.preventDefault();\n            ev.stopPropagation();\n            this.revertChanges(ev.delegateTarget);\n        });\n        this.setModifyable();\n\n        // Amendment Reason\n        $(\".wysiwyg-textarea\").filter(\":not(.single-paragraph)\").each((i, el) => {\n            this.handleRegularTextField(el);\n        });\n\n        $(\".texteditorBox\").each((i, el) => {\n            let $this = $(el),\n                sectionId = $this.data(\"section-id\"),\n                paraNo = $this.data(\"changed-para-no\");\n            if (paraNo > -1) {\n                $(\"#section_holder_\" + sectionId + \"_\" + paraNo).trigger('click');\n            }\n        });\n    }\n\n    private handleRegularTextField(el: Element) {\n        let $el = $(el),\n            $textarea = $el.find(\".texteditor\");\n\n        if ($el.hasClass(\"hidden\")) {\n            return;\n        }\n        let aedit = new AntragsgruenEditor($textarea.attr(\"id\")),\n            editor = aedit.getEditor();\n        $textarea.parents(\"form\").on('submit', () => {\n            $textarea.parent().find(\"textarea.raw\").val(editor.getData());\n            if (typeof(editor.plugins.lite) != 'undefined') {\n                editor.plugins.lite.findPlugin(editor).acceptAll();\n                $textarea.parent().find(\"textarea.consolidated\").val(editor.getData());\n            }\n        });\n    }\n\n    private revertChanges(para: Element) {\n        let $el = $(para),\n            $para = $el.parents(\".wysiwyg-textarea\"),\n            $textarea = $para.find(\".texteditor\"),\n            id = $textarea.attr(\"id\");\n        $(\"#\" + id).attr(\"contenteditable\", \"false\");\n        $textarea.html($para.data(\"original\"));\n        $para.removeClass(\"modified\");\n        this.setModifyable();\n    }\n\n    private startEditing(para: Element) {\n        let $para = $(para);\n        if (!$para.hasClass('modifyable')) {\n            return;\n        }\n\n        $para.addClass('modified');\n        this.setModifyable();\n\n        let $textarea = $para.find(\".texteditor\"),\n            editor;\n        if (typeof(CKEDITOR.instances[$textarea.attr(\"id\")]) !== \"undefined\") {\n            editor = CKEDITOR.instances[$textarea.attr(\"id\")];\n        } else {\n            let aedit = new AntragsgruenEditor($textarea.attr(\"id\"));\n            editor = aedit.getEditor();\n        }\n        $textarea.attr(\"contenteditable\", \"true\");\n        $textarea.parents(\"form\").on('submit', () => {\n            $textarea.parent().find(\"textarea.raw\").val(editor.getData());\n            if (typeof(editor.plugins.lite) != 'undefined') {\n                editor.plugins.lite.findPlugin(editor).acceptAll();\n                $textarea.parent().find(\"textarea.consolidated\").val(editor.getData());\n            }\n        });\n        $textarea.trigger(\"focus\");;\n    }\n\n    private setModifyable() {\n        let $modified = this.$paragraphs.filter(\".modified\");\n        if ($modified.length == 0) {\n            this.$paragraphs.addClass('modifyable');\n        } else {\n            this.$paragraphs.removeClass('modifyable');\n            $('input[name=modifiedParagraphNo]').val($modified.data(\"paragraph-no\"));\n            $('input[name=modifiedSectionId]').val($modified.parents(\".texteditorBox\").data(\"section-id\"));\n        }\n    }\n}\n"]}