{"version":3,"sources":["shared/AmendmentEditSinglePara.js","shared/AmendmentEditSinglePara.ts"],"names":["define","require","exports","AntragsgruenEditor_1","Object","defineProperty","value","AmendmentEditSinglePara","[object Object]","this","$paragraphs","$","click","ev","startEditing","delegateTarget","find","preventDefault","stopPropagation","revertChanges","setModifyable","filter","each","i","el","handleRegularTextField","$this","sectionId","data","paraNo","$el","$textarea","hasClass","editor","AntragsgruenEditor","attr","getEditor","parents","submit","parent","val","getData","plugins","lite","findPlugin","acceptAll","para","$para","id","html","removeClass","addClass","CKEDITOR","instances","aedit","focus","$modified","length"],"mappings":"AAAAA,OAAO,CAAC,UAAW,UAAW,yBAAyB,SAAUC,EAASC,EAASC,GAC/E,aACAC,OAAOC,eAAeH,EAAS,aAAc,CAAEI,OAAO,IACtDJ,EAAQK,6BAA0B,ECDtCL,EAAAK,wBAAA,MAGIC,cACIC,KAAKC,YAAcC,EAAE,sCAErBF,KAAKC,YAAYE,OAAOC,IACpBJ,KAAKK,aAAaD,EAAGE,mBAEzBN,KAAKC,YAAYM,KAAK,4BAA4BJ,OAAOC,IACrDA,EAAGI,iBACHJ,EAAGK,kBACHT,KAAKU,cAAcN,EAAGE,mBAE1BN,KAAKW,gBAGLT,EAAE,qBAAqBU,OAAO,2BAA2BC,MAAK,CAACC,EAAGC,KAC9Df,KAAKgB,uBAAuBD,MAGhCb,EAAE,kBAAkBW,MAAK,CAACC,EAAGC,KACzB,IAAIE,EAAQf,EAAEa,GACVG,EAAYD,EAAME,KAAK,cACvBC,EAASH,EAAME,KAAK,mBACpBC,GAAU,GACVlB,EAAE,mBAAqBgB,EAAY,IAAME,GAAQjB,WAKrDJ,uBAAuBgB,GAC3B,IAAIM,EAAMnB,EAAEa,GACRO,EAAYD,EAAId,KAAK,eAEzB,GAAIc,EAAIE,SAAS,UACb,OAEJ,IACIC,EADQ,IAAI9B,EAAA+B,mBAAmBH,EAAUI,KAAK,OAC/BC,YACnBL,EAAUM,QAAQ,QAAQC,QAAO,KAC7BP,EAAUQ,SAASvB,KAAK,gBAAgBwB,IAAIP,EAAOQ,gBAChB,IAAxBR,EAAOS,QAAY,OAC1BT,EAAOS,QAAQC,KAAKC,WAAWX,GAAQY,YACvCd,EAAUQ,SAASvB,KAAK,yBAAyBwB,IAAIP,EAAOQ,eAKhEjC,cAAcsC,GAClB,IACIC,EADMpC,EAAEmC,GACIT,QAAQ,qBACpBN,EAAYgB,EAAM/B,KAAK,eACvBgC,EAAKjB,EAAUI,KAAK,MACxBxB,EAAE,IAAMqC,GAAIb,KAAK,kBAAmB,SACpCJ,EAAUkB,KAAKF,EAAMnB,KAAK,aAC1BmB,EAAMG,YAAY,YAClBzC,KAAKW,gBAGDZ,aAAasC,GACjB,IAAIC,EAAQpC,EAAEmC,GACd,IAAKC,EAAMf,SAAS,cAChB,OAGJe,EAAMI,SAAS,YACf1C,KAAKW,gBAEL,IACIa,EADAF,EAAYgB,EAAM/B,KAAK,eAE3B,QAAyD,IAA9CoC,SAASC,UAAUtB,EAAUI,KAAK,OACzCF,EAASmB,SAASC,UAAUtB,EAAUI,KAAK,WACxC,CACH,IAAImB,EAAQ,IAAInD,EAAA+B,mBAAmBH,EAAUI,KAAK,OAClDF,EAASqB,EAAMlB,YAEnBL,EAAUI,KAAK,kBAAmB,QAClCJ,EAAUM,QAAQ,QAAQC,QAAO,KAC7BP,EAAUQ,SAASvB,KAAK,gBAAgBwB,IAAIP,EAAOQ,gBAChB,IAAxBR,EAAOS,QAAY,OAC1BT,EAAOS,QAAQC,KAAKC,WAAWX,GAAQY,YACvCd,EAAUQ,SAASvB,KAAK,yBAAyBwB,IAAIP,EAAOQ,eAGpEV,EAAUwB,QAGN/C,gBACJ,IAAIgD,EAAY/C,KAAKC,YAAYW,OAAO,aAChB,GAApBmC,EAAUC,OACVhD,KAAKC,YAAYyC,SAAS,eAE1B1C,KAAKC,YAAYwC,YAAY,cAC7BvC,EAAE,mCAAmC6B,IAAIgB,EAAU5B,KAAK,iBACxDjB,EAAE,iCAAiC6B,IAAIgB,EAAUnB,QAAQ,kBAAkBT,KAAK","file":"AmendmentEditSinglePara.js","sourcesContent":[null,"import {AntragsgruenEditor} from \"./AntragsgruenEditor\";\n\nexport class AmendmentEditSinglePara {\n    private $paragraphs: JQuery;\n\n    constructor() {\n        this.$paragraphs = $(\".wysiwyg-textarea.single-paragraph\");\n\n        this.$paragraphs.click((ev) => {\n            this.startEditing(ev.delegateTarget);\n        });\n        this.$paragraphs.find(\".modifiedActions .revert\").click((ev) => {\n            ev.preventDefault();\n            ev.stopPropagation();\n            this.revertChanges(ev.delegateTarget);\n        });\n        this.setModifyable();\n\n        // Amendment Reason\n        $(\".wysiwyg-textarea\").filter(\":not(.single-paragraph)\").each((i, el) => {\n            this.handleRegularTextField(el);\n        });\n\n        $(\".texteditorBox\").each((i, el) => {\n            let $this = $(el),\n                sectionId = $this.data(\"section-id\"),\n                paraNo = $this.data(\"changed-para-no\");\n            if (paraNo > -1) {\n                $(\"#section_holder_\" + sectionId + \"_\" + paraNo).click();\n            }\n        });\n    }\n\n    private handleRegularTextField(el: Element) {\n        let $el = $(el),\n            $textarea = $el.find(\".texteditor\");\n\n        if ($el.hasClass(\"hidden\")) {\n            return;\n        }\n        let aedit = new AntragsgruenEditor($textarea.attr(\"id\")),\n            editor = aedit.getEditor();\n        $textarea.parents(\"form\").submit(() => {\n            $textarea.parent().find(\"textarea.raw\").val(editor.getData());\n            if (typeof(editor.plugins.lite) != 'undefined') {\n                editor.plugins.lite.findPlugin(editor).acceptAll();\n                $textarea.parent().find(\"textarea.consolidated\").val(editor.getData());\n            }\n        });\n    }\n\n    private revertChanges(para: Element) {\n        let $el = $(para),\n            $para = $el.parents(\".wysiwyg-textarea\"),\n            $textarea = $para.find(\".texteditor\"),\n            id = $textarea.attr(\"id\");\n        $(\"#\" + id).attr(\"contenteditable\", \"false\");\n        $textarea.html($para.data(\"original\"));\n        $para.removeClass(\"modified\");\n        this.setModifyable();\n    }\n\n    private startEditing(para: Element) {\n        let $para = $(para);\n        if (!$para.hasClass('modifyable')) {\n            return;\n        }\n\n        $para.addClass('modified');\n        this.setModifyable();\n\n        let $textarea = $para.find(\".texteditor\"),\n            editor;\n        if (typeof(CKEDITOR.instances[$textarea.attr(\"id\")]) !== \"undefined\") {\n            editor = CKEDITOR.instances[$textarea.attr(\"id\")];\n        } else {\n            let aedit = new AntragsgruenEditor($textarea.attr(\"id\"));\n            editor = aedit.getEditor();\n        }\n        $textarea.attr(\"contenteditable\", \"true\");\n        $textarea.parents(\"form\").submit(() => {\n            $textarea.parent().find(\"textarea.raw\").val(editor.getData());\n            if (typeof(editor.plugins.lite) != 'undefined') {\n                editor.plugins.lite.findPlugin(editor).acceptAll();\n                $textarea.parent().find(\"textarea.consolidated\").val(editor.getData());\n            }\n        });\n        $textarea.focus();\n    }\n\n    private setModifyable() {\n        let $modified = this.$paragraphs.filter(\".modified\");\n        if ($modified.length == 0) {\n            this.$paragraphs.addClass('modifyable');\n        } else {\n            this.$paragraphs.removeClass('modifyable');\n            $('input[name=modifiedParagraphNo]').val($modified.data(\"paragraph-no\"));\n            $('input[name=modifiedSectionId]').val($modified.parents(\".texteditorBox\").data(\"section-id\"));\n        }\n    }\n}\n"]}