{"version":3,"sources":["frontend/MotionMergeAmendments.ts"],"names":["MotionMergeChangeActions","removeEmptyParagraphs","$","each","i","el","childNodes","length","remove","accept","node","$node","hasClass","insertAccept","deleteAccept","reject","insertReject","deleteReject","$removeEl","name","nodeName","toLowerCase","parent","css","height","animate","$this","removeClass","removeAttr","children","replaceWith","html","MotionMergeChangeTooltip","$element","mouseX","mouseY","this","positionX","positionY","popover","container","animation","trigger","placement","$popover","window","setTimeout","width","elTop","offset","top","elHeight","content","getContent","bind","find","on","ev","stopPropagation","removePopupIfInactive","prototype","$myEl","cid","data","undefined","parents","first","addClass","$el","attr","__t","text","click","$list","console","log","alert","is","destroy","affectedChangesets","performActionWithUI","action","scrollX","scrollY","saveEditorSnapshot","call","focusTextarea","scrollTo","_this","MotionMergeConflictTooltip","currMouseX","title","Math","floor","left","$para","overflow","$parent","MotionMergeAmendmentsTextarea","$holder","rootObject","$textarea","edit","AntragsgruenEditor_1","AntragsgruenEditor","texteditor","getEditor","addSubmitListener","val","getData","prepareText","initializeTooltips","acceptAll","rejectAll","$text","appendHint","removeData","markupMovedParagraph","newText","setData","msg","paragraphNew","replace","target","MotionMergeAmendments","activePopup","currentTarget","pageX","pageY","fire","$form","textareas","offsetX","off","onLeavePage","initDraftSaving","cb","submit","setDraftDate","date","$draftSavingPanel","hide","options","year","month","day","hour","minute","hour12","lang","formatted","Intl","DateTimeFormat","format","saveDraft","sections","_i","_a","Object","getOwnPropertyNames","id","isPublic","prop","ajax","type","url","public","_csrf","success","ret","Date","error","initAutosavingDraft","$toggle","setInterval","localStorage","state","getItem","change","active","setItem","exports"],"mappings":"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","file":"MotionMergeAmendments.js","sourcesContent":["import {AntragsgruenEditor} from \"../shared/AntragsgruenEditor\";\nimport editor = CKEDITOR.editor;\n\nclass MotionMergeChangeActions {\n    public static removeEmptyParagraphs() {\n        $('.paragraphHolder').each((i, el) => {\n            if (el.childNodes.length == 0) {\n                $(el).remove();\n            }\n        });\n    }\n\n    public static accept(node: Element) {\n        let $node = $(node);\n        if ($node.hasClass(\"ice-ins\")) {\n            MotionMergeChangeActions.insertAccept(node);\n        }\n        if ($node.hasClass(\"ice-del\")) {\n            MotionMergeChangeActions.deleteAccept(node);\n        }\n    }\n\n    public static reject(node: Element) {\n        let $node = $(node);\n        if ($node.hasClass(\"ice-ins\")) {\n            MotionMergeChangeActions.insertReject($node);\n        }\n        if ($node.hasClass(\"ice-del\")) {\n            MotionMergeChangeActions.deleteReject($node);\n        }\n    }\n\n    public static insertReject($node: JQuery) {\n        let $removeEl: JQuery,\n            name = $node[0].nodeName.toLowerCase();\n        if (name == 'li') {\n            $removeEl = $node.parent();\n        } else {\n            $removeEl = $node;\n        }\n        if (name == 'ul' || name == 'ol' || name == 'li' || name == 'blockquote' || name == 'pre' || name == 'p') {\n            $removeEl.css(\"overflow\", \"hidden\").height($removeEl.height());\n            $removeEl.animate({\"height\": \"0\"}, 250, function () {\n                $removeEl.remove();\n                $(\".collidingParagraph:empty\").remove();\n                MotionMergeChangeActions.removeEmptyParagraphs();\n            });\n        } else {\n            $removeEl.remove();\n        }\n    }\n\n    public static insertAccept(node: Element) {\n        let $this: JQuery = $(node);\n        $this.removeClass(\"ice-cts ice-ins appendHint moved\");\n        $this.removeAttr(\"data-moving-partner data-moving-partner-id data-moving-partner-paragraph data-moving-msg\");\n        if (node.nodeName.toLowerCase() == 'ul' || node.nodeName.toLowerCase() == 'ol') {\n            $this.children().removeClass(\"ice-cts\").removeClass(\"ice-ins\").removeClass(\"appendHint\");\n        }\n        if (node.nodeName.toLowerCase() == 'li') {\n            $this.parent().removeClass(\"ice-cts\").removeClass(\"ice-ins\").removeClass(\"appendHint\");\n        }\n        if (node.nodeName.toLowerCase() == 'ins') {\n            $this.replaceWith($this.html());\n        }\n    }\n\n    public static deleteReject($node: JQuery) {\n        $node.removeClass(\"ice-cts ice-del appendHint\");\n        $node.removeAttr(\"data-moving-partner data-moving-partner-id data-moving-partner-paragraph data-moving-msg\");\n        let nodeName = $node[0].nodeName.toLowerCase();\n        if (nodeName == 'ul' || nodeName == 'ol') {\n            $node.children().removeClass(\"ice-cts\").removeClass(\"ice-del\").removeClass(\"appendHint\");\n        }\n        if (nodeName == 'li') {\n            $node.parent().removeClass(\"ice-cts\").removeClass(\"ice-del\").removeClass(\"appendHint\");\n        }\n        if (nodeName == 'del') {\n            $node.replaceWith($node.html());\n        }\n    }\n\n    public static deleteAccept(node: Element) {\n        let name = node.nodeName.toLowerCase(),\n            $removeEl: JQuery;\n        if (name == 'li') {\n            $removeEl = $(node).parent();\n        } else {\n            $removeEl = $(node);\n        }\n\n        if (name == 'ul' || name == 'ol' || name == 'li' || name == 'blockquote' || name == 'pre' || name == 'p') {\n            $removeEl.css(\"overflow\", \"hidden\").height($removeEl.height());\n            $removeEl.animate({\"height\": \"0\"}, 250, function () {\n                $removeEl.remove();\n                $(\".collidingParagraph:empty\").remove();\n                MotionMergeChangeActions.removeEmptyParagraphs();\n            });\n        } else {\n            $removeEl.remove();\n        }\n    }\n}\n\n\nclass MotionMergeChangeTooltip {\n    constructor(private $element, mouseX: number, mouseY: number, private parent: MotionMergeAmendmentsTextarea) {\n        let positionX: number = null,\n            positionY: number = null;\n        $element.popover({\n            'container': 'body',\n            'animation': false,\n            'trigger': 'manual',\n            'placement': function (popover) {\n                let $popover = $(popover);\n                window.setTimeout(() => {\n                    let width = $popover.width(),\n                        elTop = $element.offset().top,\n                        elHeight = $element.height();\n                    if (positionX === null && width > 0) {\n                        positionX = (mouseX - width / 2);\n                        positionY = mouseY + 10;\n                        if (positionY < (elTop + 19)) {\n                            positionY = elTop + 19;\n                        }\n                        if (positionY > elTop + elHeight) {\n                            positionY = elTop + elHeight;\n                        }\n                    }\n                    $popover.css(\"left\", positionX + \"px\");\n                    $popover.css(\"top\", positionY + \"px\");\n                }, 1);\n                return \"bottom\";\n            },\n            'html': true,\n            'content': this.getContent.bind(this)\n        });\n\n        $element.popover('show');\n        let $popover = $element.find(\"> .popover\");\n        $popover.on(\"mousemove\", (ev) => {\n            ev.stopPropagation();\n        });\n        window.setTimeout(this.removePopupIfInactive.bind(this), 1000);\n    }\n\n    private getContent() {\n        let $myEl = this.$element,\n            html,\n            cid = $myEl.data(\"cid\");\n        if (cid == undefined) {\n            cid = $myEl.parent().data(\"cid\");\n        }\n        $myEl.parents(\".texteditor\").first().find(\"[data-cid=\" + cid + \"]\").addClass(\"hover\");\n\n        html = '<div>';\n        html += '<button type=\"button\" class=\"accept btn btn-sm btn-default\"></button>';\n        html += '<button type=\"button\" class=\"reject btn btn-sm btn-default\"></button>';\n        html += '<a href=\"#\" class=\"btn btn-small btn-default opener\" target=\"_blank\"><span class=\"glyphicon glyphicon-new-window\"></span></a>';\n        html += '<div class=\"initiator\" style=\"font-size: 0.8em;\"></div>';\n        html += '</div>';\n        let $el: JQuery = $(html);\n        $el.find(\".opener\").attr(\"href\", $myEl.data(\"link\")).attr(\"title\", __t(\"merge\", \"title_open_in_blank\"));\n        $el.find(\".initiator\").text(__t(\"merge\", \"initiated_by\") + \": \" + $myEl.data(\"username\"));\n        if ($myEl.hasClass(\"ice-ins\")) {\n            $el.find(\"button.accept\").text(__t(\"merge\", \"change_accept\")).click(this.accept.bind(this));\n            $el.find(\"button.reject\").text(__t(\"merge\", \"change_reject\")).click(this.reject.bind(this));\n        } else if ($myEl.hasClass(\"ice-del\")) {\n            $el.find(\"button.accept\").text(__t(\"merge\", \"change_accept\")).click(this.accept.bind(this));\n            $el.find(\"button.reject\").text(__t(\"merge\", \"change_reject\")).click(this.reject.bind(this));\n        } else if ($myEl[0].nodeName.toLowerCase() == 'li') {\n            let $list = $myEl.parent();\n            if ($list.hasClass(\"ice-ins\")) {\n                $el.find(\"button.accept\").text(__t(\"merge\", \"change_accept\")).click(this.accept.bind(this));\n                $el.find(\"button.reject\").text(__t(\"merge\", \"change_reject\")).click(this.reject.bind(this));\n            } else if ($list.hasClass(\"ice-del\")) {\n                $el.find(\"button.accept\").text(__t(\"merge\", \"change_accept\")).click(this.accept.bind(this));\n                $el.find(\"button.reject\").text(__t(\"merge\", \"change_reject\")).click(this.reject.bind(this));\n            } else {\n                console.log(\"unknown\", $list);\n            }\n        } else {\n            console.log(\"unknown\", $myEl);\n            alert(\"unknown\");\n        }\n        return $el;\n    }\n\n    private removePopupIfInactive() {\n        if (this.$element.is(\":hover\")) {\n            return window.setTimeout(this.removePopupIfInactive.bind(this), 1000);\n        }\n        if ($(\"body\").find(\".popover:hover\").length > 0) {\n            return window.setTimeout(this.removePopupIfInactive.bind(this), 1000);\n        }\n        this.destroy();\n    }\n\n    private affectedChangesets() {\n        let cid = this.$element.data(\"cid\");\n        if (cid == undefined) {\n            cid = this.$element.parent().data(\"cid\");\n        }\n        return this.$element.parents(\".texteditor\").find(\"[data-cid=\" + cid + \"]\");\n    }\n\n    private performActionWithUI(action) {\n        let scrollX = window.scrollX,\n            scrollY = window.scrollY;\n\n        this.parent.saveEditorSnapshot();\n        this.destroy();\n        action.call(this);\n        $(\".collidingParagraph:empty\").remove();\n        this.parent.focusTextarea();\n\n        window.scrollTo(scrollX, scrollY);\n    }\n\n    private accept() {\n        this.performActionWithUI(() => {\n            this.affectedChangesets().each((i, el) => {\n                MotionMergeChangeActions.accept(el);\n            });\n        });\n    }\n\n    private reject() {\n        this.performActionWithUI(() => {\n            this.affectedChangesets().each((i, el) => {\n                MotionMergeChangeActions.reject(el);\n            });\n        });\n    }\n\n    public destroy() {\n        this.$element.popover(\"hide\").popover(\"destroy\");\n\n        let cid = this.$element.data(\"cid\");\n        if (cid == undefined) {\n            cid = this.$element.parent().data(\"cid\");\n        }\n        this.$element.parents(\".texteditor\").first().find(\"[data-cid=\" + cid + \"]\").removeClass(\"hover\");\n    }\n}\n\nclass MotionMergeConflictTooltip {\n    constructor(private $element, currMouseX, private parent: MotionMergeAmendmentsTextarea) {\n        $element.popover({\n            'container': 'body',\n            'animation': false,\n            'trigger': 'manual',\n            'placement': 'bottom',\n            'html': true,\n            'title': __t(\"merge\", \"colliding_title\"),\n            'content': this.getContent.bind(this)\n        });\n        $element.popover('show');\n\n        let $popover = $(\"body > .popover\"),\n            width = $popover.width();\n        $popover.css(\"left\", Math.floor($element.offset().left + currMouseX - (width / 2) + 20) + \"px\");\n        $popover.on(\"mousemove\", function (ev) {\n            ev.stopPropagation();\n        });\n        window.setTimeout(this.removePopupIfInactive.bind(this), 500);\n    }\n\n    private removePopupIfInactive() {\n        if (this.$element.is(\":hover\")) {\n            return window.setTimeout(this.removePopupIfInactive.bind(this), 1000);\n        }\n        if ($(\"body\").find(\".popover:hover\").length > 0) {\n            return window.setTimeout(this.removePopupIfInactive.bind(this), 1000);\n        }\n        this.destroy();\n    }\n\n    private performActionWithUI(action) {\n        this.parent.saveEditorSnapshot();\n        this.destroy();\n        action.call(this);\n        $(\".collidingParagraph:empty\").remove();\n        this.parent.focusTextarea();\n    }\n\n\n    private getContent() {\n        let $this = this.$element,\n            html = '<div style=\"white-space: nowrap;\"><button type=\"button\" class=\"btn btn-small btn-default delTitle\">' +\n                '<span style=\"text-decoration: line-through\">' + __t(\"merge\", \"title\") + '</span></button>';\n        html += '<button type=\"button\" class=\"reject btn btn-small btn-default\"><span class=\"glyphicon glyphicon-trash\"></span></button>';\n        html += '<a href=\"#\" class=\"btn btn-small btn-default opener\" target=\"_blank\"><span class=\"glyphicon glyphicon-new-window\"></span></a>';\n        html += '<div class=\"initiator\" style=\"font-size: 0.8em;\"></div>';\n        html += '</div>';\n        let $el = $(html);\n        $el.find(\".delTitle\").attr(\"title\", __t(\"merge\", \"title_del_title\"));\n        $el.find(\".reject\").attr(\"title\", __t(\"merge\", \"title_del_colliding\"));\n        $el.find(\"a.opener\").attr(\"href\", $this.find(\"a\").attr(\"href\")).attr(\"title\", __t(\"merge\", \"title_open_in_blank\"));\n        $el.find(\".initiator\").text(__t(\"merge\", \"initiated_by\") + \": \" + $this.parents(\".collidingParagraph\").data(\"username\"));\n        $el.find(\".reject\").click(() => {\n            this.performActionWithUI.call(this, () => {\n                let $para = $this.parents(\".collidingParagraph\");\n                $para.css({\"overflow\": \"hidden\"}).height($para.height());\n                $para.animate({\"height\": \"0\"}, 250, function () {\n                    let $parent = $para.parents(\".paragraphHolder\");\n                    $para.remove();\n                    if ($parent.find(\".collidingParagraph\").length == 0) {\n                        $parent.removeClass(\"hasCollissions\");\n                    }\n                });\n            });\n        });\n        $el.find(\".delTitle\").click(() => {\n            this.performActionWithUI.call(this, () => {\n                let $para = $this.parents(\".collidingParagraph\");\n                $this.remove();\n                $para.removeClass(\"collidingParagraph\");\n                let $parent = $para.parents(\".paragraphHolder\");\n                if ($parent.find(\".collidingParagraph\").length == 0) {\n                    $parent.removeClass(\"hasCollissions\");\n                }\n            });\n        });\n        return $el;\n    }\n\n    public destroy() {\n        let cid = this.$element.data(\"cid\");\n        if (cid == undefined) {\n            cid = this.$element.parent().data(\"cid\");\n        }\n        this.$element.parents(\".texteditor\").first().find(\"[data-cid=\" + cid + \"]\").removeClass(\"hover\");\n\n        this.$element.popover(\"hide\").popover(\"destroy\");\n    }\n}\n\nclass MotionMergeAmendmentsTextarea {\n    private texteditor: editor;\n\n    private prepareText() {\n        let $text = $('<div>' + this.texteditor.getData() + '</div>');\n\n        // Move the amendment-Data from OL's and UL's to their list items\n        $text.find(\"ul.appendHint, ol.appendHint\").each((i, el) => {\n            let $this = $(el),\n                appendHint = $this.data(\"append-hint\");\n            $this.find(\"> li\").addClass(\"appendHint\").attr(\"data-append-hint\", appendHint)\n                .attr(\"data-link\", $this.data(\"link\"))\n                .attr(\"data-username\", $this.data(\"username\"));\n            $this.removeClass(\"appendHint\").removeData(\"append-hint\");\n        });\n\n        // Remove double markup\n        $text.find(\".moved .moved\").removeClass('moved');\n        $text.find(\".moved\").each(this.markupMovedParagraph.bind(this));\n\n        // Add hints about starting / ending collissions\n        $text.find(\".hasCollissions\")\n            .attr(\"data-collission-start-msg\", __t('merge', 'colliding_start'))\n            .attr(\"data-collission-end-msg\", __t('merge', 'colliding_end'));\n\n        let newText = $text.html();\n        this.texteditor.setData(newText);\n    }\n\n    private markupMovedParagraph(i, el) {\n        let $node = $(el),\n            paragraphNew = $node.data('moving-partner-paragraph'),\n            msg: string;\n\n        if ($node.hasClass('inserted')) {\n            msg = __t('std', 'moved_paragraph_from');\n        } else {\n            msg = __t('std', 'moved_paragraph_to');\n        }\n        msg = msg.replace(/##PARA##/, (paragraphNew + 1));\n\n        if ($node[0].nodeName === 'LI') {\n            $node = $node.parent();\n        }\n\n        $node.attr(\"data-moving-msg\", msg);\n    }\n\n    private initializeTooltips() {\n        this.$holder.on('mouseover', '.collidingParagraphHead', (ev) => {\n            $(ev.target).parents(\".collidingParagraph\").addClass(\"hovered\");\n\n            if (MotionMergeAmendments.activePopup) {\n                MotionMergeAmendments.activePopup.destroy();\n            }\n            MotionMergeAmendments.activePopup = new MotionMergeConflictTooltip(\n                $(ev.currentTarget), MotionMergeAmendments.currMouseX, this\n            );\n        }).on('mouseout', '.collidingParagraphHead', (ev) => {\n            $(ev.target).parents(\".collidingParagraph\").removeClass(\"hovered\");\n        });\n\n        this.$holder.on(\"mouseover\", \".appendHint\", (ev) => {\n            if (MotionMergeAmendments.activePopup) {\n                MotionMergeAmendments.activePopup.destroy();\n            }\n            MotionMergeAmendments.activePopup = new MotionMergeChangeTooltip(\n                $(ev.currentTarget), ev.pageX, ev.pageY, this\n            );\n        });\n    }\n\n    private acceptAll() {\n        this.texteditor.fire('saveSnapshot');\n        this.$holder.find(\".collidingParagraph\").each((i, el) => {\n            let $this = $(el);\n            $this.find(\".collidingParagraphHead\").remove();\n            $this.replaceWith($this.children());\n        });\n        this.$holder.find(\".ice-ins\").each((i, el) => {\n            MotionMergeChangeActions.insertAccept(el);\n        });\n        this.$holder.find(\".ice-del\").each((i, el) => {\n            MotionMergeChangeActions.deleteAccept(el);\n        });\n    }\n\n    private rejectAll() {\n        this.texteditor.fire('saveSnapshot');\n        this.$holder.find(\".collidingParagraph\").each((i, el) => {\n            $(el).remove();\n        });\n        this.$holder.find(\".ice-ins\").each((i, el) => {\n            MotionMergeChangeActions.insertReject($(el));\n        });\n        this.$holder.find(\".ice-del\").each((i, el) => {\n            MotionMergeChangeActions.deleteReject($(el));\n        });\n    }\n\n    public saveEditorSnapshot() {\n        this.texteditor.fire('saveSnapshot');\n    }\n\n    public focusTextarea() {\n        //this.$holder.find(\".texteditor\").focus();\n        // This lead to strange cursor behavior, e.g. when removing a colliding paragraph\n    }\n\n    public getContent(): string {\n        return this.texteditor.getData();\n    }\n\n    constructor(private $holder: JQuery, private rootObject: MotionMergeAmendments) {\n        let $textarea = $holder.find(\".texteditor\");\n        let edit = new AntragsgruenEditor($textarea.attr(\"id\"));\n        this.texteditor = edit.getEditor();\n        this.rootObject.addSubmitListener(() => {\n            $holder.find(\"textarea.raw\").val(this.texteditor.getData());\n            $holder.find(\"textarea.consolidated\").val(this.texteditor.getData());\n        });\n\n        this.prepareText();\n        this.initializeTooltips();\n\n        this.$holder.find(\".acceptAllChanges\").click(this.acceptAll.bind(this));\n        this.$holder.find(\".rejectAllChanges\").click(this.rejectAll.bind(this));\n    }\n}\n\nexport class MotionMergeAmendments {\n    public static activePopup: MotionMergeChangeTooltip | MotionMergeConflictTooltip = null;\n    public static currMouseX: number = null;\n\n    public $draftSavingPanel: JQuery;\n    private textareas: { [id: string]: MotionMergeAmendmentsTextarea } = {};\n\n    constructor(private $form: JQuery) {\n        $(\".wysiwyg-textarea\").each((i, el) => {\n            let $el = $(el);\n            this.textareas[$el.attr(\"id\")] = new MotionMergeAmendmentsTextarea($el, this);\n            $el.on(\"mousemove\", (ev) => {\n                MotionMergeAmendments.currMouseX = ev.offsetX;\n            });\n        });\n\n        this.$form.on(\"submit\", () => {\n            $(window).off(\"beforeunload\", MotionMergeAmendments.onLeavePage);\n        });\n        $(window).on(\"beforeunload\", MotionMergeAmendments.onLeavePage);\n\n        this.initDraftSaving();\n    }\n\n    public static onLeavePage(): string {\n        return __t(\"std\", \"leave_changed_page\");\n    }\n\n    public addSubmitListener(cb) {\n        this.$form.submit(cb);\n    }\n\n    private setDraftDate(date: Date) {\n        this.$draftSavingPanel.find(\".lastSaved .none\").hide();\n\n        let options = {\n                year: 'numeric', month: 'numeric', day: 'numeric',\n                hour: 'numeric', minute: 'numeric',\n                hour12: false\n            },\n            lang: string = $(\"html\").attr(\"lang\"),\n            formatted = new Intl.DateTimeFormat(lang, options).format(date);\n\n        this.$draftSavingPanel.find(\".lastSaved .value\").text(formatted);\n    }\n\n    private saveDraft() {\n        let sections = {};\n        for (let id of Object.getOwnPropertyNames(this.textareas)) {\n            sections[id.replace('section_holder_', '')] = this.textareas[id].getContent();\n        }\n        let isPublic: boolean = this.$draftSavingPanel.find('input[name=public]').prop('checked');\n\n        $.ajax({\n            type: \"POST\",\n            url: this.$form.data('draftSaving'),\n            data: {\n                'public': (isPublic ? 1 : 0),\n                'sections': sections,\n                '_csrf': this.$form.find('> input[name=_csrf]').val()\n            },\n            success: (ret) => {\n                if (ret['success']) {\n                    this.$draftSavingPanel.find('.savingError').addClass('hidden');\n                    this.setDraftDate(new Date(ret['date']));\n                    if (isPublic) {\n                        this.$form.find('.publicLink').removeClass('hidden');\n                    } else {\n                        this.$form.find('.publicLink').addClass('hidden');\n                    }\n                } else {\n                    this.$draftSavingPanel.find('.savingError').removeClass('hidden');\n                    this.$draftSavingPanel.find('.savingError .errorNetwork').addClass('hidden');\n                    this.$draftSavingPanel.find('.savingError .errorHolder').text(ret['error']).removeClass('hidden');\n                }\n            },\n            error: () => {\n                this.$draftSavingPanel.find('.savingError').removeClass('hidden');\n                this.$draftSavingPanel.find('.savingError .errorNetwork').removeClass('hidden');\n                this.$draftSavingPanel.find('.savingError .errorHolder').text('').addClass('hidden');\n            }\n        });\n    }\n\n    private initAutosavingDraft() {\n        let $toggle: JQuery = this.$draftSavingPanel.find('input[name=autosave]');\n\n        window.setInterval(() => {\n            if ($toggle.prop('checked')) {\n                this.saveDraft();\n            }\n        }, 5000);\n\n        if (localStorage) {\n            let state = localStorage.getItem('merging-draft-auto-save');\n            if (state !== null) {\n                $toggle.prop('checked', (state == '1'));\n            }\n        }\n        $toggle.change(() => {\n            let active: boolean = $toggle.prop('checked');\n            if (localStorage) {\n                localStorage.setItem('merging-draft-auto-save', (active ? '1' : '0'));\n            }\n        }).trigger('change');\n    }\n\n    private initDraftSaving() {\n        this.$draftSavingPanel = this.$form.find('#draftSavingPanel');\n        this.$draftSavingPanel.find('.saveDraft').on('click', this.saveDraft.bind(this));\n        this.$draftSavingPanel.find('input[name=public]').on('change', this.saveDraft.bind(this));\n        this.initAutosavingDraft();\n\n        if (this.$draftSavingPanel.data(\"resumed-date\")) {\n            let date = new Date(this.$draftSavingPanel.data(\"resumed-date\"));\n            this.setDraftDate(date);\n        }\n\n        $(\"#yii-debug-toolbar\").remove();\n    }\n}\n"]}