{"version":3,"sources":["frontend/MotionMergeAmendmentsPublic.js","frontend/MotionMergeAmendmentsPublic.ts"],"names":["define","require","exports","Object","defineProperty","value","MotionMergeAmendmentsPublic","constructor","$widget","this","interval","initUpdateWidget","showUpdated","$updated","$updateWidget","find","addClass","window","setTimeout","removeClass","setContentEvents","$draftContent","each","i","el","$el","$","amendmentId","data","undefined","parents","first","reload","showMsg","get","updateUrl","success","$dateField","text","date","html","alert","error","startInterval","setInterval","bind","stopInterval","clearInterval","$toggle","localStorage","state","getItem","prop","on","active","setItem","trigger"],"mappings":"AAAAA,OAAO,CAAC,UAAW,YAAY,SAAUC,EAASC,GAC9C,aACAC,OAAOC,eAAeF,EAAS,aAAc,CAAEG,OAAO,IACtDH,EAAQI,iCAA8B,ECI1CJ,EAAAI,4BAAA,MAOI,WAAAC,CAAmBC,GAAAC,KAAAD,QAAAA,EAFXC,KAAAC,SAAmB,KAGvBD,KAAKE,kBACT,CAEQ,WAAAC,GACJ,IAAIC,EAAWJ,KAAKK,cAAcC,KAAK,YACvCF,EAASG,SAAS,UAClBC,OAAOC,YAAW,KACdL,EAASM,YAAY,SAAS,GAC/B,IACP,CAEQ,gBAAAC,GACJX,KAAKY,cAAcN,KAAK,eAAeO,MAAK,CAACC,EAAGC,KAC5C,IAAIC,EAAMC,EAAEF,GACRG,EAAcF,EAAIG,KAAK,qBACPC,IAAhBF,IACAF,EAAMA,EAAIK,QAAQ,uBAAuBC,QACzCJ,EAAcF,EAAIG,KAAK,iBAEvBD,IACAF,EAAIT,SAAS,wBACbS,EAAIG,KAAK,cAAe,KACxBH,EAAIG,KAAK,MAAOH,EAAIG,KAAK,QAAU,cACnCH,EAAIG,KAAK,YAAa,UAC1B,GAER,CAEQ,MAAAI,CAAOC,GACXP,EAAEQ,IAAIzB,KAAK0B,WAAYP,IACdA,EAAKQ,SAIV3B,KAAK4B,WAAWC,KAAKV,EAAKW,MAC1B9B,KAAKY,cAAcmB,KAAKZ,EAAKY,MAC7B/B,KAAKW,mBACDa,GACAxB,KAAKG,eAPL6B,MAAMb,EAAKc,MAQf,GAER,CAEQ,aAAAC,GACkB,OAAlBlC,KAAKC,WAGTD,KAAKC,SAAWO,OAAO2B,YAAYnC,KAAKuB,OAAOa,KAAKpC,MAAM,GAAQ,KACtE,CAEQ,YAAAqC,GACkB,OAAlBrC,KAAKC,WAGTO,OAAO8B,cAActC,KAAKC,UAC1BD,KAAKC,SAAW,KACpB,CAEQ,gBAAAC,GACJF,KAAKK,cAAgBL,KAAKD,QAAQO,KAAK,uBACvCN,KAAKY,cAAgBZ,KAAKD,QAAQO,KAAK,iBACvCN,KAAK4B,WAAa5B,KAAKD,QAAQO,KAAK,mBACpCN,KAAK0B,UAAY1B,KAAKD,QAAQoB,KAAK,cACnCnB,KAAKW,mBAEL,IAAI4B,EAAUvC,KAAKK,cAAcC,KAAK,qBACtC,GAAIkC,aAAc,CACd,IAAIC,EAAQD,aAAaE,QAAQ,6BACnB,OAAVD,GACAF,EAAQI,KAAK,UAAqB,KAATF,EAEjC,CACAF,EAAQK,GAAG,UAAU,KACjB,IAAIC,EAAkBN,EAAQI,KAAK,WAC/BH,cACAA,aAAaM,QAAQ,4BAA8BD,EAAS,IAAM,KAElEA,EACA7C,KAAKkC,gBAELlC,KAAKqC,cACT,IACDU,QAAQ,UAEX/C,KAAKK,cAAcC,KAAK,cAAcsC,GAAG,QAAS5C,KAAKuB,OAAOa,KAAKpC,MAAM,GAC7E,EDZJ","file":"MotionMergeAmendmentsPublic.js","sourcesContent":[null,"interface ReloadResult {\n    success: boolean;\n    error?: string;\n    html?: string;\n    date?: string;\n}\n\nexport class MotionMergeAmendmentsPublic {\n    private $updateWidget: JQuery;\n    private updateUrl: string;\n    private $draftContent: JQuery;\n    private $dateField: JQuery;\n    private interval: number = null;\n\n    constructor(public $widget: JQuery) {\n        this.initUpdateWidget();\n    }\n\n    private showUpdated() {\n        let $updated = this.$updateWidget.find('.updated');\n        $updated.addClass('active');\n        window.setTimeout(() => {\n            $updated.removeClass('active');\n        }, 2000);\n    }\n\n    private setContentEvents() {\n        this.$draftContent.find(\".appendHint\").each((i, el) => {\n            let $el = $(el),\n                amendmentId = $el.data(\"amendment-id\");\n            if (amendmentId === undefined) {\n                $el = $el.parents(\"[data-amendment-id]\").first();\n                amendmentId = $el.data(\"amendment-id\");\n            }\n            if (amendmentId) {\n                $el.addClass(\"amendmentAjaxTooltip\");\n                $el.data(\"initialized\", \"0\");\n                $el.data(\"url\", $el.data(\"link\") + \"/ajax-diff\");\n                $el.data(\"placement\", \"bottom\");\n            }\n        });\n    }\n\n    private reload(showMsg: boolean) {\n        $.get(this.updateUrl, (data: ReloadResult) => {\n            if (!data.success) {\n                alert(data.error);\n                return;\n            }\n            this.$dateField.text(data.date);\n            this.$draftContent.html(data.html);\n            this.setContentEvents();\n            if (showMsg) {\n                this.showUpdated();\n            }\n        });\n    }\n\n    private startInterval() {\n        if (this.interval !== null) {\n            return;\n        }\n        this.interval = window.setInterval(this.reload.bind(this, false), 5000);\n    }\n\n    private stopInterval() {\n        if (this.interval === null) {\n            return;\n        }\n        window.clearInterval(this.interval);\n        this.interval = null;\n    }\n\n    private initUpdateWidget() {\n        this.$updateWidget = this.$widget.find('.motionUpdateWidget');\n        this.$draftContent = this.$widget.find('.draftContent');\n        this.$dateField = this.$widget.find('.mergeDraftDate');\n        this.updateUrl = this.$widget.data('reload-url');\n        this.setContentEvents();\n\n        let $toggle = this.$updateWidget.find('#autoUpdateToggle');\n        if (localStorage) {\n            let state = localStorage.getItem('merging-draft-auto-update');\n            if (state !== null) {\n                $toggle.prop('checked', (state == '1'));\n            }\n        }\n        $toggle.on(\"change\", () => {\n            let active: boolean = $toggle.prop('checked');\n            if (localStorage) {\n                localStorage.setItem('merging-draft-auto-update', (active ? '1' : '0'));\n            }\n            if (active) {\n                this.startInterval();\n            } else {\n                this.stopInterval();\n            }\n        }).trigger('change');\n\n        this.$updateWidget.find('#updateBtn').on(\"click\", this.reload.bind(this, true));\n    }\n}\n"]}