define(["require","exports","../shared/AntragsgruenEditor"],(function(i,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});new class{constructor(){this.editors=[],this.collisionEditors={},this.$form=$("#amendmentMergeForm"),this.$collisionHolder=$(".amendmentCollisionsHolder"),this.$checkCollisions=$(".checkAmendmentCollisions"),this.$affectedParagraphs=$(".affectedParagraphs > .paragraph"),this.$otherStatsFields=$(".otherAmendmentStatus select"),this.$stepWizardHolder=$("#MergeSingleWizard").find(".steps"),this.$steps={1:this.$form.find("> .step_1"),2:this.$form.find("> .step_2"),3:this.$form.find("> .step_3")},this.$checkCollisions.on("click",(i=>{i.preventDefault(),this.loadCollisions()})),this.$steps[1].find(".goto_2").on("click",(i=>{i.preventDefault(),this.gotoStep("2")})),this.$affectedParagraphs.each(((i,e)=>{this.initAffectedParagraph(e)})),this.$form.on("submit",this.onSubmit.bind(this)),this.gotoStep("1")}gotoStep(i){for(let e in this.$steps)e==i?this.$steps[e].removeClass("hidden"):this.$steps[e].addClass("hidden");this.$stepWizardHolder.children().removeClass("active"),this.$stepWizardHolder.find(".goto_step"+i).addClass("active"),this.$stepWizardHolder.scrollintoview({top_offset:-50})}initAffectedParagraph(i){let e=$(i);e.find(".versionSelector input").on("change",(()=>{"modified"==e.find(".versionSelector input:checked").val()?e.removeClass("originalVersion").addClass("modifiedVersion"):e.addClass("originalVersion").removeClass("modifiedVersion")})).trigger("change"),e.find(".modifySelector input").on("change",(()=>{e.find(".modifySelector input").prop("checked")?e.addClass("changed").removeClass("unchanged"):e.removeClass("changed").addClass("unchanged")})).trigger("change");let d=e.data("section-id")+"_"+e.data("paragraph-no");e.find(".originalVersion.modifyText").length>0&&(this.editors[d+"_original"]=new t.AntragsgruenEditor(e.find(".originalVersion.modifyText > .texteditor").attr("id"))),e.find(".modifiedVersion.modifyText").length>0&&(this.editors[d+"_modified"]=new t.AntragsgruenEditor(e.find(".modifiedVersion.modifyText > .texteditor").attr("id")))}loadCollisions(){this.gotoStep("3");let i=this.$checkCollisions.data("url"),e={},t={};this.$affectedParagraphs.each(((i,t)=>{let d,s=$(t),o=s.find(".versionSelector input:checked").val(),a=s.find(".modifySelector input").prop("checked"),n=s.data("section-id"),r=s.data("paragraph-no");if(a){const i=n+"_"+r+("modified"===o?"_modified":"_original");let e=this.editors[i].getEditor(),t=e.getData();void 0!==e.plugins.lite?(e.plugins.lite.findPlugin(e).acceptAll(),d=e.getData(),e.setData(t)):d=e.getData()}else d="modified"===o?s.data("modified-amendment"):s.data("unchanged-amendment");void 0===e[s.data("section-id")]&&(e[s.data("section-id")]={}),e[s.data("section-id")][s.data("paragraph-no")]=d})),this.$otherStatsFields.each(((i,e)=>{let d=$(e);t[d.data("amendment-id")]=d.val()})),$.post(i,{newSections:e,otherAmendmentsStatus:t,_csrf:this.$form.find("> input[name=_csrf]").val()},this.collisionsLoaded.bind(this))}collisionsLoaded(i){this.collisionEditors={},this.$collisionHolder.html(i);let e=this.$collisionHolder.find(".amendmentOverrideBlock > .texteditor");e.length>0&&e.each(((i,e)=>{let d=$(e).attr("id");this.collisionEditors[d]=new t.AntragsgruenEditor(d)}))}onSubmit(){this.$affectedParagraphs.each(((i,e)=>{let t=$(e),d=t.find(".versionSelector input:checked").val(),s=t.find(".modifySelector input").prop("checked"),o=t.find(".modifiedText");if(s){let i=t.data("section-id")+"_"+t.data("paragraph-no")+("modified"===d?"_modified":"_original"),e=this.editors[i].getEditor();void 0!==e.plugins.lite&&e.plugins.lite.findPlugin(e).acceptAll(),o.val(e.getData())}else"modified"===d?o.val(t.data("modified-amendment")):o.val(t.data("unchanged-amendment"))}));for(let i in this.collisionEditors){let e=this.collisionEditors[i].getEditor();void 0!==e.plugins.lite&&e.plugins.lite.findPlugin(e).acceptAll();let t=e.getData();$("#"+i).parents(".amendmentOverrideBlock").first().find("> textarea").val(t)}}}}));
//# sourceMappingURL=MergeSingleAmendment.js.map
