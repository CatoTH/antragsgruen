import{DraftSavingEngine}from"../shared/DraftSavingEngine";import{AntragsgruenEditor}from"../shared/AntragsgruenEditor";export class MotionEditForm{constructor(e){this.$form=e,this.hasChanged=!1,$(".input-group.date").datetimepicker({locale:$("html").attr("lang"),format:"L"}),$(".wysiwyg-textarea").each(this.initWysiwyg.bind(this)),$(".form-group.plain-text").each(this.initPlainTextFormGroup.bind(this));let t=$("#draftHint"),a=t.data("motion-type"),i=t.data("motion-id");new DraftSavingEngine(e,t,"motion_"+a+"_"+i),e.on("submit",t=>{this.onSubmitCheck(t,e)})}onSubmitCheck(e,t){let a=!1;if(this.checkMultipleTagsError()&&(a=!0),a)e.preventDefault();else{const a=this.getEncouragedFieldError(t);a?(e.preventDefault(),bootbox.dialog({title:a.field.data("encouraged-title"),message:a.field.data("encouraged-str"),buttons:{submit:{label:a.field.data("encouraged-submit"),callback:function(){a.field.data("skip-encouraged-fields",!0),t.append('<input type="hidden" name="save" value="1">'),t.trigger("submit")}},fill:{label:a.field.data("encouraged-fill"),callback:function(){a.field.scrollintoview({top_offset:-50})}}}})):$(window).off("beforeunload",MotionEditForm.onLeavePage)}}getEncouragedFieldError(e){let t=null;return e.find(".wysiwyg-textarea").each(function(){const e=$(this),a=e.find("label.encouraged");if(0===a.length)return;const i=e.find("textarea").val().trim();i&&"<p></p>"!==i&&"&nbsp;"!==i||a.data("skip-encouraged-fields")||(t={field:a,error:a.data("encouraged-str")})}),t}checkMultipleTagsError(){let e=this.$form.find(".multipleTagsGroup");return 0!==e.length&&(this.$form.find(".multipleTagsGroup input[type=checkbox]").length||e.find("input:checked").length>0?(e.removeClass("has-error"),!1):(e.addClass("has-error"),e.scrollintoview({top_offset:-50}),!0))}static onLeavePage(){return __t("std","leave_changed_page")}initWysiwyg(e,t){let a=$(t).find(".texteditor"),i=new AntragsgruenEditor(a.attr("id"));a.parents("form").on("submit",()=>{a.parent().find("textarea").val(i.getEditor().getData())}),i.getEditor().on("change",()=>{this.hasChanged||(this.hasChanged=!0,$("body").hasClass("testing")||$(window).on("beforeunload",MotionEditForm.onLeavePage))})}initPlainTextFormGroup(e,t){let a=$(t),i=a.find("input.form-control");if(0!=a.data("max-len")){let e=a.data("max-len"),t=!1,n=a.find(".maxLenTooLong"),r=a.parents("form").first().find("button[type=submit]"),o=a.find(".maxLenHint .counter");e<0&&(t=!0,e*=-1),i.on("keyup change",()=>{let a=i.val().length;o.text(a),a>e?(n.removeClass("hidden"),t||r.prop("disabled",!0)):(n.addClass("hidden"),t||r.prop("disabled",!1))}).trigger("change")}}}
//# sourceMappingURL=MotionEditForm.js.map
