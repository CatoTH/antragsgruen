define(["require","exports","../shared/DraftSavingEngine","../shared/AntragsgruenEditor"],(function(e,t,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MotionEditForm=void 0;class n{constructor(e){this.$form=e,this.hasChanged=!1,$(".input-group.date").datetimepicker({locale:$("html").attr("lang"),format:"L"}),$(".wysiwyg-textarea").each(this.initWysiwyg.bind(this)),$(".form-group.plain-text").each(this.initPlainTextFormGroup.bind(this));let t=$("#draftHint"),a=t.data("motion-type"),n=t.data("motion-id");new i.DraftSavingEngine(e,t,"motion_"+a+"_"+n),e.on("submit",(t=>{this.onSubmitCheck(t,e)}))}onSubmitCheck(e,t){let i=!1;if(this.checkMultipleTagsError()&&(i=!0),i)e.preventDefault();else{const i=this.getEncouragedFieldError(t);i?(e.preventDefault(),bootbox.dialog({title:i.field.data("encouraged-title"),message:i.field.data("encouraged-str"),buttons:{submit:{label:i.field.data("encouraged-submit"),callback:function(){i.field.data("skip-encouraged-fields",!0),t.append('<input type="hidden" name="save" value="1">'),t.trigger("submit")}},fill:{label:i.field.data("encouraged-fill"),callback:function(){i.field.scrollintoview({top_offset:-50})}}}})):$(window).off("beforeunload",n.onLeavePage)}}getEncouragedFieldError(e){let t=null;return e.find(".wysiwyg-textarea").each((function(){const e=$(this),i=e.find("label.encouraged");if(0===i.length)return;const a=e.find("textarea").val().trim();a&&"<p></p>"!==a&&"&nbsp;"!==a||i.data("skip-encouraged-fields")||(t={field:i,error:i.data("encouraged-str")})})),t}checkMultipleTagsError(){let e=this.$form.find(".multipleTagsGroup");return 0!==e.length&&(this.$form.find(".multipleTagsGroup input[type=checkbox]").length||e.find("input:checked").length>0?(e.removeClass("has-error"),!1):(e.addClass("has-error"),e.scrollintoview({top_offset:-50}),!0))}static onLeavePage(){return __t("std","leave_changed_page")}initWysiwyg(e,t){let i=$(t).find(".texteditor"),r=new a.AntragsgruenEditor(i.attr("id"));i.parents("form").on("submit",(()=>{i.parent().find("textarea").val(r.getEditor().getData())})),r.getEditor().on("change",(()=>{this.hasChanged||(this.hasChanged=!0,$("body").hasClass("testing")||$(window).on("beforeunload",n.onLeavePage))}))}initPlainTextFormGroup(e,t){let i=$(t),a=i.find("input.form-control");if(0!=i.data("max-len")){let e=i.data("max-len"),t=!1,n=i.find(".maxLenTooLong"),r=i.parents("form").first().find("button[type=submit]"),o=i.find(".maxLenHint .counter");e<0&&(t=!0,e*=-1),a.on("keyup change",(()=>{let i=a.val().length;o.text(i),i>e?(n.removeClass("hidden"),t||r.prop("disabled",!0)):(n.addClass("hidden"),t||r.prop("disabled",!1))})).trigger("change")}}}t.MotionEditForm=n}));
//# sourceMappingURL=MotionEditForm.js.map
