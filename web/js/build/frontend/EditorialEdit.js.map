{"version":3,"sources":["frontend/EditorialEdit.js","frontend/EditorialEdit.ts"],"names":["__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","define","require","exports","AntragsgruenEditor_1","Object","defineProperty","EditorialEdit","constructor","_","form","addEventListener","preventDefault","saveRow","querySelector","textHolder","editCaller","metadataEdit","metadataView","editCalled","bind","save","ev","setAttribute","editor","AntragsgruenEditor","getAttribute","focus","classList","add","remove","postData","data","getEditor","getData","author","updateDate","checked","csrf","$","ajax","url","type","JSON","stringify","processData","contentType","dataType","headers","success","ret","window","setTimeout","destroyInstanceById","innerHTML","alert","catch","err","responseText"],"mappings":"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","file":"EditorialEdit.js","sourcesContent":[null,"import { AntragsgruenEditor } from '../shared/AntragsgruenEditor';\n\nexport class EditorialEdit {\n    private readonly editCaller: HTMLDivElement;\n    private readonly textHolder: HTMLDivElement;\n    private readonly metadataView: HTMLDivElement;\n    private readonly metadataEdit: HTMLDivElement;\n    private readonly saveRow: HTMLDivElement;\n    private editor: AntragsgruenEditor;\n\n    constructor(_, private form: HTMLFormElement) {\n        this.form.addEventListener('submit', e => e.preventDefault()); // necessary for IE11\n\n        this.saveRow = this.form.querySelector('.saveRow');\n        this.textHolder = this.form.querySelector('.textHolder');\n        this.editCaller = this.form.querySelector('.editCaller');\n        this.metadataEdit = this.form.querySelector('.metadataEdit');\n        this.metadataView = this.form.querySelector('.metadataView');\n\n        this.editCaller.addEventListener('click', this.editCalled.bind(this));\n        this.saveRow.querySelector('button').addEventListener('click', this.save.bind(this));\n    }\n\n    private editCalled(ev) {\n        ev.preventDefault();\n        this.textHolder.setAttribute('contenteditable', \"true\");\n        this.editor = new AntragsgruenEditor(this.textHolder.getAttribute(\"id\"));\n        this.textHolder.focus();\n\n        this.editCaller.classList.add('hidden');\n        this.saveRow.classList.remove('hidden');\n        this.metadataView.classList.add('hidden');\n        this.metadataEdit.classList.remove('hidden');\n    }\n\n    private async save(ev) {\n        ev.preventDefault();\n        let postData = {\n            'data': this.editor.getEditor().getData(),\n            'author': (this.metadataEdit.querySelector('.author') as HTMLInputElement).value,\n            'updateDate': ((this.metadataEdit.querySelector('.updateDate') as HTMLInputElement).checked ? 1 : 0),\n        };\n        const csrf = (this.form.querySelector('input[name=_csrf]') as HTMLInputElement).value;\n\n        $.ajax({\n            url: this.form.getAttribute('action'),\n            type: \"POST\",\n            data: JSON.stringify(postData),\n            processData: false,\n            contentType: \"application/json; charset=utf-8\",\n            dataType: \"json\",\n            headers: {\"X-CSRF-Token\": csrf},\n            success: ret => {\n                if (ret['success']) {\n                    window.setTimeout(() => {\n                        AntragsgruenEditor.destroyInstanceById(this.textHolder.getAttribute(\"id\"));\n                    }, 100);\n                    this.saveRow.classList.add('hidden');\n                    this.textHolder.setAttribute('contenteditable', 'false');\n                    this.editCaller.classList.remove('hidden');\n                    this.metadataEdit.classList.add('hidden');\n                    this.metadataView.classList.remove('hidden');\n\n                    this.textHolder.innerHTML = ret['html'];\n                    this.metadataView.innerHTML = ret['metadataFormatted'];\n                } else {\n                    alert('Something went wrong...');\n                }\n            },\n        }).catch(function (err) {\n            alert(err.responseText);\n        })\n    }\n}\n"]}