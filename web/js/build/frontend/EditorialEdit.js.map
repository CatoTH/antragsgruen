{"version":3,"sources":["frontend/EditorialEdit.js","frontend/EditorialEdit.ts"],"names":["__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","AntragsgruenEditor","EditorialEdit","constructor","_","form","addEventListener","preventDefault","saveRow","querySelector","textHolder","editCaller","metadataEdit","metadataView","editCalled","bind","save","window","location","href","indexOf","$","scrollintoview","top_offset","ev","setAttribute","editor","getAttribute","focus","classList","add","remove","postData","data","getEditor","getData","author","updateDate","checked","csrf","ajax","url","type","JSON","stringify","processData","contentType","dataType","headers","success","ret","setTimeout","destroyInstanceById","innerHTML","alert","catch","err","responseText"],"mappings":"AAAA,IAAIA,UAAaC,MAAQA,KAAKD,WAAc,SAAUE,EAASC,EAAYC,EAAGC,GAE1E,OAAO,IAAKD,IAAMA,EAAIE,UAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUC,GAAS,IAAMC,EAAKN,EAAUO,KAAKF,GAAS,CAAE,MAAOG,GAAKL,EAAOK,EAAI,CAAE,CAC1F,SAASC,EAASJ,GAAS,IAAMC,EAAKN,EAAiB,MAAEK,GAAS,CAAE,MAAOG,GAAKL,EAAOK,EAAI,CAAE,CAC7F,SAASF,EAAKI,GAJlB,IAAeL,EAIaK,EAAOC,KAAOT,EAAQQ,EAAOL,QAJ1CA,EAIyDK,EAAOL,MAJhDA,aAAiBN,EAAIM,EAAQ,IAAIN,EAAE,SAAUG,GAAWA,EAAQG,EAAQ,IAIjBO,KAAKR,EAAWK,EAAW,CAC7GH,GAAMN,EAAYA,EAAUa,MAAMhB,EAASC,GAAc,KAAKS,OAClE,EACJ,SCRSO,uBAA0B,sCAE7B,MAAOC,cAQT,WAAAC,CAAYC,EAAWC,GAAAtB,KAAAsB,KAAAA,EACnBtB,KAAKsB,KAAKC,iBAAiB,SAAUX,GAAKA,EAAEY,kBAE5CxB,KAAKyB,QAAUzB,KAAKsB,KAAKI,cAAc,YACvC1B,KAAK2B,WAAa3B,KAAKsB,KAAKI,cAAc,eAC1C1B,KAAK4B,WAAa5B,KAAKsB,KAAKI,cAAc,eAC1C1B,KAAK6B,aAAe7B,KAAKsB,KAAKI,cAAc,iBAC5C1B,KAAK8B,aAAe9B,KAAKsB,KAAKI,cAAc,iBAE5C1B,KAAK4B,WAAWL,iBAAiB,QAASvB,KAAK+B,WAAWC,KAAKhC,OAC/DA,KAAKyB,QAAQC,cAAc,UAAUH,iBAAiB,QAASvB,KAAKiC,KAAKD,KAAKhC,QAEpB,IAAtDkC,OAAOC,SAASC,KAAKC,QAAQ,sBAC7BrC,KAAK+B,aACLO,EAAEtC,KAAK2B,YAAYY,eAAe,CAACC,YAAa,MAExD,CAEQ,UAAAT,CAAWU,EAAK,MAChBA,GACAA,EAAGjB,iBAEPxB,KAAK2B,WAAWe,aAAa,kBAAmB,QAChD1C,KAAK2C,OAAS,IAAIzB,mBAAmBlB,KAAK2B,WAAWiB,aAAa,OAClE5C,KAAK2B,WAAWkB,QAEhB7C,KAAK4B,WAAWkB,UAAUC,IAAI,UAC9B/C,KAAKyB,QAAQqB,UAAUE,OAAO,UAC9BhD,KAAK8B,aAAagB,UAAUC,IAAI,UAChC/C,KAAK6B,aAAaiB,UAAUE,OAAO,SACvC,CAEc,IAAAf,CAAKQ,GDHf,OAAO1C,UAAUC,UAAW,OAAQ,EAAG,YCIvCyC,EAAGjB,iBACH,IAAIyB,EAAW,CACXC,KAAQlD,KAAK2C,OAAOQ,YAAYC,UAChCC,OAAWrD,KAAK6B,aAAaH,cAAc,WAAgCjB,MAC3E6C,WAAgBtD,KAAK6B,aAAaH,cAAc,eAAoC6B,QAAU,EAAI,GAEtG,MAAMC,EAAQxD,KAAKsB,KAAKI,cAAc,qBAA0CjB,MAEhF6B,EAAEmB,KAAK,CACHC,IAAK1D,KAAKsB,KAAKsB,aAAa,UAC5Be,KAAM,OACNT,KAAMU,KAAKC,UAAUZ,GACrBa,aAAa,EACbC,YAAa,kCACbC,SAAU,OACVC,QAAS,CAAC,eAAgBT,GAC1BU,QAASC,IACDA,EAAa,SACbjC,OAAOkC,WAAW,KACdlD,mBAAmBmD,oBAAoBrE,KAAK2B,WAAWiB,aAAa,QACrE,KACH5C,KAAKyB,QAAQqB,UAAUC,IAAI,UAC3B/C,KAAK2B,WAAWe,aAAa,kBAAmB,SAChD1C,KAAK4B,WAAWkB,UAAUE,OAAO,UACjChD,KAAK6B,aAAaiB,UAAUC,IAAI,UAChC/C,KAAK8B,aAAagB,UAAUE,OAAO,UAEnChD,KAAK2B,WAAW2C,UAAYH,EAAU,KACtCnE,KAAK8B,aAAawC,UAAYH,EAAuB,mBAErDI,MAAM,8BAGfC,MAAM,SAAUC,GACfF,MAAME,EAAIC,aACd,EACJ,EDHA","file":"EditorialEdit.js","sourcesContent":[null,"import { AntragsgruenEditor } from '../shared/AntragsgruenEditor';\n\nexport class EditorialEdit {\n    private readonly editCaller: HTMLDivElement;\n    private readonly textHolder: HTMLDivElement;\n    private readonly metadataView: HTMLDivElement;\n    private readonly metadataEdit: HTMLDivElement;\n    private readonly saveRow: HTMLDivElement;\n    private editor: AntragsgruenEditor;\n\n    constructor(_, private form: HTMLFormElement) {\n        this.form.addEventListener('submit', e => e.preventDefault()); // necessary for IE11\n\n        this.saveRow = this.form.querySelector('.saveRow');\n        this.textHolder = this.form.querySelector('.textHolder');\n        this.editCaller = this.form.querySelector('.editCaller');\n        this.metadataEdit = this.form.querySelector('.metadataEdit');\n        this.metadataView = this.form.querySelector('.metadataView');\n\n        this.editCaller.addEventListener('click', this.editCalled.bind(this));\n        this.saveRow.querySelector('button').addEventListener('click', this.save.bind(this));\n\n        if (window.location.href.indexOf('edit_editorial=1') !== -1) {\n            this.editCalled();\n            $(this.textHolder).scrollintoview({top_offset: -150});\n        }\n    }\n\n    private editCalled(ev = null) {\n        if (ev) {\n            ev.preventDefault();\n        }\n        this.textHolder.setAttribute('contenteditable', \"true\");\n        this.editor = new AntragsgruenEditor(this.textHolder.getAttribute(\"id\"));\n        this.textHolder.focus();\n\n        this.editCaller.classList.add('hidden');\n        this.saveRow.classList.remove('hidden');\n        this.metadataView.classList.add('hidden');\n        this.metadataEdit.classList.remove('hidden');\n    }\n\n    private async save(ev) {\n        ev.preventDefault();\n        let postData = {\n            'data': this.editor.getEditor().getData(),\n            'author': (this.metadataEdit.querySelector('.author') as HTMLInputElement).value,\n            'updateDate': ((this.metadataEdit.querySelector('.updateDate') as HTMLInputElement).checked ? 1 : 0),\n        };\n        const csrf = (this.form.querySelector('input[name=_csrf]') as HTMLInputElement).value;\n\n        $.ajax({\n            url: this.form.getAttribute('action'),\n            type: \"POST\",\n            data: JSON.stringify(postData),\n            processData: false,\n            contentType: \"application/json; charset=utf-8\",\n            dataType: \"json\",\n            headers: {\"X-CSRF-Token\": csrf},\n            success: ret => {\n                if (ret['success']) {\n                    window.setTimeout(() => {\n                        AntragsgruenEditor.destroyInstanceById(this.textHolder.getAttribute(\"id\"));\n                    }, 100);\n                    this.saveRow.classList.add('hidden');\n                    this.textHolder.setAttribute('contenteditable', 'false');\n                    this.editCaller.classList.remove('hidden');\n                    this.metadataEdit.classList.add('hidden');\n                    this.metadataView.classList.remove('hidden');\n\n                    this.textHolder.innerHTML = ret['html'];\n                    this.metadataView.innerHTML = ret['metadataFormatted'];\n                } else {\n                    alert('Something went wrong...');\n                }\n            },\n        }).catch(function (err) {\n            alert(err.responseText);\n        })\n    }\n}\n"]}