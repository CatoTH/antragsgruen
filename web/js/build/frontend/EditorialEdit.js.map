{"version":3,"sources":["frontend/EditorialEdit.js","frontend/EditorialEdit.ts"],"names":["__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","define","require","exports","AntragsgruenEditor_1","Object","defineProperty","EditorialEdit","constructor","_","form","addEventListener","preventDefault","saveRow","querySelector","textHolder","editCaller","metadataEdit","metadataView","editCalled","bind","save","window","location","href","indexOf","$","scrollintoview","top_offset","ev","setAttribute","editor","AntragsgruenEditor","getAttribute","focus","classList","add","remove","postData","data","getEditor","getData","author","updateDate","checked","csrf","ajax","url","type","JSON","stringify","processData","contentType","dataType","headers","success","ret","setTimeout","destroyInstanceById","innerHTML","alert","catch","err","responseText"],"mappings":"AAAA,IAAIA,UAAaC,MAAQA,KAAKD,WAAc,SAAUE,EAASC,EAAYC,EAAGC,GAE1E,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUC,GAAS,IAAMC,EAAKN,EAAUO,KAAKF,GAAS,CAAE,MAAOG,GAAKL,EAAOK,EAAI,CAAE,CAC1F,SAASC,EAASJ,GAAS,IAAMC,EAAKN,EAAiB,MAAEK,GAAS,CAAE,MAAOG,GAAKL,EAAOK,EAAI,CAAE,CAC7F,SAASF,EAAKI,GAJlB,IAAeL,EAIaK,EAAOC,KAAOT,EAAQQ,EAAOL,QAJ1CA,EAIyDK,EAAOL,MAJhDA,aAAiBN,EAAIM,EAAQ,IAAIN,GAAE,SAAUG,GAAWA,EAAQG,EAAQ,KAIjBO,KAAKR,EAAWK,EAAW,CAC7GH,GAAMN,EAAYA,EAAUa,MAAMhB,EAASC,GAAc,KAAKS,OAClE,GACJ,EACAO,OAAO,CAAC,UAAW,UAAW,iCAAiC,SAAUC,EAASC,EAASC,GACvF,aACAC,OAAOC,eAAeH,EAAS,aAAc,CAAEX,OAAO,IACtDW,EAAQI,mBAAgB,ECV5BJ,EAAAI,cAAA,MAQI,WAAAC,CAAYC,EAAWC,GAAA3B,KAAA2B,KAAAA,EACnB3B,KAAK2B,KAAKC,iBAAiB,UAAUhB,GAAKA,EAAEiB,mBAE5C7B,KAAK8B,QAAU9B,KAAK2B,KAAKI,cAAc,YACvC/B,KAAKgC,WAAahC,KAAK2B,KAAKI,cAAc,eAC1C/B,KAAKiC,WAAajC,KAAK2B,KAAKI,cAAc,eAC1C/B,KAAKkC,aAAelC,KAAK2B,KAAKI,cAAc,iBAC5C/B,KAAKmC,aAAenC,KAAK2B,KAAKI,cAAc,iBAE5C/B,KAAKiC,WAAWL,iBAAiB,QAAS5B,KAAKoC,WAAWC,KAAKrC,OAC/DA,KAAK8B,QAAQC,cAAc,UAAUH,iBAAiB,QAAS5B,KAAKsC,KAAKD,KAAKrC,QAEpB,IAAtDuC,OAAOC,SAASC,KAAKC,QAAQ,sBAC7B1C,KAAKoC,aACLO,EAAE3C,KAAKgC,YAAYY,eAAe,CAACC,YAAa,MAExD,CAEQ,UAAAT,CAAWU,EAAK,MAChBA,GACAA,EAAGjB,iBAEP7B,KAAKgC,WAAWe,aAAa,kBAAmB,QAChD/C,KAAKgD,OAAS,IAAI3B,EAAA4B,mBAAmBjD,KAAKgC,WAAWkB,aAAa,OAClElD,KAAKgC,WAAWmB,QAEhBnD,KAAKiC,WAAWmB,UAAUC,IAAI,UAC9BrD,KAAK8B,QAAQsB,UAAUE,OAAO,UAC9BtD,KAAKmC,aAAaiB,UAAUC,IAAI,UAChCrD,KAAKkC,aAAakB,UAAUE,OAAO,SACvC,CAEc,IAAAhB,CAAKQ,GDAX,OAAO/C,UAAUC,UAAM,OAAQ,GAAQ,YCC3C8C,EAAGjB,iBACH,IAAI0B,EAAW,CACXC,KAAQxD,KAAKgD,OAAOS,YAAYC,UAChCC,OAAW3D,KAAKkC,aAAaH,cAAc,WAAgCtB,MAC3EmD,WAAgB5D,KAAKkC,aAAaH,cAAc,eAAoC8B,QAAU,EAAI,GAEtG,MAAMC,EAAQ9D,KAAK2B,KAAKI,cAAc,qBAA0CtB,MAEhFkC,EAAEoB,KAAK,CACHC,IAAKhE,KAAK2B,KAAKuB,aAAa,UAC5Be,KAAM,OACNT,KAAMU,KAAKC,UAAUZ,GACrBa,aAAa,EACbC,YAAa,kCACbC,SAAU,OACVC,QAAS,CAAC,eAAgBT,GAC1BU,QAASC,IACDA,EAAa,SACblC,OAAOmC,YAAW,KACdrD,EAAA4B,mBAAmB0B,oBAAoB3E,KAAKgC,WAAWkB,aAAa,MAAM,GAC3E,KACHlD,KAAK8B,QAAQsB,UAAUC,IAAI,UAC3BrD,KAAKgC,WAAWe,aAAa,kBAAmB,SAChD/C,KAAKiC,WAAWmB,UAAUE,OAAO,UACjCtD,KAAKkC,aAAakB,UAAUC,IAAI,UAChCrD,KAAKmC,aAAaiB,UAAUE,OAAO,UAEnCtD,KAAKgC,WAAW4C,UAAYH,EAAU,KACtCzE,KAAKmC,aAAayC,UAAYH,EAAuB,mBAErDI,MAAM,0BACV,IAELC,OAAM,SAAUC,GACfF,MAAME,EAAIC,aACd,GACJ,GDAI,EAGR","file":"EditorialEdit.js","sourcesContent":[null,"import { AntragsgruenEditor } from '../shared/AntragsgruenEditor';\n\nexport class EditorialEdit {\n    private readonly editCaller: HTMLDivElement;\n    private readonly textHolder: HTMLDivElement;\n    private readonly metadataView: HTMLDivElement;\n    private readonly metadataEdit: HTMLDivElement;\n    private readonly saveRow: HTMLDivElement;\n    private editor: AntragsgruenEditor;\n\n    constructor(_, private form: HTMLFormElement) {\n        this.form.addEventListener('submit', e => e.preventDefault()); // necessary for IE11\n\n        this.saveRow = this.form.querySelector('.saveRow');\n        this.textHolder = this.form.querySelector('.textHolder');\n        this.editCaller = this.form.querySelector('.editCaller');\n        this.metadataEdit = this.form.querySelector('.metadataEdit');\n        this.metadataView = this.form.querySelector('.metadataView');\n\n        this.editCaller.addEventListener('click', this.editCalled.bind(this));\n        this.saveRow.querySelector('button').addEventListener('click', this.save.bind(this));\n\n        if (window.location.href.indexOf('edit_editorial=1') !== -1) {\n            this.editCalled();\n            $(this.textHolder).scrollintoview({top_offset: -150});\n        }\n    }\n\n    private editCalled(ev = null) {\n        if (ev) {\n            ev.preventDefault();\n        }\n        this.textHolder.setAttribute('contenteditable', \"true\");\n        this.editor = new AntragsgruenEditor(this.textHolder.getAttribute(\"id\"));\n        this.textHolder.focus();\n\n        this.editCaller.classList.add('hidden');\n        this.saveRow.classList.remove('hidden');\n        this.metadataView.classList.add('hidden');\n        this.metadataEdit.classList.remove('hidden');\n    }\n\n    private async save(ev) {\n        ev.preventDefault();\n        let postData = {\n            'data': this.editor.getEditor().getData(),\n            'author': (this.metadataEdit.querySelector('.author') as HTMLInputElement).value,\n            'updateDate': ((this.metadataEdit.querySelector('.updateDate') as HTMLInputElement).checked ? 1 : 0),\n        };\n        const csrf = (this.form.querySelector('input[name=_csrf]') as HTMLInputElement).value;\n\n        $.ajax({\n            url: this.form.getAttribute('action'),\n            type: \"POST\",\n            data: JSON.stringify(postData),\n            processData: false,\n            contentType: \"application/json; charset=utf-8\",\n            dataType: \"json\",\n            headers: {\"X-CSRF-Token\": csrf},\n            success: ret => {\n                if (ret['success']) {\n                    window.setTimeout(() => {\n                        AntragsgruenEditor.destroyInstanceById(this.textHolder.getAttribute(\"id\"));\n                    }, 100);\n                    this.saveRow.classList.add('hidden');\n                    this.textHolder.setAttribute('contenteditable', 'false');\n                    this.editCaller.classList.remove('hidden');\n                    this.metadataEdit.classList.add('hidden');\n                    this.metadataView.classList.remove('hidden');\n\n                    this.textHolder.innerHTML = ret['html'];\n                    this.metadataView.innerHTML = ret['metadataFormatted'];\n                } else {\n                    alert('Something went wrong...');\n                }\n            },\n        }).catch(function (err) {\n            alert(err.responseText);\n        })\n    }\n}\n"]}