{"version":3,"sources":["frontend/InitiatorForm.js","frontend/InitiatorForm.ts"],"names":["define","require","exports","Object","defineProperty","value","InitiatorForm","constructor","$widget","this","otherInitiator","wasPerson","$editforms","parents","first","$supporterData","find","$initiatorData","$fullTextHolder","$","$supporterAdderRow","userData","data","settings","hasOrganisationList","$otherInitiator","on","onChangeOtherInitiator","bind","trigger","onChangePersonType","supporterAddRow","supporterDelRow","onKeyOnTextfield","initInitiatorAdder","fullTextAdderOpen","fullTextAdd","setOrgaNameFromSelect","length","initMinSupporters","initAdminSetUser","submit","val","prop","hasClass","selectedOrga","isOrganization","setFieldsVisibilityOrganization","setFieldsReadonlyOrganization","addClass","removeClass","setFieldsVisibilityPerson","setFieldsReadonlyPerson","contactName","fixed_orga","person_organization","fixed_name","person_name","$initiatorAdderRow","initiatorAddRow","initiatorDelRow","ev","preventDefault","$newEl","before","target","remove","found","each","i","el","trim","bootbox","alert","__t","replace","parent","lines","split","template","getNewElement","$rows","$row","eq","$firstAffectedRow","parts","scrollintoview","keyCode","stopPropagation","next","prev","last","hasResolutionDate","contactGender"],"mappings":"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","file":"InitiatorForm.js","sourcesContent":[null,"// noinspection JSUnusedLocalSymbols\nconst CONTACT_NONE = 0;\nconst CONTACT_OPTIONAL = 1;\nconst CONTACT_REQUIRED = 2;\n\ninterface UserData {\n    fixed_name: boolean;\n    fixed_orga: boolean;\n    person_name: string;\n    person_organization: string;\n}\n\ninterface InitiatorFormSettings {\n    minSupporters: number;\n    hasOrganizations: boolean;\n    allowMoreSupporters: boolean;\n    skipForOrganizations: boolean;\n    hasResolutionDate: number;\n    contactName: number;\n    contactPhone: number;\n    contactEmail: number;\n    contactGender: number;\n}\n\nexport class InitiatorForm {\n    private $supporterAdderRow: JQuery;\n    private $fullTextHolder: JQuery;\n    private $initiatorData: JQuery;\n    private $initiatorAdderRow: JQuery;\n    private $supporterData: JQuery;\n    private $editforms: JQuery;\n\n    private $otherInitiator: JQuery;\n    private otherInitiator = false;\n    private hasOrganisationList: boolean;\n    private userData: UserData;\n    private settings: InitiatorFormSettings;\n\n    private wasPerson: boolean = false;\n\n    constructor(private $widget: JQuery) {\n        this.$editforms = $widget.parents('form').first();\n        this.$supporterData = $widget.find('.supporterData');\n        this.$initiatorData = $widget.find('.initiatorData');\n        this.$fullTextHolder = $('#supporterFullTextHolder');\n        this.$supporterAdderRow = this.$supporterData.find('.adderRow');\n\n        this.userData = $widget.data('user-data');\n        this.settings = $widget.data('settings');\n        this.hasOrganisationList = !!$widget.data(\"organisation-list\");\n\n        this.$otherInitiator = $widget.find('input[name=otherInitiator]');\n        this.$otherInitiator.on(\"change\", this.onChangeOtherInitiator.bind(this)).trigger('change');\n\n        $widget.find('#personTypeNatural, #personTypeOrga').on('click change', this.onChangePersonType.bind(this));\n        this.onChangePersonType();\n\n        this.$supporterAdderRow.find('button').on(\"click\", this.supporterAddRow.bind(this));\n        this.$supporterData.on('click', '.supporterRow .rowDeleter', this.supporterDelRow.bind(this));\n        this.$supporterData.on('keydown', ' .supporterRow input[type=text]', this.onKeyOnTextfield.bind(this));\n\n        this.initInitiatorAdder();\n\n        $('.fullTextAdder button').on(\"click\", this.fullTextAdderOpen.bind(this));\n        $('.fullTextAdd').on(\"click\", this.fullTextAdd.bind(this));\n\n        if (this.hasOrganisationList) {\n            this.$initiatorData.find(\"#initiatorPrimaryOrgaName\").on('change', () => {\n                this.setOrgaNameFromSelect();\n            }).trigger('change');\n        }\n\n        if (this.$supporterData.length > 0 && this.$supporterData.data('min-supporters') > 0) {\n            this.initMinSupporters();\n        }\n\n        this.initAdminSetUser();\n\n        this.$editforms.on(\"submit\", this.submit.bind(this));\n    }\n\n    private onChangeOtherInitiator() {\n        this.otherInitiator = (this.$otherInitiator.val() == 1 || this.$otherInitiator.prop(\"checked\"));\n        this.onChangePersonType();\n    }\n    private setOrgaNameFromSelect() {\n        if (this.$initiatorData.find('#initiatorPrimaryOrgaName').hasClass('hidden')) {\n            // If a organization list is provided, but selecting organizations is disabled for this specific motion type, then this should prevent some edge cases\n            return;\n        }\n        const selectedOrga = this.$initiatorData.find(\"#initiatorPrimaryOrgaName\").val();\n        this.$initiatorData.find('#initiatorPrimaryName').val(selectedOrga);\n    }\n\n    private onChangePersonType() {\n        let isOrganization = false;\n        if ($(\"#personTypeHidden\").length > 0 && $(\"#personTypeHidden\").val() == '1') { // PERSON_ORGANIZATION === 1\n            isOrganization = true;\n        } else if ($('#personTypeOrga').prop('checked')) {\n            isOrganization = true;\n        }\n        if (isOrganization) {\n            this.setFieldsVisibilityOrganization();\n            this.setFieldsReadonlyOrganization();\n            if (this.wasPerson) {\n                this.$initiatorData.find('#initiatorPrimaryName').val('');\n            }\n            if (this.hasOrganisationList) {\n                this.$initiatorData.find('#initiatorPrimaryName').addClass('hidden');\n                this.$initiatorData.find('#initiatorPrimaryOrgaName').removeClass('hidden');\n                this.setOrgaNameFromSelect();\n            }\n            this.wasPerson = false;\n        } else {\n            this.setFieldsVisibilityPerson();\n            this.setFieldsReadonlyPerson();\n            if (this.hasOrganisationList) {\n                this.$initiatorData.find('#initiatorPrimaryName').removeClass('hidden');\n                this.$initiatorData.find('#initiatorPrimaryOrgaName').addClass('hidden');\n            }\n            this.wasPerson = true;\n        }\n\n        if (isOrganization || this.settings.contactName !== CONTACT_NONE ||\n            this.$initiatorData.find('.emailRow').length > 0 || this.$initiatorData.find('.phoneRow').length > 0) {\n            this.$initiatorData.find('.contactHead').removeClass('hidden');\n        } else {\n            this.$initiatorData.find('.contactHead').addClass('hidden');\n        }\n    }\n\n    private setFieldsVisibilityOrganization() {\n        this.$initiatorData.addClass('type-organization').removeClass('type-person');\n        this.$initiatorData.find('.organizationRow').addClass('hidden');\n        this.$initiatorData.find('.contactNameRow').removeClass('hidden');\n        this.$initiatorData.find('.resolutionRow').removeClass('hidden');\n        this.$initiatorData.find('.genderRow').addClass('hidden');\n        this.$initiatorData.find('.adderRow').addClass('hidden');\n        $('.supporterData, .supporterDataHead').addClass('hidden');\n    }\n\n    private setFieldsReadonlyOrganization() {\n        if (!this.userData.fixed_orga || this.otherInitiator) {\n            this.$initiatorData.find('#initiatorPrimaryName').prop('readonly', false);\n        } else {\n            this.$initiatorData.find('#initiatorPrimaryName').prop('readonly', true).val(this.userData.person_organization);\n        }\n        this.$initiatorData.find('#initiatorOrga').prop('readonly', false);\n    }\n\n    private setFieldsVisibilityPerson() {\n        this.$initiatorData.removeClass('type-organization').addClass('type-person');\n        this.$initiatorData.find('.organizationRow').removeClass('hidden');\n        if (this.settings.contactName == CONTACT_REQUIRED) {\n            this.$initiatorData.find('.contactNameRow').removeClass('hidden');\n            this.$initiatorData.find('.contactNameRow input').prop('required', true);\n        } else if (this.settings.contactName == CONTACT_OPTIONAL) {\n            this.$initiatorData.find('.contactNameRow').removeClass('hidden');\n            this.$initiatorData.find('.contactNameRow input').prop('required', false);\n        } else {\n            this.$initiatorData.find('.contactNameRow').addClass('hidden');\n            this.$initiatorData.find('.contactNameRow input').prop('required', false);\n        }\n        this.$initiatorData.find('.genderRow').removeClass('hidden');\n        this.$initiatorData.find('.resolutionRow').addClass('hidden');\n        this.$initiatorData.find('.adderRow').removeClass('hidden');\n        $('.supporterData, .supporterDataHead').removeClass('hidden');\n    }\n\n    private setFieldsReadonlyPerson() {\n        if (!this.userData.fixed_name || this.otherInitiator) {\n            this.$initiatorData.find('#initiatorPrimaryName').prop('readonly', false);\n        } else {\n            this.$initiatorData.find('#initiatorPrimaryName').prop('readonly', true).val(this.userData.person_name);\n        }\n    }\n\n    private initInitiatorAdder() {\n        this.$initiatorAdderRow = this.$initiatorData.find('.moreInitiatorsAdder');\n        this.$initiatorAdderRow.find('.adderBtn').on(\"click\", this.initiatorAddRow.bind(this));\n        this.$initiatorData.on('click', '.initiatorRow .rowDeleter', this.initiatorDelRow.bind(this));\n\n    }\n\n    private initiatorAddRow(ev) {\n        ev.preventDefault();\n        let $newEl = $($('#newInitiatorTemplate').data('html'));\n        this.$initiatorAdderRow.before($newEl);\n    }\n\n    private initiatorDelRow(ev) {\n        ev.preventDefault();\n        $(ev.target).parents('.initiatorRow').remove();\n    }\n\n    private supporterAddRow(ev) {\n        ev.preventDefault();\n        let $newEl = $($('#newSupporterTemplate').data('html'));\n        this.$supporterAdderRow.before($newEl);\n    }\n\n    private supporterDelRow(ev) {\n        ev.preventDefault();\n        $(ev.target).parents('.supporterRow').remove();\n    }\n\n    private initMinSupporters() {\n        this.$editforms.on(\"submit\", (ev) => {\n            if ($('#personTypeOrga').prop('checked')) {\n                return;\n            }\n            let found = 0;\n            this.$supporterData.find('.supporterRow').each((i, el) => {\n                if (($(el).find('input.name').val() as string).trim() !== '') {\n                    found++;\n                }\n            });\n            if (found < this.$supporterData.data('min-supporters')) {\n                ev.preventDefault();\n                bootbox.alert(__t(\"std\", \"min_x_supporter\").replace(/%NUM%/, this.$supporterData.data('min-supporters')));\n            }\n        });\n    }\n\n    private fullTextAdderOpen(ev) {\n        ev.preventDefault();\n        $(ev.target).parent().addClass(\"hidden\");\n        $('#supporterFullTextHolder').removeClass(\"hidden\");\n    }\n\n    private fullTextAdd() {\n        let lines = (this.$fullTextHolder.find('textarea').val() as string).split(\";\"),\n            template = $('#newSupporterTemplate').data('html'),\n            getNewElement = () => {\n                let $rows = this.$supporterData.find('.supporterRow');\n                for (let i = 0; i < $rows.length; i++) {\n                    let $row = $rows.eq(i);\n                    if ($row.find(\".name\").val() == '' && $row.find(\".organization\").val() == '') return $row;\n                }\n                // No empty row found\n                let $newEl = $(template);\n                if (this.$supporterAdderRow.length > 0) {\n                    this.$supporterAdderRow.before($newEl);\n                } else {\n                    $('.fullTextAdder').before($newEl);\n                }\n                return $newEl;\n            };\n        let $firstAffectedRow = null;\n        for (let i = 0; i < lines.length; i++) {\n            if (lines[i] == '') {\n                continue;\n            }\n            let $newEl = getNewElement();\n            if ($firstAffectedRow == null) $firstAffectedRow = $newEl;\n            if ($newEl.find('input.organization').length > 0) {\n                let parts = lines[i].split(',');\n                $newEl.find('input.name').val(parts[0].trim());\n                if (parts.length > 1) {\n                    $newEl.find('input.organization').val(parts[1].trim());\n                }\n            } else {\n                $newEl.find('input.name').val(lines[i]);\n            }\n        }\n        this.$fullTextHolder.find('textarea').trigger('select').trigger('focus');\n        if ($firstAffectedRow.length) {\n            $firstAffectedRow.scrollintoview();\n        }\n    }\n\n    private onKeyOnTextfield(ev) {\n        let $row;\n        if (ev.keyCode == 13) { // Enter\n            ev.preventDefault();\n            ev.stopPropagation();\n            $row = $(ev.target).parents('.supporterRow');\n            if ($row.next().hasClass('adderRow')) {\n                let $newEl = $($('#newSupporterTemplate').data('html'));\n                this.$supporterAdderRow.before($newEl);\n                $newEl.find('input[type=text]').first().trigger(\"focus\");\n            } else {\n                $row.next().find('input[type=text]').first().trigger(\"focus\");\n            }\n        } else if (ev.keyCode == 8) { // Backspace\n            $row = $(ev.target).parents('.supporterRow');\n            if ($row.find('input.name').val() != '') {\n                return;\n            }\n            if ($row.find('input.organization').val() != '') {\n                return;\n            }\n            $row.remove();\n            this.$supporterAdderRow.prev().find('input.name, input.organization').last().trigger('focus');\n        }\n    }\n\n    private submit(ev) {\n        if ($('#personTypeOrga').prop('checked')) {\n            if (this.settings.hasResolutionDate === CONTACT_REQUIRED && $('#resolutionDate').val() === '') {\n                ev.preventDefault();\n                bootbox.alert(__t('std', 'missing_resolution_date'));\n            }\n        }\n        if ($('#personTypeNatural').prop('checked')) {\n            if (this.settings.contactGender === CONTACT_REQUIRED && $('#initiatorGender').val() === '') {\n                ev.preventDefault();\n                bootbox.alert(__t('std', 'missing_gender'));\n            }\n        }\n    }\n\n    private initAdminSetUser() {\n        this.$widget.find(\".initiatorCurrentUsername .btnEdit\").on(\"click\", () => {\n            this.$widget.find(\"input[name=initiatorSet]\").val(\"1\");\n            this.$widget.find(\".initiatorCurrentUsername\").addClass('hidden');\n            this.$widget.find(\".initiatorSetUsername\").removeClass('hidden');\n        });\n    }\n}\n"]}