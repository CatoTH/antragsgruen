define(["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.$form=t,this.$textSaver=t.find(".textSaver"),this.$textHolder=t.find(".textHolder"),this.$editCaller=t.find(".editCaller"),this.$contentSettings=t.find(".contentSettingsToolbar"),this.$editCaller.click(this.editCalled.bind(this)),this.$textSaver.addClass("hidden"),this.$textSaver.find("button").click(this.save.bind(this)),0<this.$contentSettings.length&&this.initContentSettings(),$(".deletePageForm").submit(this.onSubmitDeleteForm.bind(this))}return t.prototype.editCalled=function(t){var e=this;t.preventDefault(),this.$editCaller.addClass("hidden"),this.$textHolder.attr("contenteditable","true"),this.editor=CKEDITOR.inline(this.$textHolder.attr("id"),{scayt_sLang:"de_DE",removePlugins:"lite,showbloks,about,selectall,forms",extraPlugins:"uploadimage",uploadUrl:this.$form.data("upload-url"),filebrowserBrowseUrl:this.$form.data("image-browse-url"),toolbarGroups:[{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"colors"},{name:"links"},{name:"insert"},{name:"others"},{name:"tools"},"/",{name:"styles"},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]}]}),this.editor.on("fileUploadRequest",function(t){t.data.requestData._csrf=e.$form.find("> input[name=_csrf]").val()}),this.$textHolder.focus(),this.$textSaver.removeClass("hidden"),this.$contentSettings.removeClass("hidden")},t.prototype.initContentSettings=function(){this.$contentSettings.find("input[name=url]").on("keyup change keypress",function(t){var e=$(t.currentTarget);e.val(e.val().replace(/[^\w_\-,\.äöüß]/,""))})},t.prototype.save=function(t){var e=this;t.preventDefault();var i={data:this.editor.getData(),_csrf:this.$form.find("> input[name=_csrf]").val()};0<this.$contentSettings.length&&(i.url=this.$contentSettings.find("input[name=url]").val(),i.title=this.$contentSettings.find("input[name=title]").val(),i.allConsultations=this.$contentSettings.find("input[name=allConsultations]").prop("checked")?1:0,i.inMenu=this.$contentSettings.find("input[name=inMenu]").prop("checked")?1:0),$.post(this.$form.attr("action"),i,function(t){t.success?(window.setTimeout(function(){e.editor.destroy()},100),e.$textSaver.addClass("hidden"),e.$textHolder.attr("contenteditable","false"),e.$editCaller.removeClass("hidden"),e.$contentSettings.addClass("hidden"),null!==t.title&&($(".pageTitle").text(t.title),document.title=t.title,$("#mainmenu .page"+t.id).text(t.title),$(".breadcrumb").children().last().text(t.title)),t.message&&alert(t.message),t.redirectTo&&(window.location.href=t.redirectTo)):alert("Something went wrong...")})},t.prototype.onSubmitDeleteForm=function(t,e){e&&(e.confirmed,1)&&!0===e.confirmed||(t.preventDefault(),bootbox.confirm(__t("admin","delPageConfirm"),function(t){t&&$(".deletePageForm").trigger("submit",{confirmed:!0})}))},t}();e.ContentPageEdit=i});
//# sourceMappingURL=ContentPageEdit.js.map
