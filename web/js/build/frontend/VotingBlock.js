export class VotingBlock{constructor(t){const o=t[0],e=o.querySelector(".currentVoting"),n=o.getAttribute("data-voting"),i=o.getAttribute("data-url-poll"),s=o.getAttribute("data-url-vote"),a=o.getAttribute("data-show-admin-link");this.widget=Vue.createApp({template:'\n                <div class="currentVotings">\n                <voting-block-widget v-for="voting in votings" :voting="voting" @vote="vote" @abstain="abstain" :showAdminLink="showAdminLink"></voting-block-widget>\n                </div>',data:()=>({votings:JSON.parse(n),pollingId:null,showAdminLink:a,onReloadedCbs:[]}),methods:{_votePost:function(t,o){const e=this;$.ajax({url:s.replace(/VOTINGBLOCKID/,t),type:"POST",data:JSON.stringify(o),processData:!1,contentType:"application/json; charset=utf-8",dataType:"json",headers:{"X-CSRF-Token":document.querySelector("head meta[name=csrf-token]").getAttribute("content")},success:t=>{void 0===t.success||t.success?(e.votings=t,e.onReloadedCbs.forEach(t=>{t(e.votings)})):alert(t.message)}})},vote:function(t,o,e,n,i,s){this._votePost(t,{votes:[{itemGroupSameVote:o,itemType:e,itemId:n,vote:i,public:s}]})},abstain:function(t,o,e){this._votePost(t,{abstention:{abstain:o,public:e}})},addReloadedCb:function(t){this.onReloadedCbs.push(t)},reloadData:function(){if(null===i)return;const t=this;$.get(i,function(o){t.votings=o,t.onReloadedCbs.forEach(o=>{o(t.votings)})}).catch(function(t){console.error("Could not load voting data from backend",t)})},startPolling:function(){const t=this;this.pollingId=window.setInterval(function(){t.reloadData()},3e3)}},beforeUnmount(){window.clearInterval(this.pollingId)},created(){this.startPolling()}}),this.widget.config.compilerOptions.whitespace="condense",window.__initVueComponents(this.widget,"voting"),this.widgetComponent=this.widget.mount(e);const d=document.querySelectorAll(".votingsNoneIndicator");this.widgetComponent.addReloadedCb(t=>{0===t.length?d.forEach(t=>t.classList.remove("hidden")):d.forEach(t=>t.classList.add("hidden"))})}}
//# sourceMappingURL=VotingBlock.js.map
