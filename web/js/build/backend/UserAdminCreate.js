define(["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserAdminCreate=void 0;t.UserAdminCreate=class{constructor(e){this.$el=e,this.element=e[0],this.initAddMultiple(),this.initAddSingleInit(),this.initAddSingleShow()}initAddMultiple(){this.element.querySelectorAll(".addMultipleOpener .addUsersOpener").forEach((e=>{e.addEventListener("click",(e=>{const t=e.currentTarget.getAttribute("data-type");this.element.querySelectorAll(".addUsersByLogin").forEach((e=>{e.classList.add("hidden")})),this.element.querySelector(".addUsersByLogin."+t).classList.remove("hidden")}))})),this.element.querySelectorAll(".addUsersByLogin.multiuser").forEach((e=>{e.addEventListener("submit",this.checkMultipleSubmit.bind(this))}))}checkMultipleSubmit(e){const t=this.element.querySelector(".addUsersByLogin.samlWW"),i=this.element.querySelector(".addUsersByLogin.email"),s=!!this.element.querySelector("#emailText");if(i&&!i.classList.contains("hidden")){if(s){const t=this.element.querySelector("#emailText").value;if(-1===t.indexOf("%ACCOUNT%"))return bootbox.alert(__t("admin","emailMissingCode")),void e.preventDefault();if(-1===t.indexOf("%LINK%"))return bootbox.alert(__t("admin","emailMissingLink")),void e.preventDefault()}let t=this.element.querySelector("#emailAddresses").value.split("\n"),i=this.element.querySelector("#names").value.split("\n");1==t.length&&""==t[0]&&(e.preventDefault(),bootbox.alert(__t("admin","emailMissingTo"))),t.length!=i.length&&(bootbox.alert(__t("admin","emailNumberMismatch")),e.preventDefault())}t&&!t.classList.contains("hidden")&&""===this.element.querySelector("#samlWW").value&&(e.preventDefault(),bootbox.alert(__t("admin","emailMissingUsername")))}initAddSingleInit(){const e=this.element.querySelector(".addSingleInit"),t=this.element.querySelector(".adminTypeSelect"),i=this.element.querySelector(".inputEmail"),s=this.element.querySelector(".inputUsername");t.addEventListener("change",(()=>{"email"===t.value&&(i.classList.remove("hidden"),s.classList.add("hidden"),i.required=!0,s.required=!1),"gruenesnetz"===t.value&&(i.classList.add("hidden"),s.classList.remove("hidden"),i.required=!1,s.required=!0)})),e.addEventListener("submit",(r=>{r.preventDefault(),r.stopPropagation();const n={_csrf:document.querySelector("head meta[name=csrf-token]").getAttribute("content"),type:t.value,username:""};"email"===t.value&&(n.username=i.value),"gruenesnetz"===t.value&&(n.username=s.value),n.username&&$.post(e.action,n,(e=>{this.showAddSingleShowFromResponse(e)})).catch((function(e){alert(e.responseText)}))}))}showAddSingleShowFromResponse(e){const t=this.element.querySelector(".alreadyMember"),i=this.element.querySelector(".addUsersByLogin.singleuser");if(e.exists&&e.already_member)return t.classList.remove("hidden"),void i.classList.add("hidden");i.classList.remove("hidden"),t.classList.add("hidden"),e.exists?i.querySelectorAll(".showIfNew").forEach((e=>{e.classList.add("hidden")})):(i.querySelectorAll(".showIfExists").forEach((e=>{e.classList.add("hidden")})),i.querySelector("#addSingleNameGiven").setAttribute("required",""),i.querySelector("#addSingleNameFamily").setAttribute("required",""),i.querySelector("#addSingleOrganization").setAttribute("required",""),window.setTimeout((()=>{i.querySelector("input[name=nameGiven]").focus()}),1))}initAddSingleShow(){const e=this.element.querySelector(".addUsersByLogin.singleuser"),t=e.querySelector("#addSingleGeneratePassword"),i=e.querySelector("#addSingleSendEmail"),s=e.querySelector("#addSingleEmailText"),r=e.querySelector("#addUserPassword"),n=()=>{t.checked?(r.classList.add("hidden"),r.removeAttribute("required")):(r.classList.remove("hidden"),r.setAttribute("required",""))};t.addEventListener("change",n),n();const d=()=>{i.checked?s.classList.remove("hidden"):s.classList.add("hidden")};i.addEventListener("change",d),d()}}}));
//# sourceMappingURL=UserAdminCreate.js.map
