define(["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserAdminCreate=void 0;t.UserAdminCreate=class{constructor(e){this.$el=e,this.element=e[0],this.initAddMultiple(),this.initAddSingleInit(),this.initAddSingleShow()}initAddMultiple(){this.element.querySelectorAll(".addMultipleOpener .addUsersOpener").forEach((e=>{e.addEventListener("click",(e=>{const t=e.currentTarget.getAttribute("data-type");this.element.querySelectorAll(".addUsersByLogin").forEach((e=>{e.classList.add("hidden")})),this.element.querySelector(".addUsersByLogin."+t).classList.remove("hidden")}))})),this.element.querySelectorAll(".addUsersByLogin.multiuser").forEach((e=>{e.addEventListener("submit",this.checkMultipleSubmit.bind(this))}))}validateEmailText(e){return-1===e.indexOf("%ACCOUNT%")?(bootbox.alert(__t("admin","emailMissingCode")),!1):-1!==e.indexOf("%LINK%")||(bootbox.alert(__t("admin","emailMissingLink")),!1)}checkMultipleSubmit(e){const t=this.element.querySelector(".addUsersByLogin.samlWW"),i=this.element.querySelector(".addUsersByLogin.email"),s=!!this.element.querySelector("#emailText");if(i&&!i.classList.contains("hidden")){if(s){const t=this.element.querySelector("#emailText").value;if(!this.validateEmailText(t))return void e.preventDefault()}let t=this.element.querySelector("#emailAddresses").value.split("\n"),i=this.element.querySelector("#names").value.split("\n");1==t.length&&""==t[0]&&(e.preventDefault(),bootbox.alert(__t("admin","emailMissingTo"))),t.length!=i.length&&(bootbox.alert(__t("admin","emailNumberMismatch")),e.preventDefault())}t&&!t.classList.contains("hidden")&&""===this.element.querySelector("#samlWW").value&&(e.preventDefault(),bootbox.alert(__t("admin","emailMissingUsername")))}initAddSingleInit(){const e=this.element.querySelector(".addSingleInit"),t=this.element.querySelector(".adminTypeSelect"),i=this.element.querySelector(".inputEmail"),s=this.element.querySelector(".inputUsername"),r=this.element.querySelector(".welcomeEmail");t.addEventListener("change",(()=>{"email"===t.value?(i.classList.remove("hidden"),s.classList.add("hidden"),i.required=!0,s.required=!1,r&&r.classList.remove("hidden")):(r&&r.classList.add("hidden"),i.classList.add("hidden"),s.classList.remove("hidden"),i.required=!1,s.required=!0)})),e.addEventListener("submit",(r=>{r.preventDefault(),r.stopPropagation();const n={_csrf:document.querySelector("head meta[name=csrf-token]").getAttribute("content"),type:t.value,username:""};"email"===t.value?n.username=i.value:n.username=s.value,n.username&&$.post(e.action,n,(e=>{this.showAddSingleShowFromResponse(e,n.type,n.username)})).catch((function(e){alert(e.responseText)}))}))}showAddSingleShowFromResponse(e,t,i){const s=this.element.querySelector(".alreadyMember"),r=this.element.querySelector(".addUsersByLogin.singleuser");if(e.exists&&e.already_member)return s.classList.remove("hidden"),void r.classList.add("hidden");r.classList.remove("hidden"),s.classList.add("hidden"),this.element.querySelector("input[name=authType]").value=t,this.element.querySelector("input[name=authUsername]").value=i,this.element.querySelector("#addSelectOrganization")&&this.initOrganisationToUserGroup(),e.exists?r.querySelectorAll(".showIfNew").forEach((e=>{e.classList.add("hidden")})):(r.querySelectorAll(".showIfExists").forEach((e=>{e.classList.add("hidden")})),r.querySelector("#addSingleNameGiven").setAttribute("required",""),r.querySelector("#addSingleNameFamily").setAttribute("required",""),window.setTimeout((()=>{r.querySelector("input[name=nameGiven]").focus()}),1))}initOrganisationToUserGroup(){const e=[];let t=!0;this.element.querySelectorAll("input.userGroup").forEach((i=>{i.checked&&e.push(parseInt(i.value,10)),i.addEventListener("change",(()=>t=!1))}));const i=$("#addSelectOrganization"),s=JSON.parse(this.element.getAttribute("data-organisations"));i.selectize({create:!0,render:{option_create:(e,t)=>'<div class="create"><strong>'+t(e.input)+"</strong></div>"}}),i.on("change",(()=>{let r=[];s.forEach((e=>{e.name===i.val()&&(r=e.autoUserGroups)})),r.length>0?(this.element.querySelectorAll("input.userGroup").forEach((e=>{e.checked=r.indexOf(parseInt(e.value,10))>-1})),t=!0):t&&this.element.querySelectorAll("input.userGroup").forEach((t=>{t.checked=e.indexOf(parseInt(t.value,10))>-1}))}))}initAddSingleShow(){const e=this.element.querySelector(".addUsersByLogin.singleuser"),t=e.querySelector("#addSingleGeneratePassword"),i=e.querySelector("#addSingleSendEmail"),s=e.querySelector("#addSingleEmailText"),r=e.querySelector("#addUserPassword"),n=()=>{t.checked?(r.classList.add("hidden"),r.removeAttribute("required")):(r.classList.remove("hidden"),r.setAttribute("required",""))};t.addEventListener("change",n),n();const l=()=>{i.checked?s.classList.remove("hidden"):s.classList.add("hidden")};i.addEventListener("change",l),l(),e.addEventListener("submit",(e=>{if(i){const t=s.value;if(!this.validateEmailText(t))return void e.preventDefault()}}))}}}));
//# sourceMappingURL=UserAdminCreate.js.map
