define(["require","exports","./MotionSupporterEdit","../shared/AntragsgruenEditor"],(function(t,e,o,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MotionEdit=void 0;e.MotionEdit=class{constructor(){let t=$("html").attr("lang");this.$updateForm=$("#motionUpdateForm"),this.$status=$("#motionStatus"),$("#motionDateCreationHolder").datetimepicker({locale:t}),$("#motionDatePublicationHolder").datetimepicker({locale:t}),$("#motionDateResolutionHolder").datetimepicker({locale:t}),$("#resolutionDateHolder").datetimepicker({locale:$("#resolutionDate").data("locale"),format:"L"}),$("#motionTextEditCaller").find("button").on("click",(()=>{this.initMotionTextEdit()})),$(".checkAmendmentCollisions").on("click",(t=>{t.preventDefault(),this.loadAmendmentCollisions()})),this.$updateForm.on("submit",(function(){$(".amendmentCollisionsHolder .amendmentOverrideBlock > .texteditor").each((function(){let t=CKEDITOR.instances[$(this).attr("id")].getData();$(this).parents(".amendmentOverrideBlock").find("> textarea").val(t)}))})),$(".motionDeleteForm").on("submit",((t,e)=>{this.onSubmitDeleteForm(t,e)})),this.initProtocolFunctions(),this.initVotingFunctions(),this.initSlug(),this.initStatus(),new o.MotionSupporterEdit($("#motionSupporterHolder"))}initSlug(){$(".urlSlugHolder .shower button").on("click",(t=>{t.preventDefault(),$(".urlSlugHolder .shower").addClass("hidden"),$(".urlSlugHolder .holder").removeClass("hidden")}))}initStatus(){const t=()=>{const t=parseInt(document.getElementById("motionStatus").value,10);console.log(t),32===t?(document.querySelector(".motionStatusString").classList.add("hidden"),document.querySelector(".motionStatusMotion").classList.remove("hidden"),document.querySelector(".motionStatusAmendment").classList.add("hidden")):22===t?(document.querySelector(".motionStatusString").classList.add("hidden"),document.querySelector(".motionStatusMotion").classList.add("hidden"),document.querySelector(".motionStatusAmendment").classList.remove("hidden")):(document.querySelector(".motionStatusString").classList.remove("hidden"),document.querySelector(".motionStatusMotion").classList.add("hidden"),document.querySelector(".motionStatusAmendment").classList.add("hidden"))};document.getElementById("motionStatus").addEventListener("change",t),t()}initProtocolFunctions(){const t=$(".contentProtocolCaller, .protocolHolder"),e=$(".protocolCloser");$(".protocolOpener").on("click",(()=>{t.addClass("explicitlyOpened")})),e.on("click",(()=>{t.removeClass("explicitlyOpened")}));const o=$("#protocol_text_wysiwyg");o.attr("contenteditable","true");const i=new n.AntragsgruenEditor(o.attr("id")).getEditor();o.parents("form").on("submit",(()=>{o.parent().find("textarea").val(i.getData())}))}initVotingFunctions(){const t=$(".contentVotingResultCaller, .votingDataHolder"),e=$(".votingDataCloser"),o=$(".votingDataOpener"),n=$("select[name=votingBlockId]");o.on("click",(()=>{t.addClass("explicitlyOpened")})),e.on("click",(()=>{t.removeClass("explicitlyOpened")})),this.$status.on("change",(()=>{11===parseInt(this.$status.val(),10)?t.addClass("hasVotingStatus"):t.removeClass("hasVotingStatus")})).trigger("change"),$(".votingItemBlockRow select").on("change",(t=>{const e=$(t.currentTarget);if(e.val()){const t=e.find("option[value="+e.val()+"]").data("group-name");$(".votingItemBlockNameRow input").val(t),$(".votingItemBlockNameRow").removeClass("hidden")}else $(".votingItemBlockNameRow").addClass("hidden")})),n.on("change",(()=>{if("NEW"===n.val())$(".votingBlockRow .newBlock").removeClass("hidden"),$(".votingItemBlockRow").addClass("hidden"),$(".votingItemBlockNameRow").addClass("hidden");else{$(".votingBlockRow .newBlock").addClass("hidden"),$(".votingItemBlockRow").addClass("hidden");const t=$(".votingItemBlockRow"+n.val());t.removeClass("hidden"),t.length>0?(t.removeClass("hidden"),t.find("select").trigger("change")):$(".votingItemBlockNameRow").addClass("hidden")}})).trigger("change")}onSubmitDeleteForm(t,e){e&&(e.confirmed,1)&&!0===e.confirmed||(t.preventDefault(),bootbox.confirm(__t("admin","delMotionConfirm"),(function(t){t&&$(".motionDeleteForm").trigger("submit",{confirmed:!0})})))}initMotionTextEdit(){$("#motionTextEditCaller").addClass("hidden"),$("#motionTextEditHolder").removeClass("hidden"),$(".wysiwyg-textarea").each((function(){let t=$(this).find(".texteditor"),e=new n.AntragsgruenEditor(t.attr("id")).getEditor();t.parents("form").on("submit",(()=>{t.parent().find("textarea").val(e.getData())}))})),this.$updateForm.append("<input type='hidden' name='edittext' value='1'>"),$(".checkAmendmentCollisions").length>0&&($(".wysiwyg-textarea .texteditor").on("focus",(function(){$(".checkAmendmentCollisions").show(),$(".saveholder .save").prop("disabled",!0).hide()})),$(".checkAmendmentCollisions").show(),$(".saveholder .save").prop("disabled",!0).hide())}loadAmendmentCollisions(){let t=$(".checkAmendmentCollisions").data("url"),e={},o=$(".amendmentCollisionsHolder");$("#motionTextEditHolder").children().each((function(){let t=$(this);if(t.hasClass("wysiwyg-textarea")){let o=t.attr("id").replace("section_holder_","");e[o]=CKEDITOR.instances[t.find(".texteditor").attr("id")].getData()}})),$.post(t,{newSections:e,_csrf:this.$updateForm.find("> input[name=_csrf]").val()},(function(t){o.html(t),o.find(".amendmentOverrideBlock > .texteditor").length>0&&(o.find(".amendmentOverrideBlock > .texteditor").each((function(){new n.AntragsgruenEditor($(this).attr("id"))})),$(".amendmentCollisionsHolder").scrollintoview({top_offset:-50})),$(".checkAmendmentCollisions").hide(),$(".saveholder .save").prop("disabled",!1).show()}))}}}));
//# sourceMappingURL=MotionEdit.js.map
