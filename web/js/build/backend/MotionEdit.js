define(["require","exports","./MotionSupporterEdit","../shared/AntragsgruenEditor"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MotionEdit=void 0;var o=function(){function e(){var o=this,e=$("html").attr("lang");$("#motionDateCreationHolder").datetimepicker({locale:e}),$("#motionDatePublicationHolder").datetimepicker({locale:e}),$("#motionDateResolutionHolder").datetimepicker({locale:e}),$("#resolutionDateHolder").datetimepicker({locale:$("#resolutionDate").data("locale"),format:"L"}),$("#motionTextEditCaller").find("button").click(function(){o.initMotionTextEdit()}),$(".checkAmendmentCollisions").click(function(e){e.preventDefault(),o.loadAmendmentCollisions()}),$("#motionUpdateForm").on("submit",function(){$(".amendmentCollisionsHolder .amendmentOverrideBlock > .texteditor").each(function(){var e=CKEDITOR.instances[$(this).attr("id")].getData();$(this).parents(".amendmentOverrideBlock").find("> textarea").val(e)})}),$(".motionDeleteForm").on("submit",function(e,t){o.onSubmitDeleteForm(e,t)}),this.initVotingFunctions(),this.initSlug(),new n.MotionSupporterEdit($("#motionSupporterHolder"))}return e.prototype.initSlug=function(){$(".urlSlugHolder .shower a").on("click",function(e){e.preventDefault(),$(".urlSlugHolder .shower").addClass("hidden"),$(".urlSlugHolder .holder").removeClass("hidden")})},e.prototype.initVotingFunctions=function(){var e=$(".votingResultCloser"),t=$(".votingResultOpener"),o=$(".contentVotingResult, .contentVotingResultComment");t.on("click",function(){e.removeClass("hidden"),t.addClass("hidden"),o.removeClass("hidden")}),e.on("click",function(){e.addClass("hidden"),t.removeClass("hidden"),o.addClass("hidden")})},e.prototype.onSubmitDeleteForm=function(e,t){t&&(t.confirmed,1)&&!0===t.confirmed||(e.preventDefault(),bootbox.confirm(__t("admin","delMotionConfirm"),function(e){e&&$(".motionDeleteForm").trigger("submit",{confirmed:!0})}))},e.prototype.initMotionTextEdit=function(){$("#motionTextEditCaller").addClass("hidden"),$("#motionTextEditHolder").removeClass("hidden"),$(".wysiwyg-textarea").each(function(){var e=$(this).find(".texteditor"),t=new i.AntragsgruenEditor(e.attr("id")).getEditor();e.parents("form").on("submit",function(){e.parent().find("textarea").val(t.getData())})}),$("#motionUpdateForm").append("<input type='hidden' name='edittext' value='1'>"),0<$(".checkAmendmentCollisions").length&&($(".wysiwyg-textarea .texteditor").on("focus",function(){$(".checkAmendmentCollisions").show(),$(".saveholder .save").prop("disabled",!0).hide()}),$(".checkAmendmentCollisions").show(),$(".saveholder .save").prop("disabled",!0).hide())},e.prototype.loadAmendmentCollisions=function(){var e=$(".checkAmendmentCollisions").data("url"),o={},t=$(".amendmentCollisionsHolder");$("#motionTextEditHolder").children().each(function(){var e=$(this);if(e.hasClass("wysiwyg-textarea")){var t=e.attr("id").replace("section_holder_","");o[t]=CKEDITOR.instances[e.find(".texteditor").attr("id")].getData()}}),$.post(e,{newSections:o,_csrf:$("#motionUpdateForm").find("> input[name=_csrf]").val()},function(e){t.html(e),0<t.find(".amendmentOverrideBlock > .texteditor").length&&(t.find(".amendmentOverrideBlock > .texteditor").each(function(){new i.AntragsgruenEditor($(this).attr("id"))}),$(".amendmentCollisionsHolder").scrollintoview({top_offset:-50})),$(".checkAmendmentCollisions").hide(),$(".saveholder .save").prop("disabled",!1).show()})},e}();t.MotionEdit=o});
//# sourceMappingURL=MotionEdit.js.map
