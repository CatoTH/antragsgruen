{"version":3,"sources":["backend/MotionTypeEdit.ts"],"names":["CONTACT_NONE","CONTACT_OPTIONAL","CONTACT_REQUIRED","SUPPORTER_ONLY_INITIATOR","SUPPORTER_GIVEN_BY_INITIATOR","SUPPORTER_COLLECTING_SUPPORTERS","SUPPORTER_NO_INITIATOR","TYPE_TITLE","TYPE_TEXT_SIMPLE","TYPE_TEXT_HTML","TYPE_IMAGE","TYPE_TABULAR","TYPE_PDF_ATTACHMENT","TYPE_PDF_ALTERNATIVE","TYPE_VIDEO_EMBED","TYPE_TEXT_EDITORIAL","TYPE_TABULAR_SELECT","POLICY_USER_GROUPS","MotionTypeEdit","constructor","$","on","removeClass","addClass","tooltip","this","initSectionList","initDeadlines","initInitiatorForm","each","ix","el","initPolicyWidget","$sameSettings","prop","trigger","$typeAmendSinglePara","$typeAmendSingleChangeHolder","parents","first","$widget","$select","find","loadUrl","data","selectizeOption","Object","assign","loadThrottle","valueField","labelField","searchField","load","query","cb","get","then","res","render","option_create","escape","__t","input","selectize","$policySelect","parseInt","val","$form","$initiatorGender","$supportType","$supportAllowMore","$initiatorCanBePerson","$initiatorCanBeOrga","$initiatorSetPermissions","currentType","visibilityRules","hasInitiator","hasSupporters","toString","isCollectingSupporters","allowSupportAfterSubmission","is","allowFemaleQuota","filter","initiatorCanBePerson","initiatorCanBeOrga","initiatorSetPersonPermissions","initiatorSetOrgaPermissions","recalcVisibilities","$this","motionsHaveSupporters","setMaxPdfSupporters","amendmentsHaveSupporters","ev","currentTarget","i","$el","datetimepicker","locale","initLinkedDeadlinePickers","$row","$from","$to","useCurrent","setErrorState","fromDate","date","toDate","isBefore","hasError","$deadlineHolder","addDeadlineRow","html","replace","$newRow","append","remove","children","length","$list","newCounter","Sortable","create","handle","animation","preventDefault","$sectionHolder","delId","bootbox","confirm","result","$li","newStr","$newObj","$tab","dataNewCounter","$ul","parent","plugins"],"mappings":"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","file":"MotionTypeEdit.js","sourcesContent":["declare let Sortable;\n\nconst CONTACT_NONE = 0;\nconst CONTACT_OPTIONAL = 1;\nconst CONTACT_REQUIRED = 2;\n\n// noinspection JSUnusedGlobalSymbols\nconst SUPPORTER_ONLY_INITIATOR = 0;\n// noinspection JSUnusedGlobalSymbols\nconst SUPPORTER_GIVEN_BY_INITIATOR = 1;\nconst SUPPORTER_COLLECTING_SUPPORTERS = 2;\nconst SUPPORTER_NO_INITIATOR = 3;\n\n// Synchronize with ISectionType\nconst TYPE_TITLE = 0;\nconst TYPE_TEXT_SIMPLE = 1;\nconst TYPE_TEXT_HTML = 2;\nconst TYPE_IMAGE = 3;\nconst TYPE_TABULAR = 4;\nconst TYPE_PDF_ATTACHMENT = 5;\nconst TYPE_PDF_ALTERNATIVE = 6;\nconst TYPE_VIDEO_EMBED = 7;\nconst TYPE_TEXT_EDITORIAL = 8;\n\nconst TYPE_TABULAR_SELECT = 4;\n\nconst POLICY_USER_GROUPS = 6;\n\nclass MotionTypeEdit {\n    private motionsHaveSupporters: boolean;\n    private amendmentsHaveSupporters: boolean;\n\n    constructor() {\n        $('.deleteTypeOpener button').on('click', () => {\n            $('.deleteTypeForm').removeClass('hidden');\n            $('.deleteTypeOpener').addClass('hidden');\n        });\n\n        $('[data-toggle=\"tooltip\"]').tooltip();\n\n        this.initSectionList();\n        this.initDeadlines();\n\n        this.initInitiatorForm($(\"#motionSupportersForm\"));\n        this.initInitiatorForm($(\"#amendmentSupportersForm\"));\n\n        $('.policyWidget').each((ix, el) => {\n            this.initPolicyWidget($(el));\n        });\n\n        const $sameSettings = $(\"#sameInitiatorSettingsForAmendments input\");\n        $sameSettings.on(\"change\", () => {\n            if ($sameSettings.prop(\"checked\")) {\n                $('section.amendmentSupporters').addClass(\"hidden\");\n            } else {\n                $('section.amendmentSupporters').removeClass(\"hidden\");\n            }\n        }).trigger(\"change\");\n\n        const $typeAmendSinglePara = $(\"#typeAmendSinglePara\"),\n            $typeAmendSingleChangeHolder = $(\"#typeAmendSingleChange\").parents('label').first();\n        $typeAmendSinglePara.on('change', () => {\n            if ($typeAmendSinglePara.prop('checked')) {\n                $typeAmendSingleChangeHolder.removeClass('hidden');\n            } else {\n                $typeAmendSingleChangeHolder.addClass('hidden');\n            }\n        }).trigger('change');\n    }\n\n    private initPolicyWidget($widget: JQuery) {\n        const $select: any = $widget.find('.userGroupSelect'),\n            loadUrl = $select.data('load-url');\n        let selectizeOption = {};\n        if (loadUrl) {\n            selectizeOption = Object.assign(selectizeOption, {\n                loadThrottle: null,\n                valueField: 'id',\n                labelField: 'label',\n                searchField: 'label',\n                load: function (query, cb) {\n                    if (!query) return cb();\n                    return $.get(loadUrl, {query}).then(res => {\n                        cb(res);\n                    });\n                },\n                render: {\n                    option_create: (data, escape) => {\n                        return '<div class=\"create\">' + __t('std', 'add_tag') + ': <strong>' + escape(data.input) + '</strong></div>';\n                    }\n                }\n            });\n        }\n        $select.find(\"select\").selectize(selectizeOption);\n\n        const $policySelect = $widget.find(\".policySelect\");\n        $policySelect.on(\"change\", () => {\n            if (parseInt($policySelect.val() as string, 10) === POLICY_USER_GROUPS) {\n                $select.removeClass(\"hidden\");\n            } else {\n                $select.addClass(\"hidden\");\n            }\n        }).trigger(\"change\");\n    }\n\n    private initInitiatorForm($form: JQuery) {\n        const $initiatorGender = $form.find(\".contactGender input\");\n\n        const $supportType = $form.find(\".supportType\");\n        const $supportAllowMore = $form.find(\".formGroupAllowMore input\");\n        const $initiatorCanBePerson = $form.find(\".contactDetails .initiatorCanBePerson input\");\n        const $initiatorCanBeOrga = $form.find(\".contactDetails .initiatorCanBeOrganization input\");\n        const $initiatorSetPermissions= $form.find(\".contactDetails .initiatorSetPermissions input\");\n\n        let currentType = parseInt($supportType.find('input').val() as string, 10);\n\n        const visibilityRules = {\n            hasInitiator: () => (currentType !== SUPPORTER_NO_INITIATOR),\n            hasSupporters: () => (\n                currentType !== SUPPORTER_NO_INITIATOR &&\n                $supportType.find(\"option[value=\\\"\" + currentType.toString(10) + \"\\\"]\").data(\"has-supporters\")\n            ),\n            isCollectingSupporters: () => (currentType === SUPPORTER_COLLECTING_SUPPORTERS),\n            allowSupportAfterSubmission: () => (\n                (currentType === SUPPORTER_COLLECTING_SUPPORTERS || currentType === SUPPORTER_GIVEN_BY_INITIATOR) &&\n                $supportAllowMore.is(':checked')\n            ),\n            allowFemaleQuota: () => (\n                currentType === SUPPORTER_COLLECTING_SUPPORTERS &&\n                parseInt($initiatorGender.filter(\":checked\").val() as string, 10) !== CONTACT_NONE\n            ),\n            initiatorCanBePerson: () => (currentType !== SUPPORTER_NO_INITIATOR && $initiatorCanBePerson.prop(\"checked\")),\n            initiatorCanBeOrga: () => (currentType !== SUPPORTER_NO_INITIATOR && $initiatorCanBeOrga.prop(\"checked\")),\n            initiatorSetPersonPermissions: () => (currentType !== SUPPORTER_NO_INITIATOR && $initiatorSetPermissions.prop(\"checked\") && $initiatorCanBePerson.prop(\"checked\")),\n            initiatorSetOrgaPermissions: () => (currentType !== SUPPORTER_NO_INITIATOR && $initiatorSetPermissions.prop(\"checked\") && $initiatorCanBeOrga.prop(\"checked\")),\n        };\n\n        const recalcVisibilities = () => {\n            $form.find(\"[data-visibility]\").each(function() {\n                const $this = $(this);\n                if (visibilityRules[$this.data('visibility')]()) {\n                    $this.removeClass('hidden');\n                } else {\n                    $this.addClass('hidden');\n                }\n            });\n        };\n\n        $supportAllowMore.on('change', () => {\n            recalcVisibilities();\n        }).trigger('change');\n\n        $supportType.on('change', () => {\n            currentType = parseInt($supportType.val() as string, 10);\n            const hasSupporters = $supportType.find(\"option[value=\\\"\" + currentType.toString(10) + \"\\\"]\").data(\"has-supporters\");\n            recalcVisibilities();\n\n            this.motionsHaveSupporters = !!hasSupporters;\n\n            $initiatorGender.trigger('change');\n            $supportAllowMore.trigger('change');\n            this.setMaxPdfSupporters();\n        }).trigger('change');\n\n        $initiatorCanBePerson.on(\"change\", () => {\n            if (!$initiatorCanBePerson.prop(\"checked\") && !$initiatorCanBeOrga.prop(\"checked\")) {\n                $initiatorCanBeOrga.prop(\"checked\", true).trigger(\"change\");\n            }\n            recalcVisibilities();\n        });\n        $initiatorCanBeOrga.on(\"change\", () => {\n            if (!$initiatorCanBeOrga.prop(\"checked\") && !$initiatorCanBePerson.prop(\"checked\")) {\n                $initiatorCanBePerson.prop(\"checked\", true).trigger(\"change\");\n            }\n            recalcVisibilities();\n        });\n        $initiatorSetPermissions.on(\"change\", recalcVisibilities).trigger(\"change\");\n        $initiatorGender.on(\"change\", recalcVisibilities).trigger(\"change\");\n    }\n\n    private setMaxPdfSupporters() {\n        if (this.amendmentsHaveSupporters || this.motionsHaveSupporters) {\n            $('#typeMaxPdfSupportersRow').removeClass('hidden');\n        } else {\n            $('#typeMaxPdfSupportersRow').addClass('hidden');\n        }\n    }\n\n    private initDeadlines() {\n        $('#deadlineFormTypeComplex').on(\"change\", (ev) => {\n            if ($(ev.currentTarget).prop('checked')) {\n                $('.deadlineTypeSimple').addClass('hidden');\n                $('.deadlineTypeComplex').removeClass('hidden');\n            } else {\n                $('.deadlineTypeSimple').removeClass('hidden');\n                $('.deadlineTypeComplex').addClass('hidden');\n            }\n        }).trigger('change');\n\n        $('.datetimepicker').each((i, el) => {\n            const $el = $(el);\n            $el.datetimepicker({\n                locale: $el.find(\"input\").data('locale')\n            });\n        });\n\n        const initLinkedDeadlinePickers = ($row) => {\n            let $from = $row.find(\".datetimepickerFrom\"),\n                $to = $row.find(\".datetimepickerTo\");\n            $from.datetimepicker({\n                locale: $from.find(\"input\").data('locale')\n            });\n            $to.datetimepicker({\n                locale: $to.find(\"input\").data('locale'),\n                useCurrent: false\n            });\n\n            const hasError = () => {\n                const fromDate = $from.data(\"DateTimePicker\").date(),\n                    toDate = $to.data(\"DateTimePicker\").date();\n\n                return (fromDate && toDate && toDate.isBefore(fromDate));\n            };\n\n            const setErrorState = () => {\n                if (hasError()) {\n                    $from.addClass(\"has-error\");\n                    $to.addClass(\"has-error\");\n                } else {\n                    $from.removeClass(\"has-error\");\n                    $to.removeClass(\"has-error\");\n                }\n            };\n\n            $from.on(\"dp.change\", setErrorState);\n            $to.on(\"dp.change\", setErrorState);\n        };\n\n        $('.deadlineEntry').each((i, el) => {\n            initLinkedDeadlinePickers($(el));\n        });\n\n        $('.deadlineHolder').each((i, el) => {\n            const $deadlineHolder = $(el),\n                addDeadlineRow = () => {\n                    let html = $('.deadlineRowTemplate').html();\n                    html = html.replace(/TEMPLATE/g, $deadlineHolder.data('type'));\n                    let $newRow = $(html);\n                    $deadlineHolder.find('.deadlineList').append($newRow);\n                    initLinkedDeadlinePickers($newRow);\n                };\n            $deadlineHolder.find('.deadlineAdder').on(\"click\", addDeadlineRow);\n            $deadlineHolder.on('click', '.delRow', (ev) => {\n                $(ev.currentTarget).parents('.deadlineEntry').remove();\n            });\n            if ($deadlineHolder.find('.deadlineList').children().length === 0) {\n                addDeadlineRow();\n            }\n        });\n    }\n\n    private initSectionList() {\n        let $list = $('#sectionsList'),\n            newCounter = 0;\n\n        $list.data(\"sortable\", Sortable.create(<HTMLElement>$list[0], {\n            handle: '.drag-handle',\n            animation: 150\n        }));\n        $list.on('click', 'button.remover', function (ev) {\n            ev.preventDefault();\n            let $sectionHolder = $(this).parents('li').first(),\n                delId = $sectionHolder.data('id');\n            bootbox.confirm(__t('admin', 'deleteMotionSectionConfirm'), function (result) {\n                if (result) {\n                    $('.adminTypeForm').append('<input type=\"hidden\" name=\"sectionsTodelete[]\" value=\"' + delId + '\">');\n                    $sectionHolder.remove();\n                }\n            });\n        });\n        $list.on('change', '.sectionType', function () {\n            let $li = $(this).parents('li').first(),\n                val = parseInt($(this).val() as string);\n            $li.removeClass('title textHtml textSimple textEditorial image tabularData pdfAlternative pdfAttachment videoEmbed');\n            if (val === TYPE_TITLE) {\n                $li.addClass('title');\n            } else if (val === TYPE_TEXT_SIMPLE) {\n                $li.addClass('textSimple');\n            } else if (val === TYPE_TEXT_HTML) {\n                $li.addClass('textHtml');\n            } else if (val === TYPE_TEXT_EDITORIAL) {\n                $li.addClass('textEditorial');\n            } else if (val === TYPE_IMAGE) {\n                $li.addClass('image');\n            } else if (val === TYPE_TABULAR) {\n                $li.addClass('tabularData');\n                if ($li.find('.tabularDataRow ul > li').length == 0) {\n                    $li.find('.tabularDataRow .addRow').trigger(\"click\").trigger(\"click\").trigger(\"click\");\n                }\n            } else if (val === TYPE_PDF_ATTACHMENT) {\n                $li.addClass('pdfAttachment');\n            } else if (val === TYPE_PDF_ALTERNATIVE) {\n                $li.addClass('pdfAlternative');\n            } else if (val === TYPE_VIDEO_EMBED) {\n                $li.addClass('videoEmbed');\n            }\n        });\n        $list.find('.sectionType').trigger('change');\n        $list.on('change', '.maxLenSet', function () {\n            let $li = $(this).parents('li').first();\n            if ($(this).prop('checked')) {\n                $li.addClass('maxLenSet').removeClass('no-maxLenSet');\n            } else {\n                $li.addClass('no-maxLenSet').removeClass('maxLenSet');\n            }\n        });\n        $list.find('.maxLenSet').trigger('change');\n\n        $list.on('change', '.nonPublic', function () {\n            let $li = $(this).parents('li').first();\n            if ($(this).prop('checked')) {\n                $li.find('.hasAmendments').prop('checked', false);\n                $li.find('.amendmentRow').addClass('hidden');\n            } else {\n                $li.find('.amendmentRow').removeClass('hidden');\n            }\n        });\n        $list.find('.nonPublic').trigger('change');\n\n        $list.on('change', '.hasExplanation input', function () {\n            let $li = $(this).parents('li').first();\n            if ($(this).prop('checked')) {\n                $li.find('.explanationRow').removeClass(\"hidden\");\n            } else {\n                $li.find('.explanationRow').addClass(\"hidden\");\n            }\n        });\n        $list.find('.hasExplanation input').trigger('change');\n\n        $('.sectionAdder').on('click', function (ev) {\n            ev.preventDefault();\n            let newStr = $('#sectionTemplate').html();\n            newStr = newStr.replace(/#NEW#/g, 'new' + newCounter);\n            let $newObj = $(newStr);\n            $list.append($newObj);\n            newCounter = newCounter + 1;\n\n            $list.find('.sectionType').trigger('change');\n            $list.find('.maxLenSet').trigger('change');\n\n            let $tab = $newObj.find('.tabularDataRow ul');\n            $tab.data(\"sortable\", Sortable.create(<HTMLElement>$tab[0], {\n                handle: '.drag-data-handle',\n                animation: 150\n            }));\n        });\n\n        let dataNewCounter = 0;\n        $list.on('click', '.tabularDataRow .addRow', function (ev) {\n            ev.preventDefault();\n            let $this = $(this),\n                $ul = $this.parent().find(\"ul\"),\n                $row = $($this.data('template').replace(/#NEWDATA#/g, 'new' + dataNewCounter));\n            dataNewCounter = dataNewCounter + 1;\n            $row.removeClass('no0').addClass('no' + $ul.children().length);\n            $ul.append($row);\n            $row.find('input').trigger('focus');\n\n            const $selecionList: any = $row.find('.selectOptions select');\n            $selecionList.selectize({\n                create: true,\n                plugins: [\"remove_button\"],\n                render: {\n                    option_create: (data, escape) => {\n                        return '<div class=\"create\">' + __t('std', 'add_tag') + ': <strong>' + escape(data.input) + '</strong></div>';\n                    }\n                }\n            });\n        });\n\n        $list.on('click', '.tabularDataRow .delRow', function (ev) {\n            let $this = $(this);\n            ev.preventDefault();\n            bootbox.confirm(__t('admin', 'deleteDataConfirm'), function (result) {\n                if (result) {\n                    $this.parents(\"li\").first().remove();\n                }\n            });\n        });\n\n        $list.find('.tabularDataRow ul').each(function () {\n            let $this = $(this);\n            $this.data(\"sortable\", Sortable.create(this, {\n                handle: '.drag-data-handle',\n                animation: 150\n            }));\n\n        });\n\n        $list.on('change', '.tabularTypeSelect', function () {\n            if ($(this).val() == TYPE_TABULAR_SELECT) {\n                $(this).parents(\"li\").first().find(\".selectOptions\").removeClass('hidden');\n            } else {\n                $(this).parents(\"li\").first().find(\".selectOptions\").addClass('hidden');\n            }\n        });\n        $list.find(\".tabularTypeSelect\").trigger(\"change\");\n        $list.find('.selectOptions select').each(function () {\n            let $selecionList: any = $(this);\n            $selecionList.selectize({\n                create: true,\n                plugins: [\"remove_button\"],\n                render: {\n                    option_create: (data, escape) => {\n                        return '<div class=\"create\">' + __t('std', 'add_tag') + ': <strong>' + escape(data.input) + '</strong></div>';\n                    }\n                }\n            });\n        });\n    }\n}\n\n\nnew MotionTypeEdit();\n"]}