define(["require","exports","../shared/PolicySetter"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});new class{constructor(){$(".deleteTypeOpener button").on("click",(()=>{$(".deleteTypeForm").removeClass("hidden"),$(".deleteTypeOpener").addClass("hidden")})),$('[data-toggle="tooltip"]').tooltip(),this.initSectionList(),this.initDeadlines(),this.initInitiatorForm($("#motionSupportersForm")),this.initInitiatorForm($("#amendmentSupportersForm")),$(".policyWidget").each(((e,t)=>{new PolicySetter($(t))}));const e=$("#sameInitiatorSettingsForAmendments input");e.on("change",(()=>{e.prop("checked")?$("section.amendmentSupporters").addClass("hidden"):$("section.amendmentSupporters").removeClass("hidden")})).trigger("change");const t=$("#typeAmendSinglePara"),n=$("#typeAmendSingleChange").parents("label").first();t.on("change",(()=>{t.prop("checked")?n.removeClass("hidden"):n.addClass("hidden")})).trigger("change")}initInitiatorForm(e){const t=e.find(".contactGender input"),n=e.find(".supportType"),a=e.find(".formGroupAllowMore input"),i=e.find(".contactDetails .initiatorCanBePerson input"),r=e.find(".contactDetails .initiatorCanBeOrganization input"),d=e.find(".contactDetails .initiatorSetPermissions input");let o=parseInt(n.find("input").val(),10);const s={hasInitiator:()=>3!==o,hasSupporters:()=>3!==o&&n.find('option[value="'+o.toString(10)+'"]').data("has-supporters"),isCollectingSupporters:()=>2===o,allowSupportAfterSubmission:()=>(2===o||1===o)&&a.is(":checked"),allowFemaleQuota:()=>2===o&&0!==parseInt(t.filter(":checked").val(),10),initiatorCanBePerson:()=>3!==o&&i.prop("checked"),initiatorCanBeOrga:()=>3!==o&&r.prop("checked"),initiatorSetPersonPermissions:()=>3!==o&&d.prop("checked")&&i.prop("checked"),initiatorSetOrgaPermissions:()=>3!==o&&d.prop("checked")&&r.prop("checked")},l=()=>{e.find("[data-visibility]").each((function(){const e=$(this);s[e.data("visibility")]()?e.removeClass("hidden"):e.addClass("hidden")}))};a.on("change",(()=>{l()})).trigger("change"),n.on("change",(()=>{o=parseInt(n.val(),10);const e=n.find('option[value="'+o.toString(10)+'"]').data("has-supporters");l(),this.motionsHaveSupporters=!!e,t.trigger("change"),a.trigger("change"),this.setMaxPdfSupporters()})).trigger("change"),i.on("change",(()=>{i.prop("checked")||r.prop("checked")||r.prop("checked",!0).trigger("change"),l()})),r.on("change",(()=>{r.prop("checked")||i.prop("checked")||i.prop("checked",!0).trigger("change"),l()})),d.on("change",l).trigger("change"),t.on("change",l).trigger("change")}setMaxPdfSupporters(){this.amendmentsHaveSupporters||this.motionsHaveSupporters?$("#typeMaxPdfSupportersRow").removeClass("hidden"):$("#typeMaxPdfSupportersRow").addClass("hidden")}initDeadlines(){$("#deadlineFormTypeComplex").on("change",(e=>{$(e.currentTarget).prop("checked")?($(".deadlineTypeSimple").addClass("hidden"),$(".deadlineTypeComplex").removeClass("hidden")):($(".deadlineTypeSimple").removeClass("hidden"),$(".deadlineTypeComplex").addClass("hidden"))})).trigger("change"),$(".datetimepicker").each(((e,t)=>{const n=$(t);n.datetimepicker({locale:n.find("input").data("locale")})}));const e=e=>{let t=e.find(".datetimepickerFrom"),n=e.find(".datetimepickerTo");t.datetimepicker({locale:t.find("input").data("locale")}),n.datetimepicker({locale:n.find("input").data("locale"),useCurrent:!1});const a=()=>{(()=>{const e=t.data("DateTimePicker").date(),a=n.data("DateTimePicker").date();return e&&a&&a.isBefore(e)})()?(t.addClass("has-error"),n.addClass("has-error")):(t.removeClass("has-error"),n.removeClass("has-error"))};t.on("dp.change",a),n.on("dp.change",a)};$(".deadlineEntry").each(((t,n)=>{e($(n))})),$(".deadlineHolder").each(((t,n)=>{const a=$(n),i=()=>{let t=$(".deadlineRowTemplate").html();t=t.replace(/TEMPLATE/g,a.data("type"));let n=$(t);a.find(".deadlineList").append(n),e(n)};a.find(".deadlineAdder").on("click",i),a.on("click",".delRow",(e=>{$(e.currentTarget).parents(".deadlineEntry").remove()})),0===a.find(".deadlineList").children().length&&i()}))}initSectionList(){let e=$("#sectionsList"),t=0;e.data("sortable",Sortable.create(e[0],{handle:".drag-handle",animation:150})),e.on("click","button.remover",(function(e){e.preventDefault();let t=$(this).parents("li").first(),n=t.data("id");bootbox.confirm(__t("admin","deleteMotionSectionConfirm"),(function(e){e&&($(".adminTypeForm").append('<input type="hidden" name="sectionsTodelete[]" value="'+n+'">'),t.remove())}))})),e.on("change",".sectionType",(function(){let e=$(this).parents("li").first(),t=parseInt($(this).val());e.removeClass("title textHtml textSimple textEditorial image tabularData pdfAlternative pdfAttachment videoEmbed"),0===t?e.addClass("title"):1===t?e.addClass("textSimple"):2===t?e.addClass("textHtml"):8===t?e.addClass("textEditorial"):3===t?e.addClass("image"):4===t?(e.addClass("tabularData"),0==e.find(".tabularDataRow ul > li").length&&e.find(".tabularDataRow .addRow").trigger("click").trigger("click").trigger("click")):5===t?e.addClass("pdfAttachment"):6===t?e.addClass("pdfAlternative"):7===t&&e.addClass("videoEmbed")})),e.find(".sectionType").trigger("change"),e.on("change",".maxLenSet",(function(){let e=$(this).parents("li").first();$(this).prop("checked")?e.addClass("maxLenSet").removeClass("no-maxLenSet"):e.addClass("no-maxLenSet").removeClass("maxLenSet")})),e.find(".maxLenSet").trigger("change"),e.on("change",".nonPublic",(function(){let e=$(this).parents("li").first();$(this).prop("checked")?(e.find(".hasAmendments").prop("checked",!1),e.find(".amendmentRow").addClass("hidden")):e.find(".amendmentRow").removeClass("hidden")})),e.find(".nonPublic").trigger("change"),e.on("change",".hasExplanation input",(function(){let e=$(this).parents("li").first();$(this).prop("checked")?e.find(".explanationRow").removeClass("hidden"):e.find(".explanationRow").addClass("hidden")})),e.find(".hasExplanation input").trigger("change"),$(".sectionAdder").on("click",(function(n){n.preventDefault();let a=$("#sectionTemplate").html();a=a.replace(/#NEW#/g,"new"+t);let i=$(a);e.append(i),t+=1,e.find(".sectionType").trigger("change"),e.find(".maxLenSet").trigger("change");let r=i.find(".tabularDataRow ul");r.data("sortable",Sortable.create(r[0],{handle:".drag-data-handle",animation:150}))}));let n=0;e.on("click",".tabularDataRow .addRow",(function(e){e.preventDefault();let t=$(this),a=t.parent().find("ul"),i=$(t.data("template").replace(/#NEWDATA#/g,"new"+n));n+=1,i.removeClass("no0").addClass("no"+a.children().length),a.append(i),i.find("input").trigger("focus");i.find(".selectOptions select").selectize({create:!0,plugins:["remove_button"],render:{option_create:(e,t)=>'<div class="create">'+__t("std","add_tag")+": <strong>"+t(e.input)+"</strong></div>"}})})),e.on("click",".tabularDataRow .delRow",(function(e){let t=$(this);e.preventDefault(),bootbox.confirm(__t("admin","deleteDataConfirm"),(function(e){e&&t.parents("li").first().remove()}))})),e.find(".tabularDataRow ul").each((function(){$(this).data("sortable",Sortable.create(this,{handle:".drag-data-handle",animation:150}))})),e.on("change",".tabularTypeSelect",(function(){4==$(this).val()?$(this).parents("li").first().find(".selectOptions").removeClass("hidden"):$(this).parents("li").first().find(".selectOptions").addClass("hidden")})),e.find(".tabularTypeSelect").trigger("change"),e.find(".selectOptions select").each((function(){$(this).selectize({create:!0,plugins:["remove_button"],render:{option_create:(e,t)=>'<div class="create">'+__t("std","add_tag")+": <strong>"+t(e.input)+"</strong></div>"}})}))}}}));
//# sourceMappingURL=MotionTypeEdit.js.map
