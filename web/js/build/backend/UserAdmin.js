define(["require","exports"],(function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.UserAdmin=void 0;r.UserAdmin=class{constructor(e){this.element=e[0],this.createVueWidget(),$('[data-toggle="tooltip"]').tooltip()}createVueWidget(){const e=this.element.querySelector(".userAdmin"),r=this.element.getAttribute("data-url-user-save"),s=this.element.getAttribute("data-users"),t=this.element.getAttribute("data-groups"),o=this.element.getAttribute("data-url-poll"),u=this.element.getAttribute("data-url-user-log"),i=this.element.getAttribute("data-url-user-group-log");let n;this.widget=Vue.createApp({template:'<div class="adminUsers">\n                <user-edit-widget\n                    :groups="groups"\n                    ref="user-edit-widget"\n                ></user-edit-widget>\n                <user-admin-widget :users="users"\n                                   :groups="groups"\n                                   :urlUserLog="urlUserLog"\n                                   :urlUserGroupLog="urlUserGroupLog"\n                                   @save-user-groups="saveUserGroups"\n                                   @remove-user="removeUser"\n                                   @create-user-group="createUserGroup"\n                                   @remove-group="removeUserGroup"\n                                   @edit-user="editUser"\n                                   ref="user-admin-widget"\n                ></user-admin-widget>\n            </div>',data:()=>({usersJson:null,users:null,groupsJson:null,groups:null,csrf:document.querySelector("head meta[name=csrf-token]").getAttribute("content"),pollingId:null,urlUserLog:u,urlUserGroupLog:i}),computed:{},methods:{_performOperation:function(e){let s={_csrf:this.csrf};s=Object.assign(s,e);const t=this;$.post(r,s,(function(e){e.msg_success&&bootbox.alert(e.msg_success),e.msg_error?bootbox.alert(e.msg_error):t.setUserGroups(e.users,e.groups)})).catch((function(e){alert(e.responseText)}))},saveUserGroups(e,r){this._performOperation({op:"save-user-groups",userId:e.id,groups:r})},removeUser(e){this._performOperation({op:"remove-user",userId:e.id})},editUser(e){n.$refs["user-edit-widget"].open(e)},setUserGroups(e,r){const s=JSON.stringify(e),t=JSON.stringify(r);s===this.usersJson&&t===this.groupsJson||(this.users=e,this.usersJson=s,this.groups=r,this.groupsJson=t)},createUserGroup(e){this._performOperation({op:"create-user-group",groupName:e})},removeUserGroup(e){this._performOperation({op:"remove-group",groupId:e.id})},reloadData:function(){const e=this;$.get(o,(function(r){e.setUserGroups(r.users,r.groups)})).catch((function(e){console.error("Could not load user data from backend",e)}))},startPolling:function(){const e=this;this.pollingId=window.setInterval((function(){e.reloadData()}),3e3)}},beforeUnmount(){window.clearInterval(this.pollingId)},created(){this.setUserGroups(JSON.parse(s),JSON.parse(t)),this.startPolling()}}),this.widget.config.compilerOptions.whitespace="condense",window.__initVueComponents(this.widget,"users"),n=this.widget.mount(e),window.userWidget=n}}}));
//# sourceMappingURL=UserAdmin.js.map
