{"version":3,"sources":["backend/MoveMotion.js","backend/MoveMotion.ts"],"names":["__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","MoveMotion","constructor","$form","checkBackend","data","initCopyMove","initTarget","initConsultation","initButtonEnabled","find","on","val","addClass","removeClass","$target","selected","filter","rebuildMotionTypes","trigger","$","bind","consultationId","isPrefixAvailable","prefix","operation","consultation","get","checkType","newMotionPrefix","newConsultationId","res","success","rebuildButtonEnabled","isEnabled","length","parseInt","prop"],"mappings":"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","file":"MoveMotion.js","sourcesContent":[null,"export class MoveMotion {\n    private checkBackend: string;\n\n    constructor(private $form: JQuery) {\n        this.checkBackend = $form.data('check-backend');\n        this.initCopyMove();\n        this.initTarget();\n        this.initConsultation();\n        this.initButtonEnabled();\n    }\n\n    private initCopyMove() {\n        this.$form.find('input[name=operation]').on(\"change\", () => {\n            if (this.$form.find('input[name=operation]:checked').val() === 'copynoref') {\n                this.$form.find('.labelTargetMove').addClass('hidden');\n                this.$form.find('.labelTargetCopy').removeClass('hidden');\n                this.$form.find('.targetSame').removeClass('hidden');\n            } else {\n                this.$form.find('.labelTargetMove').removeClass('hidden');\n                this.$form.find('.labelTargetCopy').addClass('hidden');\n                this.$form.find('.targetSame').addClass('hidden');\n            }\n        });\n    }\n\n    private initTarget() {\n        const $target = this.$form.find(\"input[name=target]\");\n        $target.on(\"change\", () => {\n            const selected = $target.filter(\":checked\").val();\n            if (selected === \"agenda\") {\n                this.$form.find(\".moveToAgendaItem\").removeClass('hidden');\n            } else {\n                this.$form.find(\".moveToAgendaItem\").addClass('hidden');\n            }\n            if (selected === \"consultation\") {\n                this.$form.find(\".moveToConsultationItem\").removeClass('hidden');\n            } else {\n                this.$form.find(\".moveToConsultationItem\").addClass('hidden');\n            }\n\n            this.rebuildMotionTypes();\n        }).trigger(\"change\");\n    }\n\n    private initConsultation() {\n        $(\"#consultationId\").on(\"change\", this.rebuildMotionTypes.bind(this));\n    }\n\n    private rebuildMotionTypes() {\n        const consultationId = $(\"#consultationId\").val();\n        $(\".moveToMotionTypeId\").addClass(\"hidden\");\n        if (this.$form.find(\"input[name=target]:checked\").val() === \"consultation\") {\n            $(\".moveToMotionTypeId\" + consultationId).removeClass(\"hidden\");\n        }\n    }\n\n    private isPrefixAvailable(prefix: string, operation: string, consultation: number): Promise<boolean> {\n        return new Promise((resolve, reject) => {\n            return $.get(this.checkBackend, {\n                checkType: 'prefix',\n                operation,\n                newMotionPrefix: prefix,\n                newConsultationId: consultation\n            }).then(res => {\n                resolve(res.success);\n            });\n        });\n    }\n\n    private async rebuildButtonEnabled() {\n        let isEnabled = true;\n\n        let consultationId;\n        if (this.$form.find('input[name=target]:checked').val() === 'consultation' && this.$form.find('[name=consultation]').length > 0) {\n            consultationId = parseInt(this.$form.find('[name=consultation]').val() as string);\n        } else {\n            consultationId = null;\n        }\n\n        const prefixIsAvailable = await this.isPrefixAvailable(\n            this.$form.find('#motionTitlePrefix').val() as string,\n            this.$form.find('input[name=operation]:checked').val() as string,\n            consultationId\n        );\n        if (prefixIsAvailable) {\n            this.$form.find(\".prefixAlreadyTaken\").addClass(\"hidden\");\n        } else {\n            this.$form.find(\".prefixAlreadyTaken\").removeClass(\"hidden\");\n            isEnabled = false;\n        }\n\n        if (!this.$form.find('input[name=operation]:checked').val()) {\n            isEnabled = false;\n        }\n        if (!this.$form.find('input[name=target]:checked').val()) {\n            isEnabled = false;\n        }\n\n        this.$form.find(\"button[type=submit]\").prop(\"disabled\", !isEnabled);\n    }\n\n    private initButtonEnabled() {\n        this.$form.find('#motionTitlePrefix').on('change keyup', this.rebuildButtonEnabled.bind(this));\n        this.$form.find('input[name=operation]').on('change', this.rebuildButtonEnabled.bind(this));\n        this.$form.find('input[name=target]').on('change', this.rebuildButtonEnabled.bind(this));\n        $(\"#consultationId\").on(\"change\", this.rebuildButtonEnabled.bind(this));\n        this.rebuildButtonEnabled();\n    }\n}\n"]}