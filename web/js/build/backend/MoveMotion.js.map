{"version":3,"sources":["backend/MoveMotion.js","backend/MoveMotion.ts"],"names":["__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","define","require","exports","Object","defineProperty","MoveMotion","[object Object]","$form","checkBackend","data","initTarget","initConsultation","initButtonEnabled","$target","find","on","selected","filter","val","removeClass","addClass","rebuildMotionTypes","trigger","$","bind","consultationId","prefix","consultation","get","checkType","newMotionPrefix","newConsultationId","res","isEnabled","length","parseInt","isPrefixAvailable","prop","rebuildButtonEnabled"],"mappings":"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","file":"MoveMotion.js","sourcesContent":[null,"export class MoveMotion {\n    private checkBackend: string;\n\n    constructor(private $form: JQuery) {\n        this.checkBackend = $form.data('check-backend');\n        this.initTarget();\n        this.initConsultation();\n        this.initButtonEnabled();\n    }\n\n    private initTarget() {\n        const $target = this.$form.find(\"input[name=target]\");\n        $target.on(\"change\", () => {\n            const selected = $target.filter(\":checked\").val();\n            if (selected === \"agenda\") {\n                this.$form.find(\".moveToAgendaItem\").removeClass('hidden');\n            } else {\n                this.$form.find(\".moveToAgendaItem\").addClass('hidden');\n            }\n            if (selected === \"consultation\") {\n                this.$form.find(\".moveToConsultationItem\").removeClass('hidden');\n            } else {\n                this.$form.find(\".moveToConsultationItem\").addClass('hidden');\n            }\n\n            this.rebuildMotionTypes();\n        }).trigger(\"change\");\n    }\n\n    private initConsultation() {\n        $(\"#consultationId\").on(\"change\", this.rebuildMotionTypes.bind(this));\n    }\n\n    private rebuildMotionTypes() {\n        const consultationId = $(\"#consultationId\").val();\n        $(\".moveToMotionTypeId\").addClass(\"hidden\");\n        if (this.$form.find(\"input[name=target]:checked\").val() === \"consultation\") {\n            $(\".moveToMotionTypeId\" + consultationId).removeClass(\"hidden\");\n        }\n    }\n\n    private isPrefixAvailable(prefix: string, consultation: number): Promise<boolean> {\n        return new Promise((resolve, reject) => {\n            return $.get(this.checkBackend, {\n                checkType: 'prefix',\n                newMotionPrefix: prefix,\n                newConsultationId: consultation\n            }).then(res => {\n                resolve(res);\n            });\n        });\n    }\n\n    private async rebuildButtonEnabled() {\n        let isEnabled = true;\n\n        let consultationId;\n        if (this.$form.find('input[name=target]:checked').val() === 'consultation' && this.$form.find('[name=consultation]').length > 0) {\n            consultationId = parseInt(this.$form.find('[name=consultation]').val() as string);\n        } else {\n            consultationId = null;\n        }\n\n        const prefixIsAvailable = await this.isPrefixAvailable(this.$form.find('#motionTitlePrefix').val() as string, consultationId);\n        if (prefixIsAvailable) {\n            this.$form.find(\".prefixAlreadyTaken\").addClass(\"hidden\");\n        } else {\n            this.$form.find(\".prefixAlreadyTaken\").removeClass(\"hidden\");\n            isEnabled = false;\n        }\n\n        if (!this.$form.find('input[name=operation]:checked').val()) {\n            isEnabled = false;\n        }\n        if (!this.$form.find('input[name=target]:checked').val()) {\n            isEnabled = false;\n        }\n\n        this.$form.find(\"button[type=submit]\").prop(\"disabled\", !isEnabled);\n    }\n\n    private initButtonEnabled() {\n        this.$form.find('#motionTitlePrefix').on('change keyup', this.rebuildButtonEnabled.bind(this));\n        this.$form.find('input[name=operation]').on('change', this.rebuildButtonEnabled.bind(this));\n        this.$form.find('input[name=target]').on('change', this.rebuildButtonEnabled.bind(this));\n        $(\"#consultationId\").on(\"change\", this.rebuildButtonEnabled.bind(this));\n        this.rebuildButtonEnabled();\n    }\n}\n"]}