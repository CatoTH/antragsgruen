import"./MotionSupporterEdit";import{MotionSupporterEdit}from"./MotionSupporterEdit";import{AntragsgruenEditor}from"../shared/AntragsgruenEditor";import{AmendmentEditSinglePara}from"../shared/AmendmentEditSinglePara";const STATUS_VOTE=11,STATUS_OBSOLETED_BY_MOTION=32,STATUS_OBSOLETED_BY_AMENDMENT=22;export class AmendmentEdit{constructor(){this.lang=$("html").attr("lang"),this.$updateForm=$("#amendmentUpdateForm"),this.$status=$("#amendmentStatus"),this.$editTextCaller=$("#amendmentTextEditCaller"),$("#amendmentDateCreationHolder").datetimepicker({locale:this.lang}),$("#amendmentDateSubmissionHolder").datetimepicker({locale:this.lang}),$("#amendmentDateResolutionHolder").datetimepicker({locale:this.lang}),$("#resolutionDateHolder").datetimepicker({locale:$("#resolutionDate").data("locale"),format:"L"}),this.$editTextCaller.find("button").on("click",this.textEditCalled.bind(this)),$(".wysiwyg-textarea .resetText").on("click",t=>{let e=$(t.currentTarget).parents(".wysiwyg-textarea").find(".texteditor");window.CKEDITOR.instances[e.attr("id")].setData(e.data("original-html")),$(t.currentTarget).parents(".modifiedActions").addClass("hidden")}),$(".amendmentDeleteForm").on("submit",function(t,e){if(e&&(e.confirmed,1)&&!0===e.confirmed)return;let n=$(this);t.preventDefault(),bootbox.confirm(__t("admin","delAmendmentConfirm"),function(t){t&&n.trigger("submit",{confirmed:!0})})}),this.initVotingFunctions(),this.initStatus(),new MotionSupporterEdit($("#motionSupporterHolder"))}textEditCalledMultiPara(){$(".wysiwyg-textarea").each(function(){let t=$(this).find(".texteditor"),e=new AntragsgruenEditor(t.attr("id")).getEditor();t.parents("form").on("submit",function(){t.parent().find("textarea.raw").val(e.getData()),void 0!==e.plugins.lite&&(e.plugins.lite.findPlugin(e).acceptAll(),t.parent().find("textarea.consolidated").val(e.getData()))})})}textEditCalled(){this.$editTextCaller.addClass("hidden"),$("#amendmentTextEditHolder").removeClass("hidden"),this.$editTextCaller.data("multiple-paragraphs")?this.textEditCalledMultiPara():new AmendmentEditSinglePara,$("#amendmentUpdateForm").append("<input type='hidden' name='edittext' value='1'>")}initStatus(){const t=()=>{const t=parseInt(document.getElementById("amendmentStatus").value,10);32===t?(document.querySelector(".amendmentStatusString").classList.add("hidden"),document.querySelector(".amendmentStatusMotion").classList.remove("hidden"),document.querySelector(".amendmentStatusAmendment").classList.add("hidden")):22===t?(document.querySelector(".amendmentStatusString").classList.add("hidden"),document.querySelector(".amendmentStatusMotion").classList.add("hidden"),document.querySelector(".amendmentStatusAmendment").classList.remove("hidden")):(document.querySelector(".amendmentStatusString").classList.remove("hidden"),document.querySelector(".amendmentStatusMotion").classList.add("hidden"),document.querySelector(".amendmentStatusAmendment").classList.add("hidden"))};document.getElementById("amendmentStatus").addEventListener("change",t),t()}initVotingFunctions(){const t=$(".contentVotingResultCaller, .votingDataHolder"),e=$(".votingDataCloser"),n=$(".votingDataOpener"),a=$("select[name=votingBlockId]");n.on("click",()=>{t.addClass("explicitlyOpened")}),e.on("click",()=>{t.removeClass("explicitlyOpened")}),this.$status.on("change",()=>{11===parseInt(this.$status.val(),10)?t.addClass("hasVotingStatus"):t.removeClass("hasVotingStatus")}).trigger("change"),$(".votingItemBlockRow select").on("change",t=>{const e=$(t.currentTarget);if(e.val()){const t=e.find("option[value="+e.val()+"]").data("group-name");$(".votingItemBlockNameRow input").val(t),$(".votingItemBlockNameRow").removeClass("hidden")}else $(".votingItemBlockNameRow").addClass("hidden")}),a.on("change",()=>{if("NEW"===a.val())$(".votingBlockRow .newBlock").removeClass("hidden"),$(".votingItemBlockRow").addClass("hidden"),$(".votingItemBlockNameRow").addClass("hidden");else{$(".votingBlockRow .newBlock").addClass("hidden"),$(".votingItemBlockRow").addClass("hidden");const t=$(".votingItemBlockRow"+a.val());t.removeClass("hidden"),t.length>0?(t.removeClass("hidden"),t.find("select").trigger("change")):$(".votingItemBlockNameRow").addClass("hidden")}}).trigger("change")}}
//# sourceMappingURL=AmendmentEdit.js.map
