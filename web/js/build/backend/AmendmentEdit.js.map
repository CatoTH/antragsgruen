{"version":3,"sources":["backend/AmendmentEdit.js","backend/AmendmentEdit.ts"],"names":["define","require","exports","MotionSupporterEdit_1","AntragsgruenEditor_1","AmendmentEditSinglePara_1","Object","defineProperty","value","AmendmentEdit","constructor","this","lang","$","attr","$updateForm","$status","$editTextCaller","datetimepicker","locale","data","format","find","on","textEditCalled","bind","ev","$text","currentTarget","parents","window","setData","addClass","confirmed","$form","preventDefault","bootbox","confirm","__t","result","trigger","initVotingFunctions","initStatus","MotionSupporterEdit","textEditCalledMultiPara","each","$textarea","ckeditor","AntragsgruenEditor","getEditor","parent","val","getData","plugins","lite","findPlugin","acceptAll","removeClass","AmendmentEditSinglePara","append","onChange","newStatus","parseInt","document","getElementById","querySelector","classList","add","remove","addEventListener","$classHolders","$closer","$opener","$votingBlockId","$select","selectedName","$votingItemBlockRow","length"],"mappings":"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","file":"AmendmentEdit.js","sourcesContent":[null,"import \"./MotionSupporterEdit\";\nimport { MotionSupporterEdit } from \"./MotionSupporterEdit\";\nimport { AntragsgruenEditor } from \"../shared/AntragsgruenEditor\";\nimport editor = CKEDITOR.editor;\nimport { AmendmentEditSinglePara } from \"../shared/AmendmentEditSinglePara\";\n\nconst STATUS_VOTE = 11;\nconst STATUS_OBSOLETED_BY_MOTION = 32;\nconst STATUS_OBSOLETED_BY_AMENDMENT = 22;\n\nexport class AmendmentEdit {\n    private lang: string;\n\n    private $updateForm: JQuery;\n    private $status: JQuery;\n    private $editTextCaller: JQuery;\n\n    constructor() {\n        this.lang = $(\"html\").attr(\"lang\");\n        this.$updateForm = $(\"#amendmentUpdateForm\");\n        this.$status = $(\"#amendmentStatus\");\n        this.$editTextCaller = $(\"#amendmentTextEditCaller\");\n\n        $(\"#amendmentDateCreationHolder\").datetimepicker({\n            locale: this.lang\n        });\n        $(\"#amendmentDateResolutionHolder\").datetimepicker({\n            locale: this.lang\n        });\n        $('#resolutionDateHolder').datetimepicker({\n            locale: $('#resolutionDate').data('locale'),\n            format: 'L'\n        });\n\n        this.$editTextCaller.find(\"button\").on(\"click\", this.textEditCalled.bind(this));\n\n        $('.wysiwyg-textarea .resetText').on(\"click\", (ev) => {\n            let $text: JQuery = $(ev.currentTarget).parents('.wysiwyg-textarea').find('.texteditor');\n            window['CKEDITOR']['instances'][$text.attr('id')].setData($text.data('original-html'));\n\n            $(ev.currentTarget).parents('.modifiedActions').addClass('hidden');\n        });\n\n        $(\".amendmentDeleteForm\").on(\"submit\", function (ev, data) {\n            if (data && typeof (data.confirmed) && data.confirmed === true) {\n                return;\n            }\n            let $form = $(this);\n            ev.preventDefault();\n            bootbox.confirm(__t(\"admin\", \"delAmendmentConfirm\"), function (result) {\n                if (result) {\n                    $form.trigger(\"submit\", {'confirmed': true});\n                }\n            });\n        });\n\n        this.initVotingFunctions();\n        this.initStatus();\n\n        new MotionSupporterEdit($(\"#motionSupporterHolder\"));\n    }\n\n\n    private textEditCalledMultiPara() {\n        $(\".wysiwyg-textarea\").each(function () {\n            let $holder = $(this),\n                $textarea = $holder.find(\".texteditor\");\n\n            let editor: AntragsgruenEditor = new AntragsgruenEditor($textarea.attr(\"id\")),\n                ckeditor: editor = editor.getEditor();\n\n            $textarea.parents(\"form\").on(\"submit\", function () {\n                $textarea.parent().find(\"textarea.raw\").val(ckeditor.getData());\n                if (typeof (ckeditor.plugins.lite) != 'undefined') {\n                    ckeditor.plugins.lite.findPlugin(ckeditor).acceptAll();\n                    $textarea.parent().find(\"textarea.consolidated\").val(ckeditor.getData());\n                }\n            });\n        });\n    }\n\n    private textEditCalled() {\n        this.$editTextCaller.addClass(\"hidden\");\n        $(\"#amendmentTextEditHolder\").removeClass(\"hidden\");\n        if (this.$editTextCaller.data(\"multiple-paragraphs\")) {\n            this.textEditCalledMultiPara();\n        } else {\n            new AmendmentEditSinglePara();\n        }\n        $(\"#amendmentUpdateForm\").append(\"<input type='hidden' name='edittext' value='1'>\");\n    }\n\n    private initStatus() {\n        const onChange = () => {\n            const newStatus = parseInt((document.getElementById('amendmentStatus') as HTMLSelectElement).value, 10);\n            if (newStatus === STATUS_OBSOLETED_BY_MOTION) {\n                document.querySelector('.amendmentStatusString').classList.add('hidden');\n                document.querySelector('.amendmentStatusMotion').classList.remove('hidden');\n                document.querySelector('.amendmentStatusAmendment').classList.add('hidden');\n            } else if (newStatus === STATUS_OBSOLETED_BY_AMENDMENT) {\n                document.querySelector('.amendmentStatusString').classList.add('hidden');\n                document.querySelector('.amendmentStatusMotion').classList.add('hidden');\n                document.querySelector('.amendmentStatusAmendment').classList.remove('hidden');\n            } else {\n                document.querySelector('.amendmentStatusString').classList.remove('hidden');\n                document.querySelector('.amendmentStatusMotion').classList.add('hidden');\n                document.querySelector('.amendmentStatusAmendment').classList.add('hidden');\n            }\n        };\n        document.getElementById('amendmentStatus').addEventListener('change', onChange);\n        onChange();\n    }\n\n    private initVotingFunctions() {\n        const $classHolders = $(\".contentVotingResultCaller, .votingDataHolder\"),\n            $closer = $(\".votingDataCloser\"),\n            $opener = $(\".votingDataOpener\"),\n            $votingBlockId = $('select[name=votingBlockId]');\n\n        $opener.on(\"click\", () => {\n            $classHolders.addClass('explicitlyOpened');\n        });\n        $closer.on(\"click\", () => {\n            $classHolders.removeClass('explicitlyOpened');\n        });\n\n        this.$status.on('change', () => {\n            if (parseInt(this.$status.val() as string, 10) === STATUS_VOTE) {\n                $classHolders.addClass('hasVotingStatus');\n            } else {\n                $classHolders.removeClass('hasVotingStatus');\n            }\n        }).trigger('change');\n\n        $(\".votingItemBlockRow select\").on('change', (ev) => {\n            const $select = $(ev.currentTarget);\n            if ($select.val()) {\n                const selectedName = $select.find(\"option[value=\" + $select.val() + \"]\").data(\"group-name\");\n                $(\".votingItemBlockNameRow input\").val(selectedName);\n                $(\".votingItemBlockNameRow\").removeClass('hidden');\n            } else {\n                // Not grouped\n                $(\".votingItemBlockNameRow\").addClass('hidden');\n            }\n        });\n\n        $votingBlockId.on('change', () => {\n            if ($votingBlockId.val() === 'NEW') {\n                $(\".votingBlockRow .newBlock\").removeClass('hidden');\n                $(\".votingItemBlockRow\").addClass('hidden');\n                $(\".votingItemBlockNameRow\").addClass('hidden');\n            } else {\n                $(\".votingBlockRow .newBlock\").addClass('hidden');\n                $(\".votingItemBlockRow\").addClass('hidden');\n                const $votingItemBlockRow = $(\".votingItemBlockRow\" + $votingBlockId.val());\n                $votingItemBlockRow.removeClass('hidden');\n                if ($votingItemBlockRow.length > 0) {\n                    $votingItemBlockRow.removeClass('hidden');\n                    $votingItemBlockRow.find(\"select\").trigger('change'); // to trigger group name listener\n                } else {\n                    $(\".votingItemBlockNameRow\").addClass('hidden');\n                }\n            }\n        }).trigger('change');\n    }\n}\n"]}