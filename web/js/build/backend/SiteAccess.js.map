{"version":3,"sources":["backend/SiteAccess.ts"],"names":["SiteAccess","constructor","this","initSite","initUserList","initDelUser","initAdmins","initConPwd","$","on","prop","removeClass","addClass","trigger","ev","preventDefault","$button","currentTarget","$form","parents","first","msg","__t","replace","data","bootbox","confirm","result","id","append","find","$adminForm","$card","$widget","$checkbox","stopPropagation"],"mappings":"AAAA,MAAMA,WAGF,WAAAC,GACIC,KAAKC,WACLD,KAAKE,eACLF,KAAKG,cACLH,KAAKI,aACLJ,KAAKK,YACT,CAEQ,QAAAJ,GACJK,EAAE,8BAA8BC,GAAG,UAAU,WACrCD,EAAEN,MAAMQ,KAAK,WACbF,EAAE,qBAAqBG,YAAY,UAEnCH,EAAE,qBAAqBI,SAAS,SAExC,IAAGC,QAAQ,SACf,CAEQ,WAAAR,GACJG,EAAE,iCAAiCC,GAAG,SAAUK,IAC5CA,EAAGC,iBACH,MAAMC,EAAUR,EAAEM,EAAGG,eACjBC,EAAQV,EAAEM,EAAGG,eAAeE,QAAQ,QAAQC,QAE1CC,EAAMC,IAAI,QAAS,qBAAqBC,QAAQ,SAAUP,EAAQQ,KAAK,SAC7EC,QAAQC,QAAQL,GAAMM,IAClB,GAAIA,EAAQ,CACR,IAAIC,EAAKZ,EAAQQ,KAAK,MACtBN,EAAMW,OAAO,iDAAmDD,EAAK,MACrEV,EAAML,QAAQ,SAClB,IACF,GAEV,CAEQ,YAAAT,GACJI,EAAE,yDAAyDC,GAAG,UAAU,WAC/DD,EAAEN,MAAMQ,KAAK,YACdF,EAAEN,MAAMiB,QAAQ,MAAMC,QAAQU,KAAK,yCAAyCpB,KAAK,WAAW,EAEpG,IACAF,EAAE,2DAA2DC,GAAG,UAAU,WAClED,EAAEN,MAAMQ,KAAK,YACbF,EAAEN,MAAMiB,QAAQ,MAAMC,QAAQU,KAAK,uCAAuCpB,KAAK,WAAW,EAElG,GACJ,CAEQ,UAAAJ,GACJJ,KAAK6B,WAAavB,EAAE,cAEpBN,KAAK6B,WAAWtB,GAAG,QAAS,gBAAiBK,IACzC,IAAIE,EAAUR,EAAEM,EAAGG,eACfC,EAAQV,EAAEM,EAAGG,eAAeE,QAAQ,QAAQC,QAEhDK,QAAQC,QAAQJ,IAAI,QAAS,uBAAwBK,IACjD,GAAIA,EAAQ,CACR,IAAIC,EAAKZ,EAAQQ,KAAK,MACtBN,EAAMW,OAAO,kDAAoDD,EAAK,MACtEV,EAAML,QAAQ,SAClB,IACF,IAGNX,KAAK6B,WAAWtB,GAAG,SAAU,8BAA+BK,IACxD,IAAIkB,EAAQxB,EAAEM,EAAGG,eAAeE,QAAQ,cAAcC,QAClDZ,EAAEM,EAAGG,eAAeP,KAAK,WACzBsB,EAAMF,KAAK,2BAA2BlB,SAAS,UAE/CoB,EAAMF,KAAK,2BAA2BnB,YAAY,SACtD,IAEJT,KAAK6B,WAAWD,KAAK,8BAA8BjB,QAAQ,UAE3DX,KAAK6B,WAAWD,KAAK,oBAAoBrB,GAAG,SAAUK,IAClDN,EAAEM,EAAGG,eAAeE,QAAQ,cAAcW,KAAK,cAAcnB,YAAY,UAAUmB,KAAK,SAASjB,QAAQ,SACzGL,EAAEM,EAAGG,eAAeL,SAAS,SAAS,GAE9C,CAEQ,UAAAL,GACJ,MAAM0B,EAAUzB,EAAE,UACd0B,EAAYD,EAAQH,KAAK,gCAC7BI,EAAUzB,GAAG,UAAU,KACfyB,EAAUxB,KAAK,WACfuB,EAAQrB,SAAS,WAEjBqB,EAAQtB,YAAY,UACxB,IACDE,QAAQ,UAEXoB,EAAQH,KAAK,mBAAmBrB,GAAG,SAASK,IACxCA,EAAGC,iBACHD,EAAGqB,kBACHF,EAAQrB,SAAS,YAAY,GAErC,EAGJ,IAAIZ","file":"SiteAccess.js","sourcesContent":["class SiteAccess {\n    private $adminForm: JQuery;\n\n    constructor() {\n        this.initSite();\n        this.initUserList();\n        this.initDelUser();\n        this.initAdmins();\n        this.initConPwd();\n    }\n\n    private initSite() {\n        $(\".managedUserAccounts input\").on(\"change\", function () {\n            if ($(this).prop(\"checked\")) {\n                $(\".showManagedUsers\").removeClass('hidden');\n            } else {\n                $(\".showManagedUsers\").addClass('hidden');\n            }\n        }).trigger(\"change\");\n    }\n\n    private initDelUser() {\n        $(\".accountListTable .deleteUser\").on(\"click\", (ev) => {\n            ev.preventDefault();\n            const $button = $(ev.currentTarget),\n                $form = $(ev.currentTarget).parents(\"form\").first();\n\n            const msg = __t(\"admin\", \"removeUserConfirm\").replace(/%NAME%/, $button.data(\"name\"));\n            bootbox.confirm(msg, (result) => {\n                if (result) {\n                    let id = $button.data(\"id\");\n                    $form.append('<input type=\"hidden\" name=\"deleteUser\" value=\"' + id + '\">');\n                    $form.trigger(\"submit\");\n                }\n            });\n        });\n    }\n\n    private initUserList() {\n        $('.accountListTable .accessViewCol input[type=checkbox]').on(\"change\", function () {\n            if (!$(this).prop(\"checked\")) {\n                $(this).parents('tr').first().find('.accessCreateCol input[type=checkbox]').prop('checked', false);\n            }\n        });\n        $('.accountListTable .accessCreateCol input[type=checkbox]').on(\"change\", function () {\n            if ($(this).prop(\"checked\")) {\n                $(this).parents('tr').first().find('.accessViewCol input[type=checkbox]').prop('checked', true);\n            }\n        });\n    }\n\n    private initAdmins() {\n        this.$adminForm = $(\"#adminForm\");\n\n        this.$adminForm.on('click', '.removeAdmin', (ev) => {\n            let $button = $(ev.currentTarget),\n                $form = $(ev.currentTarget).parents(\"form\").first();\n\n            bootbox.confirm(__t(\"admin\", \"removeAdminConfirm\"), (result) => {\n                if (result) {\n                    let id = $button.data(\"id\");\n                    $form.append('<input type=\"hidden\" name=\"removeAdmin\" value=\"' + id + '\">');\n                    $form.trigger(\"submit\");\n                }\n            });\n        });\n\n        this.$adminForm.on('change', '.adminCard .typeSite input', (ev) => {\n            let $card = $(ev.currentTarget).parents('.adminCard').first();\n            if ($(ev.currentTarget).prop('checked')) {\n                $card.find('.typeCon, .typeProposal').addClass('hidden');\n            } else {\n                $card.find('.typeCon, .typeProposal').removeClass('hidden');\n            }\n        });\n        this.$adminForm.find('.adminCard .typeSite input').trigger('change');\n\n        this.$adminForm.find(\".ppReplyToOpener\").on(\"click\", (ev) => {\n            $(ev.currentTarget).parents(\".adminCard\").find(\".ppReplyTo\").removeClass(\"hidden\").find(\"input\").trigger(\"focus\");\n            $(ev.currentTarget).addClass(\"hidden\");\n        });\n    }\n\n    private initConPwd() {\n        const $widget = $(\".conpw\"),\n            $checkbox = $widget.find('.setter input[type=checkbox]');\n        $checkbox.on(\"change\", () => {\n            if ($checkbox.prop(\"checked\")) {\n                $widget.addClass(\"checked\");\n            } else {\n                $widget.removeClass(\"checked\");\n            }\n        }).trigger(\"change\");\n\n        $widget.find('.setNewPassword').on(\"click\", ev => {\n            ev.preventDefault();\n            ev.stopPropagation();\n            $widget.addClass('changePwd');\n        });\n    }\n}\n\nnew SiteAccess();\n"]}