{"version":3,"sources":["backend/VotingAdmin.js","backend/VotingAdmin.ts"],"names":["define","require","exports","Object","defineProperty","value","VotingAdmin","constructor","$element","this","element","votingInitJson","getAttribute","createVueWidget","initVotingCreater","initVotingSorter","$","tooltip","vueEl","querySelector","voteSettingsUrl","voteCreateUrl","voteDownloadUrl","addableMotions","JSON","parse","pollUrl","initUserGroups","sortUrl","widget","Vue","createApp","template","data","isSorting","votingsJson","votings","userGroups","csrf","document","pollingId","onReloadedCbs","computed","alreadyAddedItems","motions","amendments","forEach","voting","items","item","type","push","id","methods","_performOperation","votingBlockId","additionalProps","postData","_csrf","assign","url","replace","post","undefined","success","alert","message","catch","err","responseText","setVotingFromJson","setVotingFromObject","toggleSorting","setStatus","newStatus","op","status","saveSettings","title","answerTemplate","majorityType","quorumType","hasGeneralAbstention","votePolicy","maxVotesByGroup","resultsPublic","votesPublic","votingTime","assignedMotion","votesNames","onSorted","sortedIds","votingIds","deleteVoting","createVoting","answers","specificQuestion","cb","window","setTimeout","scrollintoview","top_offset","removeItem","itemType","itemId","addIMotion","itemDefinition","addQuestion","question","setVotersToUserGroup","userIds","newUserGroup","addReloadedCb","reloadData","get","console","error","startPolling","setInterval","beforeUnmount","clearInterval","created","config","compilerOptions","whitespace","widgetComponent","mount","initPolicyWidget","$widget","$select","find","loadUrl","selectizeOption","loadThrottle","valueField","labelField","searchField","load","query","then","res","render","option_create","escape","__t","input","selectize","$policySelect","on","parseInt","val","removeClass","addClass","trigger","sortToggle","addEventListener","length","classList","remove","add","opener","form","getRadioListValue","selector","defaultValue","querySelectorAll","el","checked","recalcQuestionListener","recalcAnswerTypeListener","selectedAnswerType","ev","stopPropagation","preventDefault","assigned","map"],"mappings":"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","file":"VotingAdmin.js","sourcesContent":[null,"declare let Vue: any;\n\nconst POLICY_USER_GROUPS: number = 6;\n\nconst ANSWER_TEMPLATE_YES_NO_ABSTENTION: number = 0;\nconst ANSWER_TEMPLATE_YES_NO: number = 1;\nconst ANSWER_TEMPLATE_YES: number = 3;\nconst ANSWER_TEMPLATE_PRESENT: number = 2;\n\nexport class VotingAdmin {\n    private widget: any;\n    private widgetComponent: any;\n    private element: HTMLElement;\n\n    constructor($element: JQuery) {\n        this.element = $element[0];\n\n        const votingInitJson = this.element.getAttribute('data-voting');\n        this.createVueWidget(votingInitJson);\n        this.initVotingCreater();\n        this.initVotingSorter(votingInitJson);\n\n        $('[data-toggle=\"tooltip\"]').tooltip();\n    }\n\n    private createVueWidget(votingInitJson) {\n        const vueEl = this.element.querySelector(\".votingAdmin\");\n        const voteSettingsUrl = this.element.getAttribute('data-url-vote-settings');\n        const voteCreateUrl = this.element.getAttribute('data-vote-create');\n        const voteDownloadUrl = this.element.getAttribute('data-url-vote-download');\n        const addableMotions = JSON.parse(this.element.getAttribute('data-addable-motions'));\n        const pollUrl = this.element.getAttribute('data-url-poll');\n        const initUserGroups = JSON.parse(this.element.getAttribute('data-user-groups'));\n        const sortUrl = this.element.getAttribute('data-url-sort');\n\n        this.widget = Vue.createApp({\n            template: `<div class=\"adminVotings\">\n                <voting-sort-widget\n                    v-if=\"isSorting\"\n                    :votings=\"votings\"\n                    ref=\"voting-sort-widget\"\n                    @sorted=\"onSorted\"></voting-sort-widget>\n                <voting-admin-widget\n                    v-if=\"!isSorting\"\n                    v-for=\"voting in votings\"\n                    :key=\"voting.id\"\n                    :voting=\"voting\"\n                    :addableMotions=\"addableMotions\"\n                    :alreadyAddedItems=\"alreadyAddedItems\"\n                    :userGroups=\"userGroups\"\n                    :voteDownloadUrl=\"voteDownloadUrl\"\n                    @set-status=\"setStatus\"\n                    @save-settings=\"saveSettings\"\n                    @remove-item=\"removeItem\"\n                    @delete-voting=\"deleteVoting\"\n                    @add-imotion=\"addIMotion\"\n                    @add-question=\"addQuestion\"\n                    @set-voters-to-user-group=\"setVotersToUserGroup\"\n                    ref=\"voting-admin-widget\"\n                ></voting-admin-widget>\n            </div>`,\n            data() {\n                return {\n                    isSorting: false,\n                    votingsJson: null,\n                    votings: null,\n                    userGroups: initUserGroups,\n                    voteDownloadUrl,\n                    addableMotions,\n                    csrf: document.querySelector('head meta[name=csrf-token]').getAttribute('content'),\n                    pollingId: null,\n                    onReloadedCbs: []\n                };\n            },\n            computed: {\n                alreadyAddedItems: function () {\n                    const motions = [];\n                    const amendments = [];\n                    this.votings.forEach(voting => {\n                        voting.items.forEach(item => {\n                            if (item.type === 'motion') {\n                                motions.push(item.id);\n                            }\n                            if (item.type === 'amendment') {\n                                amendments.push(item.id);\n                            }\n                        });\n                    });\n                    return {motions, amendments};\n                }\n            },\n            methods: {\n                _performOperation: function (votingBlockId, additionalProps) {\n                    let postData = {\n                        _csrf: this.csrf,\n                    };\n                    if (additionalProps) {\n                        postData = Object.assign(postData, additionalProps);\n                    }\n                    const widget = this;\n                    const url = voteSettingsUrl.replace(/VOTINGBLOCKID/, votingBlockId);\n                    $.post(url, postData, function (data) {\n                        if (data.success !== undefined && !data.success) {\n                            alert(data.message);\n                            return;\n                        }\n                        widget.votings = data;\n                    }).catch(function (err) {\n                        alert(err.responseText);\n                    });\n                },\n                setVotingFromJson(data) {\n                    if (data === this.votingsJson) {\n                        return;\n                    }\n                    this.votings = JSON.parse(data);\n                    this.votingsJson = data;\n                },\n                setVotingFromObject(data) {\n                    this.votings = data;\n                    this.votingsJson = null;\n                },\n                toggleSorting() {\n                    this.isSorting = !this.isSorting;\n                },\n                setStatus(votingBlockId, newStatus) {\n                    this._performOperation(votingBlockId, {\n                        op: 'update-status',\n                        status: newStatus,\n                    });\n                },\n                saveSettings(votingBlockId, title, answerTemplate, majorityType, quorumType, hasGeneralAbstention, votePolicy, maxVotesByGroup, resultsPublic, votesPublic, votingTime, assignedMotion, votesNames) {\n                    this._performOperation(votingBlockId, {\n                        op: 'save-settings',\n                        title,\n                        answerTemplate,\n                        majorityType,\n                        quorumType,\n                        hasGeneralAbstention: (hasGeneralAbstention ? 1 : 0),\n                        votePolicy,\n                        maxVotesByGroup,\n                        resultsPublic,\n                        votesPublic,\n                        votingTime,\n                        assignedMotion,\n                        votesNames,\n                    });\n                },\n                onSorted(sortedIds) {\n                    let postData = {\n                        _csrf: this.csrf,\n                        votingIds: sortedIds\n                    };\n                    const widget = this;\n                    $.post(sortUrl, postData, function (data) {\n                        if (data.success !== undefined && !data.success) {\n                            alert(data.message);\n                            return;\n                        }\n                        widget.votings = data;\n                        widget.isSorting = false;\n                    }).catch(function (err) {\n                        alert(err.responseText);\n                    });\n                },\n                deleteVoting(votingBlockId) {\n                    this._performOperation(votingBlockId, {\n                        op: 'delete-voting',\n                    });\n                },\n                createVoting: function (type, answers, title, specificQuestion, assignedMotion, majorityType, votePolicy, userGroups, resultsPublic, votesPublic, votesNames) {\n                    let postData = {\n                        _csrf: this.csrf,\n                        type,\n                        answers,\n                        title,\n                        specificQuestion,\n                        assignedMotion,\n                        majorityType,\n                        votePolicy,\n                        userGroups,\n                        resultsPublic,\n                        votesPublic,\n                        votesNames\n                    };\n\n                    const widget = this;\n                    $.post(voteCreateUrl, postData, function (data) {\n                        if (data.success !== undefined && !data.success) {\n                            alert(data.message);\n                            return;\n                        }\n                        widget.votings = data['votings'];\n                        widget.onReloadedCbs.forEach(cb => {\n                            cb(widget.votings);\n                        });\n\n                        window.setTimeout(() => {\n                            $(\"#voting\" + data['created_voting']).scrollintoview({top_offset: -100});\n                        }, 200);\n                    }).catch(function (err) {\n                        alert(err.responseText);\n                    });\n                },\n                removeItem(votingBlockId, itemType, itemId) {\n                    this._performOperation(votingBlockId, {\n                        op: 'remove-item',\n                        itemType,\n                        itemId\n                    });\n                },\n                addIMotion(votingBlockId, itemDefinition) {\n                    this._performOperation(votingBlockId, {\n                        op: 'add-imotion',\n                        itemDefinition\n                    });\n                },\n                addQuestion(votingBlockId, question) {\n                    this._performOperation(votingBlockId, {\n                        op: 'add-question',\n                        question\n                    });\n                },\n                setVotersToUserGroup(votingBlockId, userIds, newUserGroup) {\n                    this._performOperation(votingBlockId, {\n                        op: 'set-voters-to-user-group',\n                        userIds,\n                        newUserGroup\n                    });\n                },\n                addReloadedCb: function (cb) {\n                    this.onReloadedCbs.push(cb);\n                },\n                reloadData: function () {\n                    const widget = this;\n                    $.get(pollUrl, function (data) {\n                        widget.setVotingFromJson(data);\n                        widget.onReloadedCbs.forEach(cb => {\n                            cb(widget.votings);\n                        });\n                    }, 'text').catch(function (err) {\n                        console.error(\"Could not load voting data from backend\", err);\n                    });\n                },\n                startPolling: function () {\n                    const widget = this;\n                    this.pollingId = window.setInterval(function () {\n                        widget.reloadData();\n                    }, 3000);\n                }\n            },\n            beforeUnmount() {\n                window.clearInterval(this.pollingId)\n            },\n            created() {\n                this.setVotingFromJson(votingInitJson);\n                this.startPolling()\n            }\n        });\n\n        this.widget.config.compilerOptions.whitespace = 'condense';\n        window['__initVueComponents'](this.widget, 'voting');\n\n        this.widgetComponent = this.widget.mount(vueEl);\n\n        // Used by tests to control vue-select\n        window['votingAdminWidget'] = this.widgetComponent;\n    }\n\n    private initPolicyWidget() {\n        const $widget = $(this.element);\n        const $select: any = $widget.find('.userGroupSelect'),\n            loadUrl = $select.data('load-url');\n        let selectizeOption = {};\n        if (loadUrl) {\n            selectizeOption = Object.assign(selectizeOption, {\n                loadThrottle: null,\n                valueField: 'id',\n                labelField: 'label',\n                searchField: 'label',\n                load: function (query, cb) {\n                    if (!query) return cb();\n                    return $.get(loadUrl, {query}).then(res => {\n                        cb(res);\n                    });\n                },\n                render: {\n                    option_create: (data, escape) => {\n                        return '<div class=\"create\">' + __t('std', 'add_tag') + ': <strong>' + escape(data.input) + '</strong></div>';\n                    }\n                }\n            });\n        }\n        $select.find(\"select\").selectize(selectizeOption);\n\n        const $policySelect = $widget.find(\".policySelect\");\n        $policySelect.on(\"change\", () => {\n            if (parseInt($policySelect.val() as string, 10) === POLICY_USER_GROUPS) {\n                $select.removeClass(\"hidden\");\n            } else {\n                $select.addClass(\"hidden\");\n            }\n        }).trigger(\"change\");\n    }\n\n    private initVotingSorter(votingInitJson) {\n        const sortToggle = this.element.querySelector('.sortVotings');\n        sortToggle.addEventListener('click', () => {\n            this.widgetComponent.toggleSorting();\n        });\n        if (JSON.parse(votingInitJson).length > 1) {\n            sortToggle.classList.remove('hidden');\n        }\n\n        this.widgetComponent.addReloadedCb(data => {\n            if (data.length > 1) {\n                sortToggle.classList.remove('hidden');\n            } else {\n                sortToggle.classList.add('hidden');\n            }\n        });\n    }\n\n    private initVotingCreater() {\n        const opener = this.element.querySelector('.createVotingOpener'),\n            form = this.element.querySelector('.createVotingHolder'),\n            specificQuestion = this.element.querySelector('.specificQuestion'),\n            majorityType = this.element.querySelector('.majorityTypeSettings');\n        opener.addEventListener('click', () => {\n            form.classList.remove('hidden');\n            opener.classList.add('hidden');\n        });\n\n        const getRadioListValue = (selector: string, defaultValue: string) => {\n            let val = defaultValue;\n            form.querySelectorAll(selector).forEach(el => {\n                const input = el as HTMLInputElement;\n                if (input.checked) {\n                    val = input.value;\n                }\n            });\n            return val;\n        };\n\n        const recalcQuestionListener = () => {\n            if (getRadioListValue('.votingType input', 'question') === 'question') {\n                specificQuestion.classList.remove('hidden');\n            } else {\n                specificQuestion.classList.add('hidden');\n            }\n        };\n        form.querySelectorAll('.votingType input').forEach(el => {\n            el.addEventListener('change', recalcQuestionListener);\n        });\n        recalcQuestionListener();\n\n        const recalcAnswerTypeListener = () => {\n            const selectedAnswerType = parseInt(getRadioListValue('.answerTemplate input', '0'), 10);\n            if (selectedAnswerType === ANSWER_TEMPLATE_PRESENT || selectedAnswerType === ANSWER_TEMPLATE_YES) {\n                majorityType.classList.add('hidden');\n            } else {\n                majorityType.classList.remove('hidden');\n\n            }\n        };\n        form.querySelectorAll('.answerTemplate input').forEach(el => {\n            el.addEventListener('change', recalcAnswerTypeListener);\n        });\n        recalcAnswerTypeListener();\n\n        this.initPolicyWidget();\n\n        form.querySelector('form').addEventListener('submit', (ev) => {\n            ev.stopPropagation();\n            ev.preventDefault();\n            const type = getRadioListValue('.votingType input', 'question');\n            const answers = parseInt(getRadioListValue('.answerTemplate input', '0'), 10); // Default\n            const title = form.querySelector('.settingsTitle') as HTMLInputElement;\n            const specificQuestion = form.querySelector('.settingsQuestion') as HTMLInputElement;\n            const assigned = form.querySelector('.settingsAssignedMotion') as HTMLSelectElement;\n            const majorityType = parseInt(getRadioListValue('.majorityTypeSettings input', '1'), 10); // Default: simple majority\n            const resultsPublic = parseInt(getRadioListValue('.resultsPublicSettings input', '1'), 10); // Default: everyone\n            const votesPublic = parseInt(getRadioListValue('.votesPublicSettings input', '0'), 10); // Default: nobody\n            const votePolicy = parseInt((form.querySelector('.policySelect') as HTMLSelectElement).value, 10);\n            const votesNames = parseInt(getRadioListValue('.votesNamesSettings input', '0'), 10);\n            let userGroups;\n            if (votePolicy === POLICY_USER_GROUPS) {\n                userGroups = (form.querySelector('.userGroupSelectList') as any).selectize.items.map(item => parseInt(item, 10));\n            } else {\n                userGroups = [];\n            }\n            this.widgetComponent.createVoting(type, answers, title.value, specificQuestion.value, assigned.value, majorityType, votePolicy, userGroups, resultsPublic, votesPublic, votesNames);\n\n            form.classList.add('hidden');\n            opener.classList.remove('hidden');\n        });\n    }\n}\n"]}