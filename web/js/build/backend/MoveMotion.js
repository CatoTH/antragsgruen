var __awaiter=this&&this.__awaiter||function(n,i,t,e){return new(t||(t=Promise))(function(o,a){function d(n){try{r(e.next(n))}catch(n){a(n)}}function s(n){try{r(e.throw(n))}catch(n){a(n)}}function r(n){var i;n.done?o(n.value):(i=n.value,i instanceof t?i:new t(function(n){n(i)})).then(d,s)}r((e=e.apply(n,i||[])).next())})};export class MoveMotion{constructor(n){this.$form=n,this.checkBackend=n.data("check-backend"),this.initCopyMove(),this.initTarget(),this.initConsultation(),this.initButtonEnabled()}initCopyMove(){this.$form.find("input[name=operation]").on("change",()=>{"copynoref"===this.$form.find("input[name=operation]:checked").val()?(this.$form.find(".labelTargetMove").addClass("hidden"),this.$form.find(".labelTargetCopy").removeClass("hidden"),this.$form.find(".targetSame").removeClass("hidden")):(this.$form.find(".labelTargetMove").removeClass("hidden"),this.$form.find(".labelTargetCopy").addClass("hidden"),this.$form.find(".targetSame").addClass("hidden"))})}initTarget(){const n=this.$form.find("input[name=target]");n.on("change",()=>{const i=n.filter(":checked").val();"agenda"===i?this.$form.find(".moveToAgendaItem").removeClass("hidden"):this.$form.find(".moveToAgendaItem").addClass("hidden"),"consultation"===i?this.$form.find(".moveToConsultationItem").removeClass("hidden"):this.$form.find(".moveToConsultationItem").addClass("hidden"),this.rebuildMotionTypes()}).trigger("change")}initConsultation(){$("#consultationId").on("change",this.rebuildMotionTypes.bind(this))}rebuildMotionTypes(){const n=$("#consultationId").val();$(".moveToMotionTypeId").addClass("hidden"),"consultation"===this.$form.find("input[name=target]:checked").val()&&$(".moveToMotionTypeId"+n).removeClass("hidden")}isPrefixAvailable(n,i,t){return new Promise((e,o)=>$.get(this.checkBackend,{checkType:"prefix",operation:i,newMotionPrefix:n,newConsultationId:t}).then(n=>{e(n.success)}))}rebuildButtonEnabled(){return __awaiter(this,void 0,void 0,function*(){let n,i=!0;n="consultation"===this.$form.find("input[name=target]:checked").val()&&this.$form.find("[name=consultation]").length>0?parseInt(this.$form.find("[name=consultation]").val()):null;(yield this.isPrefixAvailable(this.$form.find("#motionTitlePrefix").val(),this.$form.find("input[name=operation]:checked").val(),n))?this.$form.find(".prefixAlreadyTaken").addClass("hidden"):(this.$form.find(".prefixAlreadyTaken").removeClass("hidden"),i=!1),this.$form.find("input[name=operation]:checked").val()||(i=!1),this.$form.find("input[name=target]:checked").val()||(i=!1),this.$form.find("button[type=submit]").prop("disabled",!i)})}initButtonEnabled(){this.$form.find("#motionTitlePrefix").on("change keyup",this.rebuildButtonEnabled.bind(this)),this.$form.find("input[name=operation]").on("change",this.rebuildButtonEnabled.bind(this)),this.$form.find("input[name=target]").on("change",this.rebuildButtonEnabled.bind(this)),$("#consultationId").on("change",this.rebuildButtonEnabled.bind(this)),this.rebuildButtonEnabled()}}
//# sourceMappingURL=MoveMotion.js.map
